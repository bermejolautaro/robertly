import{a as Le}from"./chunk-5LVRRYZR.js";import{a as Se,b as Ie,c as we}from"./chunk-BGGVJAGM.js";import{a as ye}from"./chunk-WAZVSXDP.js";import{c as ie,d as oe,j as ve,m as he,n as Ce,p as Ee,q as be,w as b}from"./chunk-ZVIJ6PDM.js";import{B as _e,J as fe,b as F,d as re,e as ne,f as ae,g as se,h as le,i as A,j as ce,k as _,m as de,n as pe,o as me,p as ue,q as ge,r as xe}from"./chunk-JY52K3I6.js";import{f as Q,j as X,l as Z,m as ee,n as te}from"./chunk-HKPS3N5F.js";import{Ab as x,Cb as W,Fb as u,Fc as N,Gb as v,Gc as D,Hb as h,Hc as G,Ib as C,Ic as J,Jb as a,Ka as k,Kb as n,Lb as p,Ob as O,R as z,Sb as M,Tb as g,a as I,ab as s,b as w,cc as c,dc as q,ec as S,ma as m,mb as H,pc as E,qc as B,rb as f,rc as $,sc as K,t as j,ua as T,va as V,x as P}from"./chunk-D2TTQ72P.js";function L(){return new A({serieId:new _,exerciseLogId:new _,reps:new _,weightInKg:new _})}var Pe=t=>{let o=t,e=new Map;ae.required(o.controls.exercise)&&e.set("exercise",w(I({},e.get("exercise")),{exerciseRequired:"Exercise is required"}));let r={};for(let[l,d]of e.entries())r[l]=d;return r};function Te(){return new A({user:new _(null),exercise:new _(null),date:new _(""),series:new ue([L(),L(),L(),L(),L()])},[Pe])}function ke(t,o){if(t&1&&(a(0,"div",22),c(1),n()),t&2){let e=o.$implicit;s(),q(e.value)}}function Me(t,o){if(t&1&&(h(0,ke,2,1,"div",22,v),E(2,"keyvalue")),t&2){let e,i=g(2);C(B(2,0,(e=i.formGroup().errors)==null?null:e.exercise))}}function De(t,o){t&1&&(a(0,"div",14),p(1,"i",23),c(2," You have unsaved changes "),n())}function Ge(t,o){if(t&1&&(a(0,"div",15)(1,"form",24)(2,"div",25),p(3,"input",26),n(),a(4,"div",25),p(5,"input",27),n()()()),t&2){let e=o.$implicit;s(3),x("formControl",e.controls.reps),s(2),x("formControl",e.controls.weightInKg)}}function Fe(t,o){if(t&1&&(a(0,"div",22),c(1),n()),t&2){let e=o.$implicit;s(),q(e.value)}}function Ae(t,o){if(t&1&&(h(0,Fe,2,1,"div",22,v),E(2,"keyvalue")),t&2){let e,i=g(2);C(B(2,0,(e=i.formGroup().errors)==null?null:e.series))}}function Re(t,o){t&1&&p(0,"i",20)}function Ue(t,o){t&1&&(p(0,"span",28),a(1,"span",29),c(2,"Loading..."),n())}function Ye(t,o){if(t&1&&p(0,"app-exercise-log",33),t&2){let e=o.$implicit;x("exerciseLog",e)}}function Oe(t,o){if(t&1&&(a(0,"div",30)(1,"div",31)(2,"div",32),c(3,"Previous entries"),n(),h(4,Ye,1,1,"app-exercise-log",33,v),E(6,"slice"),n()()),t&2){let e=g(3);s(4),C(K(6,0,e.originalValue.value().recentLogs,0,3))}}function qe(t,o){if(t&1&&p(0,"app-exercise-log",33),t&2){let e=o.$implicit;x("exerciseLog",e)}}function Be(t,o){if(t&1&&(a(0,"div",30)(1,"div",31)(2,"div",32),c(3,"Recently Updated"),n(),h(4,qe,1,1,"app-exercise-log",33,v),E(6,"slice"),n()()),t&2){let e=g(3);s(4),C(K(6,0,e.exerciseLogApiService.recentlyUpdated(),0,3))}}function $e(t,o){if(t&1&&(a(0,"span",34),c(1),n(),a(2,"ul",35)(3,"li",36),c(4),E(5,"number"),n()()),t&2){let e=o.$implicit,i=o.$index;s(),S("Serie ",i+1,""),s(3),S("",$(5,2,e.brzycki,"1.2-2"),"kg")}}function Ke(t,o){if(t&1&&(a(0,"div",30)(1,"div",31)(2,"div",32),c(3,"Possible 1RM (Brzycky Formula)"),n(),h(4,$e,6,5,null,null,v),a(6,"span",34),c(7,"Average"),n(),a(8,"ul",35)(9,"li",36),c(10),E(11,"number"),n()()()()),t&2){let e=g(3);s(4),C(e.originalValue.value().series),s(6),S("",$(11,1,e.originalValue.value().brzyckiAverage,"1.2-2"),"kg")}}function Ne(t,o){if(t&1&&f(0,Oe,7,4,"div",30)(1,Be,7,4,"div",30)(2,Ke,12,4,"div",30),t&2){let e=g(2);u(e.originalValue.value()?0:-1),s(),u(e.exerciseLogApiService.recentlyUpdated().length?1:-1),s(),u(e.originalValue.value()?2:-1)}}function je(t,o){if(t&1){let e=O();a(0,"button",37),M("click",function(){T(e);let r=g(2);return V(r.openDeleteModal())}),p(1,"i",38),a(2,"span"),c(3,"Delete"),n()()}}function ze(t,o){if(t&1){let e=O();a(0,"div",0)(1,"div",2)(2,"div",3)(3,"h4",4),c(4),n(),a(5,"span",5),c(6,"Record your workout details and progress"),n()(),a(7,"div")(8,"form"),p(9,"input",6),a(10,"div",7),p(11,"input",8),n(),a(12,"div",9),p(13,"app-typeahead",10),n(),a(14,"div",11)(15,"div",12),p(16,"app-typeahead",13),n(),f(17,Me,3,2),n(),f(18,De,3,0,"div",14),a(19,"div",11),h(20,Ge,6,2,"div",15,v),n(),f(22,Ae,3,2),n()(),a(23,"div",16)(24,"div",17)(25,"button",18),M("click",function(){T(e);let r=g();return V(r.cancel())}),c(26," Cancel "),n()(),a(27,"div",17)(28,"button",19),M("click",function(){T(e);let r=g();return V(r.save())}),f(29,Re,1,0,"i",20)(30,Ue,3,0),c(31," Save "),n()()(),f(32,Ne,3,3)(33,je,4,0,"button",21),n()()}if(t&2){let e=g();s(4),S("",e.mode()==="edit"?"Edit":"Create"," Exercise Log"),s(7),x("formControl",e.formGroup().controls.date),s(2),x("control",e.formGroup().controls.user)("items",e.users())("itemSelector",e.userSelector),s(3),x("control",e.formGroup().controls.exercise)("items",e.exerciseApiService.exercises())("itemSelector",e.exerciseSelector),s(),u(e.formGroup().controls.exercise.pristine?-1:17),s(),u(e.hasUnsavedChanges()?18:-1),s(2),C(e.formGroup().controls.series.controls),s(2),u(e.formGroup().controls.series.pristine?-1:22),s(6),W("btn-primary",e.formGroup().valid)("btn-secondary",e.formGroup().invalid),x("disabled",e.formGroup().invalid||e.isSaveLoading()),s(),u(e.isSaveLoading()?30:29),s(3),u(e.mode()==="edit"?32:-1),s(),u(e.mode()==="edit"?33:-1)}}function He(t,o){t&1&&(a(0,"div",1)(1,"div",39)(2,"span",40),c(3,"Loading..."),n()()())}var Mt=(()=>{class t{constructor(){this.authService=m(Ee),this.exerciseLogApiService=m(ye),this.exerciseApiService=m(he),this.location=m(Q),this.router=m(oe),this.toastService=m(Ce),this.titleCasePipe=m(X),this.dayjsService=m(Ie),this.dayjs=this.dayjsService.instance,this.route=m(ie),this.modalService=m(_e),this.isSaveLoading=k(!1),this.isLoading=J(()=>this.originalValue.isLoading()),this.paramMap=F(this.route.paramMap),this.exerciseLogId=D(()=>this.paramMap()?.get(b.LOGS_ID_PARAM)),this.url=F(this.route.url,{initialValue:[]}),this.mode=D(()=>this.url().some(e=>e.path===b.LOGS_CREATE)?"create":"edit"),this.formGroup=k(Te()),this.formGroupValue=F(this.formGroup().valueChanges),this.userSelector=e=>typeof e=="string"?"":e?.name??"",this.exerciseSelector=e=>typeof e=="string"?"":this.titleCasePipe.transform(e?.name)??"",this.users=D(()=>{let e=this.authService.user();return[e,...e?.assignedUsers??[]]}),this.originalValue=re({request:this.exerciseLogId,loader:({request:e})=>{let i=Number(e);return i?this.exerciseLogApiService.getExerciseLogById(i):j(null)}}),this.#e=G(()=>{this.originalValue.error()&&this.router.navigate([b.HOME])}),this.#t=G(()=>{let e=this.mode(),i=this.originalValue.value(),{user:r}=N(()=>({user:this.authService.user()}));e==="create"&&N(()=>{let l=this.dayjs().format("YYYY-MM-DD");this.formGroup.update(d=>(d.patchValue({date:l,user:r?.name??""}),d))}),e==="edit"&&i&&this.formGroup.update(l=>(l.reset(),l.patchValue({exercise:i.exercise,date:this.dayjsService.parseDate(i.date).format("YYYY-MM-DD"),user:i.user,series:i.series.map(d=>({exerciseLogId:d.exerciseLogId,serieId:d.serieId,reps:d.reps,weightInKg:d.weightInKg}))}),l))}),this.hasUnsavedChanges=k(!1),this.#i=G(()=>{let e=this.formGroupValue(),i=this.originalValue.value(),r=this.mode();if(!e){this.hasUnsavedChanges.set(!1);return}let l={series:R(i?.series.map(U=>w(I({},U),{brzycki:null})))??[]},d={series:R(e.series)};this.hasUnsavedChanges.set(r==="edit"&&!ve(l,d))})}#e;#t;#i;openDeleteModal(){let e=this.modalService.open(be,{centered:!0}),i=e.componentInstance;i.title.set("Delete Record"),i.subtitle.set("<strong>Are you sure you want to delete this record?</strong>"),i.body.set('This record will be permanently deleted. <span class="text-danger">This operation can not be undone.</span>'),i.okType.set("danger"),e.closed.pipe(z(1)).subscribe(async()=>{let r=this.originalValue.value();if(r)try{await P(this.exerciseLogApiService.deleteExerciseLog(r.id)),this.toastService.ok("Log deleted successfully!"),this.router.navigate([b.HOME])}catch(l){let d=l;this.toastService.error(`${d.message}`)}})}async save(){let e=this.mode(),i=this.formGroup();this.isSaveLoading.set(!0);let r=i.value.user,l=i.value.exercise,d=this.dayjsService.parseDate(i.value.date),U=this.originalValue.value();if(!r)throw new Error("User cannot be null");if(i.valid&&typeof l!="string"&&l&&typeof r!="string"&&r){if(i.disable(),e==="create"){let Y=We(i,r,l,d);try{let y=await P(this.exerciseLogApiService.createExerciseLog(Y));localStorage.removeItem(Se),this.toastService.ok("Log created successfully!"),this.router.navigate([b.LOGS,b.LOGS_EDIT,y])}catch(y){this.toastService.error(`${y}`)}}if(e==="edit"){let Y=Qe(U?.id,i,r,l,d);try{await P(this.exerciseLogApiService.updateExerciseLog(Y)),this.toastService.ok("Log updated successfully!"),this.originalValue.reload()}catch(y){let Ve=y;this.toastService.error(`${Ve.message}`)}}}this.isSaveLoading.set(!1),i.enable()}cancel(){this.location.back()}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=H({type:t,selectors:[["edit-exercise-log-page"]],decls:2,vars:1,consts:[[1,"header-footer-padding"],[1,"position-absolute","top-50","start-50","translate-middle"],[1,"container"],[1,"pb-3"],[1,"title"],[1,"subtitle"],["type","text","autofocus","autofocus",2,"display","none"],[1,"mb-2"],["type","date","placeholder","DD-MM-YYYY",1,"form-control",3,"formControl"],[1,"col-12","mb-2"],["placeholder","User",3,"control","items","itemSelector"],[1,"mb-3"],[1,"input-group"],["placeholder","Exercise",3,"control","items","itemSelector"],[1,"mb-2","px-2"],[1,"pb-1"],[1,"row","g-2","mb-5"],[1,"col"],["type","button",1,"btn","btn-secondary","w-100",3,"click"],["type","button",1,"btn","w-100","d-flex","justify-content-center","align-items-center",3,"click","disabled"],["aria-hidden","true",1,"fa","fa-save","px-2"],["type","button",1,"btn","btn-danger","w-100","delete-button"],[1,"d-block","invalid-feedback"],["aria-hidden","true",1,"fa","fa-exclamation-circle"],[1,"row","g-2"],[1,"col-6"],["type","number","placeholder","Reps",1,"form-control",3,"formControl"],["type","number","placeholder","Weight (Kg)",1,"form-control",3,"formControl"],["aria-hidden","true",1,"spinner-border","spinner-border-sm","mx-2"],["role","status",1,"visually-hidden"],[1,"card","mb-3"],[1,"card-body"],[1,"card-title"],[1,"w-100",3,"exerciseLog"],[1,"serie-label"],[1,"list-group","list-group-horizontal","pb-1"],[1,"list-group-item","w-100"],["type","button",1,"btn","btn-danger","w-100","delete-button",3,"click"],["aria-hidden","true",1,"fa","fa-trash","px-2"],["role","status",1,"robertly-spinner","spinner-border","text-primary"],[1,"visually-hidden"]],template:function(i,r){i&1&&f(0,ze,34,19,"div",0)(1,He,4,0,"div",1),i&2&&u(r.isLoading()?1:0)},dependencies:[xe,de,ne,pe,se,le,me,ge,ce,fe,Le,we,Z,ee,te],styles:["[_nghost-%COMP%]{--bs-body-bg: var(--light-bg);--bs-body-color: var(--font-color);--bs-tertiary-bg: var(--primary);--bs-border-width: 1px;--bs-border-color: rgba(255, 255, 255, .15)}.card[_ngcontent-%COMP%]{--bs-card-spacer-y: .5rem;--bs-card-spacer-x: .5rem}.title[_ngcontent-%COMP%]{margin:0}.subtitle[_ngcontent-%COMP%]{font-size:14px;opacity:.7}.card[_ngcontent-%COMP%]{background-color:var(--bg);border:1px solid rgba(255,255,255,.1)}.serie-label[_ngcontent-%COMP%]{font-size:12px;color:#ffffffbf;padding:0 .5rem}.delete-button[_ngcontent-%COMP%]{background-color:#301b23;--bs-btn-border-color: #6e363b;color:#fa8989}"],changeDetection:0})}}return t})();function We(t,o,e,i){return Je(o?.userId,o?.name??t.value.user,e.exerciseId,i,R(t.value.series))}function Je(t,o,e,i,r){return Xe(null,t,o,e,i,r)}function Qe(t,o,e,i,r){return{id:t,exerciseLog:{exerciseLogUsername:e?.name,exerciseLogUserId:e.userId,exerciseLogExerciseId:i.exerciseId,exerciseLogDate:r.format("YYYY-MM-DD"),series:R(o.value.series)}}}function Xe(t,o,e,i,r,l){return{id:t?.id,exerciseLog:{exerciseLogUsername:e.toLocaleLowerCase(),exerciseLogUserId:o,exerciseLogExerciseId:i,exerciseLogDate:r.format("YYYY-MM-DD"),series:l}}}function Ze(t){return{exerciseLogId:t.exerciseLogId,serieId:t.serieId,reps:+t.reps,weightInKg:+t.weightInKg.toFixed(1),brzycki:null}}function R(t){return(t??[]).filter(o=>!!o.reps&&!!o.weightInKg).map(Ze)}export{Mt as EditExerciseLogPageComponent};
