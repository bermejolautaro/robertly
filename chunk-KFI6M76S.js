import{a as H}from"./chunk-CAIFTKPT.js";import{a as $}from"./chunk-ZUBOAKQJ.js";import{a as G}from"./chunk-SXQIG57Z.js";import"./chunk-YOZSAP4L.js";import"./chunk-JWGIT43Z.js";import{a as q}from"./chunk-R3ZO37F3.js";import{a as _}from"./chunk-KY7B6MWQ.js";import"./chunk-JRGS3YIA.js";import{q as z,t as K}from"./chunk-MMNCJC44.js";import{Ad as B,Bb as E,Db as x,Ka as l,Kc as W,Nb as b,Ob as A,Rb as R,Sb as k,Tb as j,Ua as v,Uc as f,Wc as y,dd as C,ea as g,hd as w,ja as M,ka as F,kc as D,lc as h,mb as S,nb as P,oa as L,ob as I,oc as O,pb as T,qb as V,qd as U,rb as p,sb as n,ta as c,tb as s,ub as m,zb as N}from"./chunk-NQKVPPC6.js";var J=(()=>{let o=class o{constructor(){this.filtersChanged=O(),this.exerciseApiService=g(z),this.authService=g(K),this.exerciseLogApiService=g(_),this.titleCasePipe=g(W),this.userSelector=e=>e?.name??"",this.exerciseFormatter=e=>this.titleCasePipe.transform(e),this.weightFormatter=e=>isNaN(parseInt(e??""))?"":`${e}kg`,this.exerciseSelector=e=>typeof e=="string"?"":this.titleCasePipe.transform(e?.name)??"",this.userControl=new C(null),this.typeControl=new C(null),this.exerciseControl=new C(null),this.weightControl=new C(null),this.userControlValues=f(this.userControl.valueChanges),this.typeControlValues=f(this.typeControl.valueChanges),this.exerciseControlValues=f(this.exerciseControl.valueChanges),this.weightControlValues=f(this.weightControl.valueChanges),this.users=c([]),this.types=c([]),this.weights=c([]),this.exercises=c([]),this.filters=y({stream:()=>this.exerciseLogApiService.getFilters(this.userControl.value?.userId,this.exerciseControl.value?.exerciseId,this.typeControl.value,this.weightControl.value?+this.weightControl.value:null)}),h(()=>{let e=this.filters.value(),i=this.authService.user.value();e&&(this.users.set([i,...i?.assignedUsers??[]]),this.types.set(e.types),this.weights.set(e.weights.map(t=>`${t}`)),this.exercises.set(this.exerciseApiService.exercises().filter(t=>e.exercisesIds.includes(t.exerciseId))))}),h(()=>{let e=this.userControlValues(),i=this.typeControlValues(),t=this.exerciseControlValues(),a=this.weightControlValues(),d=e?[e.userId]:[],Q=i?[i]:[],X=t?.exerciseId?[t.exerciseId]:[],Y=a?[+a]:[];this.filters.reload(),this.filtersChanged.emit({userId:d,exercisesIds:X,types:Q,weights:Y})})}};o.\u0275fac=function(i){return new(i||o)},o.\u0275cmp=v({type:o,selectors:[["app-filters"]],outputs:{filtersChanged:"filtersChanged"},decls:9,vars:11,consts:[[1,"col-12","mb-2"],["placeholder","User",3,"control","items","itemSelector"],[1,"row","mb-2","gx-2"],[1,"col-12"],["placeholder","Type",3,"control","items"],["placeholder","Exercise",3,"control","items","itemSelector"],["placeholder","Weight (kg)",3,"control","items","itemSelector"]],template:function(i,t){i&1&&(n(0,"div",0),m(1,"app-typeahead",1),s(),n(2,"div",2)(3,"div",3),m(4,"app-dropdown",4),s()(),n(5,"div",0),m(6,"app-typeahead",5),s(),n(7,"div",0),m(8,"app-typeahead",6),s()),i&2&&(l(),p("control",t.userControl)("items",t.users())("itemSelector",t.userSelector),l(3),p("control",t.typeControl)("items",t.types()),l(2),p("control",t.exerciseControl)("items",t.exercises())("itemSelector",t.exerciseSelector),l(2),p("control",t.weightControl)("items",t.weights())("itemSelector",t.weightFormatter))},dependencies:[B,w,U,$,q],encapsulation:2,changeDetection:0});let r=o;return r})();function ee(r,o){if(r&1&&(n(0,"span",3),b(1),s()),r&2){let u=x();l(),A(u.filtersCount())}}function te(r,o){if(r&1&&m(0,"app-exercise-log",9),r&2){let u=o.$implicit;p("exerciseLog",u)}}function ie(r,o){r&1&&(n(0,"div",10),b(1,"No results found"),s())}function re(r,o){if(r&1){let u=N();n(0,"app-paginator",12),j("currentPageChange",function(i){M(u);let t=x();return k(t.currentPage,i)||(t.currentPage=i),F(i)}),s()}if(r&2){let u,e=x();R("currentPage",e.currentPage),p("pageCount",((u=e.logsResource.value())==null?null:u.pageCount)??0)}}var be=(()=>{let o=class o{constructor(){this.document=g(L),this.exerciseLogApiService=g(_),this.showFilters=c(!1),this.currentPage=c(0),this.filter=c(null),this.filtersCount=D(()=>{let e=this.filter();return e?Object.values(e).reduce((i,t)=>i+t.length,0):0}),this.logsResource=y({params:this.filter,stream:({params:e})=>{let i=e?.userId.at(0),t=e?.types.at(0),a=e?.exercisesIds.at(0),d=e?.weights.at(0);return this.exerciseLogApiService.getExerciseLogs(this.currentPage(),i,t??null,a??null,d??null)}}),this.logs=D(()=>this.logsResource.isLoading()?[null,null,null,null,null]:this.logsResource.value()?.data),h(()=>{this.currentPage(),this.logsResource.reload()})}ngOnInit(){this.document.defaultView?.scroll({top:0,left:0,behavior:"smooth"})}onFilterChange(e){this.currentPage.set(0),this.filter.set(e),this.logsResource.reload()}};o.\u0275fac=function(i){return new(i||o)},o.\u0275cmp=v({type:o,selectors:[["app-exercise-logs-page"]],decls:13,vars:4,consts:[[1,"header-footer-padding"],[1,"container"],[1,"d-flex","justify-content-end"],[1,"active-filters"],[1,"btn","btn-secondary",3,"click"],[1,"fa","fa-sliders"],[1,"mt-2",3,"hidden"],[3,"filtersChanged"],[1,"mt-2"],[3,"exerciseLog"],[1,"d-flex","justify-content-center","align-items-center","my-5"],[3,"currentPage","pageCount"],[3,"currentPageChange","currentPage","pageCount"]],template:function(i,t){if(i&1&&(n(0,"div",0)(1,"div",1)(2,"div",2),S(3,ee,2,1,"span",3),n(4,"button",4),E("click",function(){return t.showFilters.set(!t.showFilters())}),m(5,"i",5),s()(),n(6,"div",6)(7,"app-filters",7),E("filtersChanged",function(d){return t.onFilterChange(d)}),s()(),n(8,"div",8),T(9,te,1,1,"app-exercise-log",9,I,!1,ie,2,0,"div",10),s(),S(12,re,1,2,"app-paginator",11),s()()),i&2){let a;l(3),P(t.filtersCount()?3:-1),l(3),p("hidden",!t.showFilters()),l(3),V(t.logs()),l(3),P((a=t.logs())!=null&&a.length?12:-1)}},dependencies:[w,H,J,G],styles:[".toggle-filters[_ngcontent-%COMP%]{border:1px solid white;border-radius:5px;width:2rem;height:2rem}.active-filters[_ngcontent-%COMP%]{display:inline;position:relative;text-align:center;background:#ef4444;border-radius:100%;width:18px;height:18px;font-size:12px;font-weight:700;top:-6px;right:-44px}"],changeDetection:0});let r=o;return r})();export{be as ExerciseLogsPageComponent};
