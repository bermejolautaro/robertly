import{a as Le}from"./chunk-55IMHJ6Q.js";import{a as ye}from"./chunk-OKMLR5ZH.js";import{A as xe,G as _e,I as fe,J as ve,K as he,M as Ce,N as be,O as Ee,P as L,a as ee,b as te,c as T,d as ie,e as oe,f as re,g as ne,h as ae,j as se,k as le,m as ce,p as de,q as pe,r as me,s as ue,t as ge}from"./chunk-EH3J5OSO.js";import{f as W,j as J,l as Q,m as X,n as Z}from"./chunk-IROKSODG.js";import{Bb as x,Db as z,Gb as g,Hb as f,Hc as P,Ib as v,Ic as H,Jb as h,Jc as O,Kb as n,Kc as $,Lb as r,Mb as p,Pb as Y,Tb as I,U as D,Ub as u,a as B,b as j,cb as a,dc as l,ec as A,fc as b,g as q,kb as N,qa as m,rc as C,sc as U,tc as R,ub as G,uc as F,v as K,ya as y,z as M,za as S,zb as _}from"./chunk-TZ356O6P.js";function Se(t,o){if(t&1&&(n(0,"div",23),l(1),r()),t&2){let e=o.$implicit;a(),A(e.value)}}function Ie(t,o){if(t&1&&(v(0,Se,2,1,"div",23,f),C(2,"keyvalue")),t&2){let e,i=u(2);h(U(2,0,(e=i.formGroup().errors)==null?null:e.exercise))}}function Pe(t,o){t&1&&(n(0,"div",14),p(1,"i",24),l(2," You have unsaved changes "),r())}function Te(t,o){if(t&1&&(n(0,"div",16)(1,"span",25),l(2),r(),n(3,"form",26)(4,"div",27),p(5,"input",28),r(),n(6,"div",27),p(7,"input",29),r()()()),t&2){let e=o.$implicit,i=o.$index;a(2),b("Serie ",i+1,""),a(3),x("formControl",e.controls.reps),a(2),x("formControl",e.controls.weightInKg)}}function ke(t,o){if(t&1&&(n(0,"div",23),l(1),r()),t&2){let e=o.$implicit;a(),A(e.value)}}function we(t,o){if(t&1&&(v(0,ke,2,1,"div",23,f),C(2,"keyvalue")),t&2){let e,i=u(2);h(U(2,0,(e=i.formGroup().errors)==null?null:e.series))}}function Ve(t,o){if(t&1&&p(0,"app-exercise-log",33),t&2){let e=o.$implicit;x("exerciseLog",e)}}function Me(t,o){if(t&1&&(n(0,"div",30)(1,"div",31)(2,"div",32),l(3,"Previous entries"),r(),v(4,Ve,1,1,"app-exercise-log",33,f),C(6,"slice"),r()()),t&2){let e=u(3);a(4),h(F(6,0,e.originalValue.value().recentLogs,0,3))}}function De(t,o){if(t&1&&p(0,"app-exercise-log",33),t&2){let e=o.$implicit;x("exerciseLog",e)}}function Ge(t,o){if(t&1&&(n(0,"div",30)(1,"div",31)(2,"div",32),l(3,"Recently Updated"),r(),v(4,De,1,1,"app-exercise-log",33,f),C(6,"slice"),r()()),t&2){let e=u(3);a(4),h(F(6,0,e.exerciseLogApiService.recentlyUpdated(),0,3))}}function Ye(t,o){if(t&1&&(n(0,"span",25),l(1),r(),n(2,"ul",34)(3,"li",35),l(4),C(5,"number"),r()()),t&2){let e=o.$implicit,i=o.$index;a(),b("Serie ",i+1,""),a(3),b("",R(5,2,e.brzycki,"1.2-2"),"kg")}}function Ae(t,o){if(t&1&&(n(0,"div",30)(1,"div",31)(2,"div",32),l(3,"Possible 1RM (Brzycky Formula)"),r(),v(4,Ye,6,5,null,null,f),n(6,"span",25),l(7,"Average"),r(),n(8,"ul",34)(9,"li",35),l(10),C(11,"number"),r()()()()),t&2){let e=u(3);a(4),h(e.originalValue.value().series),a(6),b("",R(11,1,e.originalValue.value().brzyckiAverage,"1.2-2"),"kg")}}function Ue(t,o){if(t&1&&_(0,Me,7,4,"div",30)(1,Ge,7,4,"div",30)(2,Ae,12,4,"div",30),t&2){let e=u(2);g(e.originalValue.value()?0:-1),a(),g(e.exerciseLogApiService.recentlyUpdated().length?1:-1),a(),g(e.originalValue.value()?2:-1)}}function Re(t,o){if(t&1){let e=Y();n(0,"button",36),I("click",function(){y(e);let s=u(2);return S(s.openDeleteModal())}),p(1,"i",37),n(2,"span"),l(3,"Delete"),r()()}}function Fe(t,o){if(t&1){let e=Y();n(0,"div",0)(1,"div",2)(2,"div",3)(3,"h4",4),l(4),r(),n(5,"span",5),l(6,"Record your workout details and progress"),r()(),n(7,"div")(8,"form"),p(9,"input",6),n(10,"div",7),p(11,"input",8),r(),n(12,"div",9),p(13,"app-typeahead",10),r(),n(14,"div",11)(15,"div",12),p(16,"app-typeahead",13),r(),_(17,Ie,3,2),r(),_(18,Pe,3,0,"div",14),n(19,"div",15),v(20,Te,8,3,"div",16,f),r(),_(22,we,3,2),r()(),n(23,"div",17)(24,"div",18)(25,"button",19),I("click",function(){y(e);let s=u();return S(s.cancel())}),l(26," Cancel "),r()(),n(27,"div",18)(28,"button",20),I("click",function(){y(e);let s=u();return S(s.save())}),p(29,"i",21),l(30," Save "),r()()(),_(31,Ue,3,3)(32,Re,4,0,"button",22),r()()}if(t&2){let e=u();a(4),b("",e.mode()==="edit"?"Edit":"Create"," Exercise Log"),a(7),x("formControl",e.formGroup().controls.date),a(2),x("control",e.formGroup().controls.user)("items",e.users())("itemSelector",e.userSelector),a(3),x("control",e.formGroup().controls.exercise)("items",e.exerciseLogService.exercises())("itemSelector",e.exerciseSelector),a(),g(e.formGroup().controls.exercise.pristine?-1:17),a(),g(e.hasUnsavedChanges()?18:-1),a(2),h(e.formGroup().controls.series.controls),a(2),g(e.formGroup().controls.series.pristine?-1:22),a(6),z("btn-primary",e.formGroup().valid)("btn-secondary",e.formGroup().invalid),x("disabled",e.formGroup().invalid),a(3),g(e.mode()==="edit"?31:-1),a(),g(e.mode()==="edit"?32:-1)}}function Oe(t,o){t&1&&(n(0,"div",1)(1,"div",38)(2,"span",39),l(3,"Loading..."),r()()())}var xt=(()=>{class t{constructor(){this.exerciseLogService=m(re),this.authService=m(Ce),this.exerciseLogApiService=m(ne),this.location=m(W),this.router=m(te),this.toastService=m(he),this.titleCasePipe=m(J),this.dayjsService=m(ve),this.dayjs=this.dayjsService.instance,this.route=m(ee),this.modalService=m(xe),this.isLoading=H(()=>this.originalValue.isLoading()),this.paramMap=T(this.route.paramMap),this.exerciseLogId=P(()=>this.paramMap()?.get(L.LOGS_ID_PARAM)),this.url=T(this.route.url,{initialValue:[]}),this.mode=P(()=>this.url().some(e=>e.path===L.LOGS_CREATE)?"create":"edit"),this.formGroup=G(be()),this.formGroupValue=T(this.formGroup().valueChanges),this.userSelector=e=>typeof e=="string"?"":e?.name??"",this.exerciseSelector=e=>typeof e=="string"?"":this.titleCasePipe.transform(e?.name)??"",this.users=P(()=>{let e=this.authService.user();return[e,...e?.assignedUsers??[]]}),this.originalValue=ie({request:this.exerciseLogId,loader:({request:e})=>{let i=Number(e);return i?this.exerciseLogApiService.getExerciseLogById(i):K(null)}}),this.#e=$(()=>{let e=this.mode(),i=this.originalValue.value(),{user:s}=O(()=>({user:this.authService.user()}));e==="create"&&O(()=>{let c=this.dayjs().format("YYYY-MM-DD");this.formGroup.update(d=>(d.patchValue({date:c,user:s?.name??""}),d))}),e==="edit"&&i&&this.formGroup.update(c=>(c.reset(),c.patchValue({exercise:i.exercise,date:this.dayjsService.parseDate(i.date).format("YYYY-MM-DD"),user:i.user,series:i.series.map(d=>({exerciseLogId:d.exerciseLogId,serieId:d.serieId,reps:d.reps,weightInKg:d.weightInKg}))}),c))}),this.hasUnsavedChanges=G(!1),this.#t=$(()=>{let e=this.formGroupValue(),i=this.originalValue.value(),s=this.mode();if(!e){this.hasUnsavedChanges.set(!1);return}let c={series:k(i?.series.map(w=>j(B({},w),{brzycki:null})))??[]},d={series:k(e.series)};this.hasUnsavedChanges.set(s==="edit"&&!oe(c,d))})}#e;#t;openDeleteModal(){let e=this.modalService.open(Ee,{centered:!0}),i=e.componentInstance;i.title="Delete Record",i.subtitle="<strong>Are you sure you want to delete this record?</strong>",i.body='This record will be permanently deleted. <span class="text-danger">This operation can not be undone.</span>',i.okType="danger",e.closed.pipe(D(1)).subscribe(()=>{this.exerciseLogService.deleteLog$.next(this.originalValue.value())})}save(){return q(this,null,function*(){let e=this.mode(),i=this.formGroup();this.isLoading.set(!0);let s=i.value.user,c=i.value.exercise,d=this.dayjsService.parseDate(i.value.date),w=this.originalValue.value();if(!s)throw new Error("User cannot be null");if(i.valid&&typeof c!="string"&&c&&typeof s!="string"&&s){if(e==="create"){let V=$e(i,s,c,d);try{let E=yield M(this.exerciseLogApiService.createExerciseLog(V));localStorage.removeItem(fe),this.toastService.ok("Log created successfully!"),this.router.navigate([L.LOGS,L.LOGS_EDIT,E])}catch(E){this.toastService.error(`${E}`)}}if(e==="edit"){let V=je(w?.id,i,s,c,d);try{yield M(this.exerciseLogApiService.updateExerciseLog(V)),this.toastService.ok("Log updated successfully!"),this.originalValue.reload()}catch(E){this.toastService.error(`${E}`)}}}this.isLoading.set(!1)})}cancel(){this.exerciseLogService.refreshLogs$.pipe(D(1)).subscribe(()=>{this.location.back()}),this.exerciseLogService.refreshLogs$.next()}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=N({type:t,selectors:[["edit-exercise-log-page"]],decls:2,vars:1,consts:[[1,"header-footer-padding"],[1,"position-absolute","top-50","start-50","translate-middle"],[1,"container"],[1,"pb-3"],[1,"title"],[1,"subtitle"],["type","text","autofocus","autofocus",2,"display","none"],[1,"mb-2"],["type","date","placeholder","DD-MM-YYYY",1,"form-control",3,"formControl"],[1,"col-12","mb-2"],["placeholder","User",3,"control","items","itemSelector"],[1,"mb-3"],[1,"input-group"],["placeholder","Exercise",3,"control","items","itemSelector"],[1,"mb-2","px-2"],[1,"pb-4"],[1,"pb-1"],[1,"row","g-2","mb-5"],[1,"col"],["type","button",1,"btn","btn-secondary","w-100",3,"click"],["type","button",1,"btn","w-100","d-flex","justify-content-center","align-items-center",3,"click","disabled"],["aria-hidden","true",1,"fa","fa-save","px-2"],["type","button",1,"btn","btn-danger","w-100","delete-button"],[1,"d-block","invalid-feedback"],["aria-hidden","true",1,"fa","fa-exclamation-circle"],[1,"serie-label"],[1,"row","g-2"],[1,"col-6"],["type","number","placeholder","Reps",1,"form-control",3,"formControl"],["type","number","placeholder","Weight (Kg)",1,"form-control",3,"formControl"],[1,"card","mb-3"],[1,"card-body"],[1,"card-title"],[1,"w-100",3,"exerciseLog"],[1,"list-group","list-group-horizontal","pb-1"],[1,"list-group-item","w-100"],["type","button",1,"btn","btn-danger","w-100","delete-button",3,"click"],["aria-hidden","true",1,"fa","fa-trash","px-2"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"]],template:function(i,s){i&1&&_(0,Fe,33,18,"div",0)(1,Oe,4,0,"div",1),i&2&&g(s.isLoading()?1:0)},dependencies:[ge,de,ae,pe,se,le,me,ue,ce,_e,Le,ye,Q,X,Z],styles:["[_nghost-%COMP%]{display:block;padding:0 .5rem;--bs-heading-color: white;--bs-modal-color: white;--bs-body-bg: var(--light-bg);--bs-body-color: var(--font-color);--bs-tertiary-bg: var(--primary);--bs-border-width: 1px;--bs-border-color: rgba(255, 255, 255, .15);--bs-modal-footer-border-width: 0;--bs-modal-header-border-width: 0;--bs-modal-header-padding: .5rem}.title[_ngcontent-%COMP%]{margin:0}.subtitle[_ngcontent-%COMP%]{font-size:14px;opacity:.7}.card[_ngcontent-%COMP%]{background-color:var(--bg);border:1px solid rgba(255,255,255,.1)}.serie-label[_ngcontent-%COMP%]{font-size:12px;color:#ffffffbf;padding:0 .5rem}.delete-button[_ngcontent-%COMP%]{background-color:#301b23;--bs-btn-border-color: #6e363b;color:#fa8989}"],changeDetection:0})}}return t})();function $e(t,o,e,i){return Be(o?.userId,o?.name??t.value.user,e.exerciseId,i,k(t.value.series))}function Be(t,o,e,i,s){return qe(null,t,o,e,i,s)}function je(t,o,e,i,s){return{id:t,exerciseLog:{exerciseLogUsername:e?.name,exerciseLogUserId:e.userId,exerciseLogExerciseId:i.exerciseId,exerciseLogDate:s.format("YYYY-MM-DD"),series:k(o.value.series)}}}function qe(t,o,e,i,s,c){return{id:t?.id,exerciseLog:{exerciseLogUsername:e.toLocaleLowerCase(),exerciseLogUserId:o,exerciseLogExerciseId:i,exerciseLogDate:s.format("YYYY-MM-DD"),series:c}}}function Ke(t){return{exerciseLogId:t.exerciseLogId,serieId:t.serieId,reps:+t.reps,weightInKg:+t.weightInKg.toFixed(1),brzycki:null}}function k(t){return(t??[]).filter(o=>!!o.reps&&!!o.weightInKg).map(Ke)}export{xt as EditExerciseLogPageComponent};
