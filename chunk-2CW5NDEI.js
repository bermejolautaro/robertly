import{a as $}from"./chunk-DRVXAVMV.js";import{a as x}from"./chunk-WAU75UIT.js";import{a as ee}from"./chunk-6OJFKUMV.js";import{a as X}from"./chunk-5THT56CE.js";import{c as Z}from"./chunk-CD6O3K5F.js";import{c as N,d as j,n as H,p as K,q as Q,w as v,y as oe}from"./chunk-TK7MRVC7.js";import{A as J,b as B,d as S,f as q,h as z,m as G,p as U}from"./chunk-TXMB3Z4A.js";import{$b as f,Bb as _,Fb as n,Gb as a,Hb as b,Ia as D,Jc as R,Ka as m,Kb as V,Mb as y,Nb as k,Nc as I,R as P,Ya as l,Yb as g,_b as O,ac as p,bc as h,ib as T,ma as d,nb as F,t as M,ua as E,va as w,wb as c,x as L,xc as Y,yb as A,yc as u,zc as W}from"./chunk-SEHCXKDS.js";function te(s,C){s&1&&b(0,"i",15)}function ie(s,C){s&1&&(b(0,"span",17),n(1,"span",18),g(2,"Loading..."),a())}function re(s,C){if(s&1){let o=V();n(0,"button",19),y("click",function(){E(o);let e=k();return w(e.openDeleteModal())}),b(1,"i",20),n(2,"span"),g(3,"Delete"),a()()}}var Me=(()=>{class s{constructor(){this.location=d(R),this.router=d(j),this.toastService=d(H),this.titleCasePipe=d(I),this.route=d(N),this.modalService=d(J),this.authService=d(K),this.dayjs=d(oe),this.foodLogsApiService=d($),this.foodsApiService=d(ee),this.foodLogIdFromRoute=D(void 0,{alias:"id"}),this.url=B(this.route.url,{initialValue:[]}),this.mode=u(()=>this.url().some(o=>o.path===v.CREATE)?"create":"edit"),this.foods=S({loader:()=>this.foodsApiService.getFoods(),defaultValue:[]}),this.userSelector=o=>typeof o=="string"?"":o?.name??"",this.foodSelector=o=>typeof o=="string"?"":this.titleCasePipe.transform(o?.name)??"",this.users=u(()=>{let o=this.authService.user();return[o,...o?.assignedUsers??[]]}),this.isSaveLoading=m(!1),this.titleCaseSelector=o=>o?this.titleCasePipe.transform(o):"",this.originalValue=S({request:this.foodLogIdFromRoute,loader:({request:o})=>o?this.foodLogsApiService.getFoodLogById(o):M(null)}),this.foodLogForm={user:m(null),food:m(null),date:m(null),amount:m(null)},this.foodLogFormValue=u(()=>this.foodLogForm),this.foodLogFormValid=u(()=>!0),this.foodLogFormEnabled=m(!0),this.amountPlaceholder=u(()=>{let o=this.foodLogForm.food();return o?`Amount (${o.unit})`:"Amount"}),W(()=>{let o=this.mode(),i=this.originalValue.value(),e=Y(()=>this.authService.user());if(o==="create"){let r=this.dayjs().format("YYYY-MM-DD");this.foodLogForm.date.set(r),this.foodLogForm.user.set(e)}o==="edit"&&i&&(this.foodLogForm.date.set(Z(this.dayjs,i.date).format("YYYY-MM-DD")),this.foodLogForm.food.set(i.food),this.foodLogForm.user.set(i.user),this.foodLogForm.amount.set(i.amount.toString()))})}openDeleteModal(){let o=this.modalService.open(Q,{centered:!0});o.componentInstance.configurate({title:"Delete Record",subtitle:"<strong>Are you sure you want to delete this record?</strong>",body:'This record will be permanently deleted. <span class="text-danger">This operation can not be undone.</span>',okType:"danger"}),o.closed.pipe(P(1)).subscribe(async()=>{let e=this.originalValue.value();if(e?.foodLogId)try{await L(this.foodLogsApiService.deleteFoodLog(e.foodLogId)),this.router.navigate([v.FOOD_LOGS])}catch(r){let t=r;this.toastService.error(`${t.message}`)}})}async save(){if(!this.foodLogFormValid())return;let o=this.originalValue.value(),i=this.foodLogForm.user(),e=this.foodLogForm.food();if(!this.foodLogFormValid()||typeof e=="string"||!e||typeof i=="string"||!i)return;this.isSaveLoading.set(!0),this.foodLogFormEnabled.set(!1);let r={foodLogId:o?.foodLogId??null,date:this.foodLogForm.date(),user:i,food:e,amount:Number(this.foodLogForm.amount())};try{this.mode()==="create"?await L(this.foodLogsApiService.createFoodLog(r)):await L(this.foodLogsApiService.updateFoodLog(r))}catch{this.toastService.error("An error occurred while saving the log.")}finally{this.isSaveLoading.set(!1),this.foodLogFormEnabled.set(!0),this.router.navigate([v.FOOD_LOGS])}}cancel(){this.location.back()}static{this.\u0275fac=function(i){return new(i||s)}}static{this.\u0275cmp=T({type:s,selectors:[["edit-food-log-page"]],inputs:{foodLogIdFromRoute:[1,"id","foodLogIdFromRoute"]},decls:26,vars:17,consts:[[1,"header-footer-padding"],[1,"container"],[1,"pb-3"],[1,"title"],[1,"subtitle"],[1,"mb-2"],["type","date","placeholder","DD-MM-YYYY",1,"form-control",3,"ngModelChange","ngModel"],[1,"mb-3"],["placeholder","User",3,"valueChange","value","items","itemSelector"],["placeholder","Food",3,"valueChange","value","items","itemSelector"],["type","text","onlyNumbers","",1,"form-control",3,"ngModelChange","placeholder","ngModel"],[1,"row","g-2","mb-3"],[1,"col"],["type","button",1,"btn","btn-secondary","w-100",3,"click"],["type","button",1,"btn","w-100","d-flex","justify-content-center","align-items-center",3,"click","disabled"],["aria-hidden","true",1,"fa","fa-save","px-2"],["type","button",1,"btn","btn-danger","w-100","delete-button"],["aria-hidden","true",1,"spinner-border","spinner-border-sm","mx-2"],["role","status",1,"visually-hidden"],["type","button",1,"btn","btn-danger","w-100","delete-button",3,"click"],["aria-hidden","true",1,"fa","fa-trash","px-2"]],template:function(i,e){i&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4",3),g(4),a(),n(5,"span",4),g(6,"Track your daily meals and your calorie intake"),a()(),n(7,"div")(8,"div",5)(9,"input",6),h("ngModelChange",function(t){return p(e.foodLogForm.date,t)||(e.foodLogForm.date=t),t}),a()(),n(10,"div",7)(11,"app-typeahead",8),h("valueChange",function(t){return p(e.foodLogForm.user,t)||(e.foodLogForm.user=t),t}),a()(),n(12,"div",7)(13,"app-typeahead",9),h("valueChange",function(t){return p(e.foodLogForm.food,t)||(e.foodLogForm.food=t),t}),a()(),n(14,"div",5)(15,"input",10),h("ngModelChange",function(t){return p(e.foodLogForm.amount,t)||(e.foodLogForm.amount=t),t}),a()()(),n(16,"div",11)(17,"div",12)(18,"button",13),y("click",function(){return e.cancel()}),g(19," Cancel "),a()(),n(20,"div",12)(21,"button",14),y("click",function(){return e.save()}),F(22,te,1,0,"i",15)(23,ie,3,0),g(24," Save "),a()()(),F(25,re,4,0,"button",16),a()()),i&2&&(l(4),O("",e.mode()==="edit"?"Edit":"Create"," Food Log"),l(5),f("ngModel",e.foodLogForm.date),l(2),f("value",e.foodLogForm.user),c("items",e.users())("itemSelector",e.userSelector),l(2),f("value",e.foodLogForm.food),c("items",e.foods.value())("itemSelector",e.foodSelector),l(2),c("placeholder",e.amountPlaceholder()),f("ngModel",e.foodLogForm.amount),l(6),A("btn-primary",e.foodLogFormValid())("btn-secondary",!e.foodLogFormValid()),c("disabled",!e.foodLogFormValid()||e.isSaveLoading()),l(),_(e.isSaveLoading()?23:22),l(3),_(e.mode()==="edit"?25:-1))},dependencies:[U,q,z,G,X,x],styles:["[_nghost-%COMP%]{--bs-body-bg: var(--light-bg);--bs-body-color: var(--font-color);--bs-tertiary-bg: var(--primary);--bs-border-width: 1px;--bs-border-color: rgba(255, 255, 255, .15)}.card[_ngcontent-%COMP%]{--bs-card-spacer-y: .5rem;--bs-card-spacer-x: .5rem}.title[_ngcontent-%COMP%]{margin:0}.subtitle[_ngcontent-%COMP%]{font-size:14px;opacity:.7}.card[_ngcontent-%COMP%]{background-color:var(--bg);border:1px solid rgba(255,255,255,.1)}.serie-label[_ngcontent-%COMP%]{font-size:12px;color:#ffffffbf;padding:0 .5rem}.delete-button[_ngcontent-%COMP%]{background-color:#301b23;--bs-btn-border-color: #6e363b;color:#fa8989}"],changeDetection:0})}}return s})();export{Me as EditFoodLogPageComponent};
