import{a as pe}from"./chunk-TSENH3WM.js";import{K as ne,M as ae,O as se,Q as ce,R as le,S as de,T as C,a as B,b as R,c as j,d as N,e as z,f as q,g as H,h as J,j as Q,k as W,m as X,p as Z,q as ee,r as te,s as ie,t as re,y as oe}from"./chunk-Z3SDNAI5.js";import{f as V,h as Y,j as A,l as K,m as $}from"./chunk-NHGFSOZE.js";import{$b as k,Ab as L,Db as O,Ib as S,Jb as m,Nb as l,Ob as G,Pb as f,R as F,Ub as D,Vb as T,Wb as M,Xb as P,Za as I,Zb as b,_b as U,bb as s,mb as p,oa as d,qa as w,sb as g,tb as x,ub as h,va as E,wa as y,wb as _,xb as v,yb as c,zb as a}from"./chunk-W3RQ7BCU.js";function me(t,o){if(t&1&&(c(0,"div",14),l(1),a()),t&2){let e=o.$implicit;s(1),G(e.value)}}function ue(t,o){if(t&1&&(_(0,me,2,1,"div",15,h),b(2,"keyvalue")),t&2){let e=m(2);v(U(2,0,e.createOrUpdateLogFormGroup.errors==null?null:e.createOrUpdateLogFormGroup.errors.exercise))}}function ge(t,o){if(t&1&&(c(0,"div",16)(1,"span",17),l(2),a(),L(3,"input",18)(4,"input",19),a()),t&2){let e=o.$implicit,r=o.$index;s(2),f("Serie ",r+1,""),s(1),p("formControl",e.controls.reps),s(1),p("formControl",e.controls.weightInKg)}}function xe(t,o){if(t&1&&(c(0,"div",14),l(1),a()),t&2){let e=o.$implicit;s(1),G(e.value)}}function he(t,o){if(t&1&&(_(0,xe,2,1,"div",15,h),b(2,"keyvalue")),t&2){let e=m(2);v(U(2,0,e.createOrUpdateLogFormGroup.errors==null?null:e.createOrUpdateLogFormGroup.errors.series))}}function _e(t,o){if(t&1){let e=O();c(0,"button",20),S("click",function(){E(e);let i=m(2);return y(i.openDeleteModal())}),l(1," Delete "),a()}}function ve(t,o){if(t&1&&L(0,"app-exercise-log",27),t&2){let e=o.$implicit;p("exerciseLog",e)}}function Le(t,o){if(t&1&&(c(0,"ul",24)(1,"li",25),l(2),a(),c(3,"li",26),l(4),b(5,"number"),a()()),t&2){let e=o.$implicit,r=o.$index;s(2),f("Serie ",r+1,""),s(2),f("",k(5,2,e.brzycki,"1.2-2"),"kg")}}var fe=()=>[];function be(t,o){if(t&1&&(c(0,"div",21)(1,"div",22),l(2,"Previous entries"),a(),_(3,ve,1,1,"app-exercise-log",28,h),a(),c(5,"div",23)(6,"div",22),l(7,"Possible 1RM (Brzycky Formula)"),a(),_(8,Le,6,5,"ul",29,h),c(10,"ul",24)(11,"li",25),l(12,"Average"),a(),c(13,"li",26),l(14),b(15,"number"),a()()()),t&2){let e=m(2),r,i,n;s(3),v((r=(r=e.originalValue())==null?null:r.recentLogs)!==null&&r!==void 0?r:T(4,fe)),s(5),v((i=e.originalValue())==null?null:i.series),s(6),f("",k(15,1,(n=e.originalValue())==null?null:n.brzyckiAverage,"1.2-2"),"kg")}}var Ce=t=>({"justify-content-between":t}),Ee=(t,o)=>({"btn-primary":t,"btn-secondary":o});function ye(t,o){if(t&1){let e=O();c(0,"div",1)(1,"div",2)(2,"h4",3),l(3),a()(),c(4,"div",4)(5,"form"),L(6,"input",5),c(7,"div",6),L(8,"input",7),a(),c(9,"div",6)(10,"div",8),L(11,"app-typeahead",9),a(),g(12,ue,3,2),a(),_(13,ge,5,3,"div",30,h),g(15,he,3,2),a()(),c(16,"div",10),g(17,_e,2,0,"button",11),c(18,"button",12),S("click",function(){E(e);let i=m();return y(i.cancel())}),l(19," Cancel "),a(),c(20,"button",13),S("click",function(){E(e);let i=m();return y(i.saveExerciseLog())}),l(21," Save "),a(),g(22,be,16,5),a()()}if(t&2){let e=m();s(3),f(" ",e.mode==="edit"?"Edit":"Create"," Log "),s(5),p("formControl",e.createOrUpdateLogFormGroup.controls.date),s(3),p("items",e.exerciseLogService.exercises)("control",e.createOrUpdateLogFormGroup.controls.exercise)("itemSelector",e.exerciseSelector),s(1),x(12,e.createOrUpdateLogFormGroup.controls.exercise.pristine?-1:12),s(1),v(e.createOrUpdateLogFormGroup.controls.series.controls),s(2),x(15,e.createOrUpdateLogFormGroup.controls.series.pristine?-1:15),s(1),p("ngClass",M(12,Ce,e.mode==="edit")),s(1),x(17,e.mode==="edit"?17:-1),s(3),p("ngClass",P(14,Ee,e.createOrUpdateLogFormGroup.valid,e.createOrUpdateLogFormGroup.invalid))("disabled",e.createOrUpdateLogFormGroup.invalid),s(2),x(22,e.mode==="edit"?22:-1)}}function Se(t,o){t&1&&(c(0,"div",31)(1,"div",32)(2,"span",33),l(3,"Loading..."),a()()())}var He=(()=>{let o=class o{constructor(){this.exerciseLogService=d(H),this.location=d(V),this.router=d(R),this.toastService=d(se),this.authService=d(ce),this.exerciseLogApiService=d(q),this.titleCasePipe=d(A),this.dayjsService=d(z),this.dayjs=this.dayjsService.instance,this.route=d(B),this.modalService=d(oe),this.mode=null,this.createOrUpdateLogFormGroup=null,this.originalValue=I(null),this.isLoading=I(!1),this.exerciseSelector=r=>typeof r=="string"?"":this.titleCasePipe.transform(r?.name)??"",this.route.url.pipe(j()).subscribe(r=>{if(this.createOrUpdateLogFormGroup=le(),r.some(n=>n.path===C.LOGS_CREATE)){this.mode="create";let n=this.dayjs().format("YYYY-MM-DD");this.createOrUpdateLogFormGroup.controls.date.patchValue(n)}else this.initEditMode()})}openDeleteModal(){let r=this.modalService.open(de,{centered:!0}),i=r.componentInstance;i.title="Delete Record",i.subtitle="<strong>Are you sure you want to delete this record?</strong>",i.body='This record will be permanently deleted. <span class="text-danger">This operation can not be undone.</span>',i.okType="danger",r.closed.pipe(F(1)).subscribe(()=>{this.exerciseLogService.deleteLog$.next(this.originalValue())})}saveExerciseLog(){this.isLoading.set(!0),this.mode==="create"?this.createExerciseLog():this.updateExerciseLog(this.originalValue())}cancel(){this.exerciseLogService.refreshLogs$.pipe(F(1)).subscribe(()=>{this.location.back()}),this.exerciseLogService.refreshLogs$.next()}createExerciseLog(){if(this.createOrUpdateLogFormGroup.invalid||typeof this.createOrUpdateLogFormGroup.value.exercise=="string")return;let r=this.authService.user(),i={exerciseLog:{exerciseLogUsername:r?.name??this.createOrUpdateLogFormGroup.value.user.toLocaleLowerCase(),exerciseLogUserId:r?.userId,exerciseLogExerciseId:this.createOrUpdateLogFormGroup.value.exercise.exerciseId,exerciseLogDate:this.dayjsService.parseDate(this.createOrUpdateLogFormGroup.value.date).format("YYYY-MM-DD"),series:(this.createOrUpdateLogFormGroup.value.series??[]).filter(n=>!!n.reps&&!!n.weightInKg).map(n=>({exerciseLogId:n.exerciseLogId,serieId:n.serieId,reps:+n.reps,weightInKg:+n.weightInKg.toFixed(1),brzycki:null}))}};this.exerciseLogApiService.createExerciseLog(i).subscribe({next:n=>{this.createOrUpdateLogFormGroup.reset(),localStorage.removeItem(N),this.toastService.ok("Log created successfully!"),this.router.navigate([C.LOGS,C.LOGS_EDIT,n])},error:()=>{this.toastService.error()}})}updateExerciseLog(r){if(this.createOrUpdateLogFormGroup.invalid||typeof this.createOrUpdateLogFormGroup.value.exercise=="string")return;let i=this.authService.user(),n={id:r?.id,exerciseLog:{exerciseLogUsername:i?.name??this.createOrUpdateLogFormGroup.value.user.toLocaleLowerCase(),exerciseLogUserId:i?.userId,exerciseLogExerciseId:this.createOrUpdateLogFormGroup.value.exercise.exerciseId,exerciseLogDate:this.dayjsService.parseDate(this.createOrUpdateLogFormGroup.value.date).format("YYYY-MM-DD"),series:(this.createOrUpdateLogFormGroup.value.series??[]).filter(u=>!!u.reps&&!!u.weightInKg).map(u=>({exerciseLogId:u.exerciseLogId,serieId:u.serieId,reps:+u.reps,weightInKg:+u.weightInKg.toFixed(1),brzycki:null}))}};this.exerciseLogApiService.updateExerciseLog(n).subscribe({next:()=>{this.createOrUpdateLogFormGroup.reset(),this.toastService.ok("Log updated successfully!"),this.initEditMode()},error:()=>{this.toastService.error()}})}initEditMode(){this.isLoading.set(!0);let r=Number(this.route.snapshot.paramMap.get(C.LOGS_ID_PARAM));this.mode="edit",this.exerciseLogApiService.getExerciseLogById(r).subscribe(i=>{this.originalValue.set(i),this.createOrUpdateLogFormGroup.reset(),this.createOrUpdateLogFormGroup.patchValue({exercise:i.exercise,date:this.dayjsService.parseDate(i.date).format("YYYY-MM-DD"),user:i.user.name,series:i.series.map(n=>({exerciseLogId:n.exerciseLogId,serieId:n.serieId,reps:n.reps,weightInKg:n.weightInKg}))}),this.isLoading.set(!1)})}};o.\u0275fac=function(i){return new(i||o)},o.\u0275cmp=w({type:o,selectors:[["edit-exercise-log-page"]],standalone:!0,features:[D],decls:2,vars:1,consts:[["class","footer-padding"],[1,"footer-padding"],[1,"modal-header"],["id","modal-basic-title",1,"modal-title"],[1,"modal-body"],["type","text","autofocus","autofocus",2,"display","none"],[1,"mb-3"],["type","date","placeholder","DD-MM-YYYY","placeholder","Reps",1,"form-control",3,"formControl"],[1,"input-group"],["placeholder","Exercise",3,"items","control","itemSelector"],[1,"modal-footer",3,"ngClass"],["type","button","class","btn btn-danger me-auto"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn",3,"ngClass","disabled","click"],[1,"d-block","invalid-feedback"],["class","d-block invalid-feedback"],[1,"input-group","mb-2","align-items-center"],[1,"input-group-text"],["type","number","placeholder","Reps",1,"form-control",3,"formControl"],["type","number","placeholder","Kg",1,"form-control",3,"formControl"],["type","button",1,"btn","btn-danger","me-auto",3,"click"],[1,"pt-5","w-100"],[1,"pb-2"],[1,"pt-3","w-100"],[1,"list-group","list-group-horizontal","pb-1"],[1,"list-group-item","active"],[1,"list-group-item"],[1,"w-100",3,"exerciseLog"],["class","w-100",3,"exerciseLog"],["class","list-group list-group-horizontal pb-1"],["class","input-group mb-2 align-items-center"],[1,"position-absolute","top-50","start-50","translate-middle"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"]],template:function(i,n){i&1&&g(0,ye,23,17,"div",0)(1,Se,4,0),i&2&&x(0,n.isLoading()?1:0)},dependencies:[re,Z,J,ee,Q,W,te,ie,X,ne,ae,pe,K,$,Y],styles:["[_nghost-%COMP%]{display:block;padding:0 .5rem;--bs-heading-color: white;--bs-modal-color: white;--bs-body-bg: var(--light-bg);--bs-body-color: var(--font-color);--bs-tertiary-bg: var(--primary);--bs-border-width: 0;--bs-modal-footer-border-width: 0;--bs-modal-header-border-width: 0;--bs-modal-header-padding: .5rem}.list-group[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 3fr;--bs-list-group-bg: var(--light-bg)}.list-group[_ngcontent-%COMP%]   .active[_ngcontent-%COMP%]{--bs-list-group-active-bg: var(--primary)}"],changeDetection:0});let t=o;return t})();export{He as EditExerciseLogPageComponent};
