import{a as _e}from"./chunk-LJA7ROG2.js";import{a as be}from"./chunk-BEQUACTT.js";import"./chunk-PS5GMNRX.js";import{a as ve,b as Se}from"./chunk-GRZV46BF.js";import{a as Ce}from"./chunk-HW3RVAJU.js";import{c as te,d as re,k as me,m as ue,n as he,p as fe,q as xe,w}from"./chunk-6PXCT3Y7.js";import{A as pe,I as ge,b as j,d as ne,e as oe,g as ae,l as se,n as le,p as de,q as ce}from"./chunk-FDMSHLJI.js";import{$b as E,Ac as J,Bb as v,Cb as I,Db as M,Eb as V,Fb as s,Gb as a,Hb as S,Ia as G,Jc as Q,Ka as o,Kb as K,Mb as F,Nb as u,Nc as Z,Pc as ee,Qc as ie,R as z,Ya as d,Yb as m,_b as P,ac as y,bc as L,cc as O,dc as X,ec as A,ib as N,jc as T,lc as R,ma as h,mc as W,nb as b,t as q,ua as x,va as _,wb as C,wc as $,x as D,xc as B,yb as H,yc as k,zc as U}from"./chunk-SEHCXKDS.js";function Ee(){return{user:o(null),exercise:o(null),date:o(""),series:o([o({serieId:null,reps:o(null),weightInKg:o(null)}),o({serieId:null,reps:o(null),weightInKg:o(null)}),o({serieId:null,reps:o(null),weightInKg:o(null)}),o({serieId:null,reps:o(null),weightInKg:o(null)}),o({serieId:null,reps:o(null),weightInKg:o(null)})])}}function ye(t,c){t&1&&(s(0,"div",14),S(1,"i",22),m(2," You have unsaved changes "),a())}function Le(t,c){if(t&1){let e=K();s(0,"div",15)(1,"div",23)(2,"div",24)(3,"input",25),L("ngModelChange",function(r){let n=x(e).$implicit;return y(n().reps,r)||(n().reps=r),_(r)}),a()(),s(4,"div",24)(5,"input",26),L("ngModelChange",function(r){let n=x(e).$implicit;return y(n().weightInKg,r)||(n().weightInKg=r),_(r)}),a()()()()}if(t&2){let e=c.$implicit,i=u(2);d(3),E("ngModel",e().reps),C("disabled",!i.formEnabled()),d(2),E("ngModel",e().weightInKg),C("disabled",!i.formEnabled())}}function we(t,c){t&1&&S(0,"i",20)}function Ie(t,c){t&1&&(S(0,"span",27),s(1,"span",28),m(2,"Loading..."),a())}function Me(t,c){if(t&1&&S(0,"app-exercise-log",32),t&2){let e=c.$implicit;C("exerciseLog",e)}}function Ve(t,c){if(t&1&&(s(0,"div",29)(1,"div",30)(2,"div",31),m(3,"Previous entries"),a(),M(4,Me,1,1,"app-exercise-log",32,I),T(6,"slice"),a()()),t&2){u(2);let e=A(30);d(4),V(W(6,0,e.recentLogs,0,3))}}function Pe(t,c){if(t&1&&S(0,"app-exercise-log",32),t&2){let e=c.$implicit;C("exerciseLog",e)}}function Te(t,c){if(t&1&&(s(0,"div",29)(1,"div",30)(2,"div",31),m(3,"Recently Updated"),a(),M(4,Pe,1,1,"app-exercise-log",32,I),T(6,"slice"),a()()),t&2){let e=u(3);d(4),V(W(6,0,e.exerciseLogApiService.recentlyUpdated(),0,3))}}function ke(t,c){if(t&1&&(s(0,"span",33),m(1),a(),s(2,"ul",34)(3,"li",35),m(4),T(5,"number"),a()()),t&2){let e=c.$implicit,i=c.$index;d(),P("Serie ",i+1,""),d(3),P("",R(5,2,e.brzycki,"1.2-2"),"kg")}}function De(t,c){if(t&1&&(s(0,"div",29)(1,"div",30)(2,"div",31),m(3,"Possible 1RM (Brzycky Formula)"),a(),M(4,ke,6,5,null,null,I),s(6,"span",33),m(7,"Average"),a(),s(8,"ul",34)(9,"li",35),m(10),T(11,"number"),a()()()()),t&2){u(2);let e=A(30);d(4),V(e.series),d(6),P("",R(11,1,e.brzyckiAverage,"1.2-2"),"kg")}}function Ke(t,c){if(t&1&&b(0,Ve,7,4,"div",29)(1,Te,7,4,"div",29)(2,De,12,4,"div",29),t&2){u();let e=A(30),i=u();v(e?0:-1),d(),v(i.exerciseLogApiService.recentlyUpdated().length?1:-1),d(),v(e?2:-1)}}function Fe(t,c){if(t&1){let e=K();s(0,"button",36),F("click",function(){x(e);let r=u(2);return _(r.openDeleteModal())}),S(1,"i",37),s(2,"span"),m(3,"Delete"),a()()}}function Ae(t,c){if(t&1){let e=K();s(0,"div",0)(1,"div",2)(2,"div",3)(3,"h4",4),m(4),a(),s(5,"span",5),m(6,"Record your workout details and progress"),a()(),s(7,"div"),S(8,"input",6),s(9,"div",7)(10,"input",8),L("ngModelChange",function(r){x(e);let n=u();return y(n.formSignal.date,r)||(n.formSignal.date=r),_(r)}),a()(),s(11,"div",9)(12,"app-typeahead",10),L("valueChange",function(r){x(e);let n=u();return y(n.formSignal.user,r)||(n.formSignal.user=r),_(r)}),a()(),s(13,"div",11)(14,"div",12)(15,"app-typeahead",13),L("valueChange",function(r){x(e);let n=u();return y(n.formSignal.exercise,r)||(n.formSignal.exercise=r),_(r)}),a()()(),b(16,ye,3,0,"div",14),O(17),s(18,"div",11),M(19,Le,6,4,"div",15,I),a()(),s(21,"div",16)(22,"div",17)(23,"button",18),F("click",function(){x(e);let r=u();return _(r.cancel())}),m(24," Cancel "),a()(),s(25,"div",17)(26,"button",19),F("click",function(){x(e);let r=u();return _(r.save())}),b(27,we,1,0,"i",20)(28,Ie,3,0),m(29," Save "),a()()(),O(30),b(31,Ke,3,3)(32,Fe,4,0,"button",21),a()()}if(t&2){let e=u();d(4),P("",e.mode()==="edit"?"Edit":"Create"," Exercise Log"),d(6),E("ngModel",e.formSignal.date),C("disabled",!e.formEnabled()),d(2),E("value",e.formSignal.user),C("items",e.users())("itemSelector",e.userSelector)("disabled",!e.formEnabled()),d(3),E("value",e.formSignal.exercise),C("items",e.exerciseApiService.exercises())("itemSelector",e.exerciseSelector)("disabled",!e.formEnabled()),d(),v(e.hasUnsavedChanges()?16:-1);let i=e.formSignal.series();d(3),V(i),d(7),H("btn-primary",e.formValid())("btn-secondary",!e.formValid()||!e.hasUnsavedChanges()),C("disabled",!e.formValid()||e.isSaveLoading()||!e.hasUnsavedChanges()),d(),v(e.isSaveLoading()?28:27),d(3),X(e.originalValue.value()),d(),v(e.mode()==="edit"?31:-1),d(),v(e.mode()==="edit"?32:-1)}}function Ue(t,c){t&1&&(s(0,"div",1)(1,"div",38)(2,"span",39),m(3,"Loading..."),a()()())}var _i=(()=>{class t{constructor(){this.exerciseLogId=G(null,{alias:"id",transform:$}),this.authService=h(fe),this.exerciseLogApiService=h(Ce),this.exerciseApiService=h(ue),this.location=h(Q),this.router=h(re),this.toastService=h(he),this.titleCasePipe=h(Z),this.dayjsService=h(Se),this.dayjs=this.dayjsService.instance,this.route=h(te),this.modalService=h(pe),this.isSaveLoading=o(!1),this.isLoading=J(()=>this.originalValue.isLoading()),this.paramMap=j(this.route.paramMap),this.url=j(this.route.url,{initialValue:[]}),this.mode=k(()=>this.url().some(e=>e.path===w.CREATE)?"create":"edit"),this.formSignal=Ee(),this.formValid=k(()=>!0),this.formValue=k(()=>({user:this.formSignal.user(),exercise:this.formSignal.exercise(),date:this.formSignal.date(),series:this.formSignal.series()})),this.formEnabled=o(!1),this.userSelector=e=>e?.name??"",this.exerciseSelector=e=>this.titleCasePipe.transform(e?.name)??"",this.users=k(()=>{let e=this.authService.user();return[e,...e?.assignedUsers??[]]}),this.originalValue=ne({request:this.exerciseLogId,loader:({request:e})=>e?this.exerciseLogApiService.getExerciseLogById(e):q(null)}),this.#e=U(()=>{this.originalValue.error()&&this.router.navigate([w.HOME])}),this.#i=U(()=>{let e=this.mode(),i=this.originalValue.value(),{user:r}=B(()=>({user:this.authService.user()}));e==="create"&&B(()=>{let n=this.dayjs().format("YYYY-MM-DD");this.formSignal.date.set(n),this.formSignal.user.set(r)}),e==="edit"&&i&&(this.formSignal.exercise.set(i.exercise),this.formSignal.date.set(this.dayjsService.parseDate(i.date).format("YYYY-MM-DD")),this.formSignal.user.set(i.user),this.formSignal.series.update(n=>{for(let p=0;p<n.length;p++)n[p]?.set({serieId:i.series[p]?.serieId??null,reps:o(i.series[p]?.reps??null),weightInKg:o(i.series[p]?.weightInKg??null)});return n}))}),this.hasUnsavedChanges=o(!1),this.#t=U(()=>{let e=this.formValue();if(!e.user){this.hasUnsavedChanges.set(!1);return}let i=this.originalValue.value(),r=this.mode(),n=i?.series.map(g=>({reps:g.reps,weightInKg:g.weightInKg,serieId:g.serieId}))??[],p=e.series.map(g=>g()).filter(g=>!!g.reps()||!!g.weightInKg()).map(g=>({serieId:g.serieId,reps:g.reps(),weightInKg:g.weightInKg()})),Y=r==="edit"&&!me(n,p)||i?.exercise.exerciseId!==e.exercise?.exerciseId||i?.user.userId!==e.user.userId||this.dayjs(i?.date).unix()!==this.dayjs(e.date).unix();this.hasUnsavedChanges.set(Y)})}#e;#i;#t;openDeleteModal(){let e=this.modalService.open(xe,{centered:!0});e.componentInstance.configurate({title:"Delete Record",subtitle:"<strong>Are you sure you want to delete this record?</strong>",body:'This record will be permanently deleted. <span class="text-danger">This operation can not be undone.</span>',okType:"danger"}),e.closed.pipe(z(1)).subscribe(async()=>{let r=this.originalValue.value();if(r)try{await D(this.exerciseLogApiService.deleteExerciseLog(r.id)),this.toastService.ok("Log deleted successfully!"),this.router.navigate([w.HOME])}catch(n){let p=n;this.toastService.error(`${p.message}`)}})}async save(){let e=this.mode();this.isSaveLoading.set(!0);let i=this.formSignal.user(),r=this.formSignal.exercise(),n=this.dayjsService.parseDate(this.formSignal.date());if(!i)throw new Error("User cannot be null");if(this.formValid()&&typeof r!="string"&&r&&typeof i!="string"&&i){if(this.formEnabled.set(!0),e==="create"){let p=this.formSignal.series().map(l=>{let f=l();return{exerciseLogId:this.exerciseLogId(),serieId:f.serieId,reps:f.reps(),weightInKg:f.weightInKg(),brzycki:0}}),g={seriesIdsToDelete:p.filter(l=>!l.reps||!l.weightInKg).filter(l=>!!l.serieId).map(l=>l.serieId),exerciseLog:{exerciseLogUsername:i?.name,exerciseLogUserId:i.userId,exerciseLogExerciseId:r.exerciseId??void 0,exerciseLogDate:n.format("YYYY-MM-DD"),series:p}};try{let l=await D(this.exerciseLogApiService.createExerciseLog(g));localStorage.removeItem(ve),this.toastService.ok("Log created successfully!"),this.router.navigate([w.EXERCISE_LOGS,w.EDIT,l])}catch(l){this.toastService.error(`${l}`)}}if(e==="edit"){let p=this.formSignal.series().map(l=>{let f=l();return{exerciseLogId:this.exerciseLogId(),serieId:f.serieId,reps:f.reps(),weightInKg:f.weightInKg(),brzycki:0}}),g={seriesIdsToDelete:p.filter(l=>!l.reps||!l.weightInKg).filter(l=>!!l.serieId).map(l=>l.serieId),id:this.exerciseLogId(),exerciseLog:{exerciseLogUsername:i?.name,exerciseLogUserId:i.userId,exerciseLogExerciseId:r.exerciseId??void 0,exerciseLogDate:n.format("YYYY-MM-DD"),series:p}};try{await D(this.exerciseLogApiService.updateExerciseLog(g)),this.toastService.ok("Log updated successfully!"),this.originalValue.reload()}catch(l){let f=l;this.toastService.error(`${f.message}`)}}}this.isSaveLoading.set(!1),this.formEnabled.set(!1)}cancel(){this.location.back()}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=N({type:t,selectors:[["edit-exercise-log-page"]],inputs:{exerciseLogId:[1,"id","exerciseLogId"]},decls:2,vars:1,consts:[[1,"header-footer-padding"],[1,"position-absolute","top-50","start-50","translate-middle"],[1,"container"],[1,"pb-3"],[1,"title"],[1,"subtitle"],["type","text","autofocus","autofocus",2,"display","none"],[1,"mb-2"],["type","date","placeholder","DD-MM-YYYY",1,"form-control",3,"ngModelChange","ngModel","disabled"],[1,"col-12","mb-2"],["placeholder","User",3,"valueChange","value","items","itemSelector","disabled"],[1,"mb-3"],[1,"input-group"],["placeholder","Exercise",3,"valueChange","value","items","itemSelector","disabled"],[1,"mb-2","px-2"],[1,"pb-1"],[1,"row","g-2","mb-5"],[1,"col"],["type","button",1,"btn","btn-secondary","w-100",3,"click"],["type","button",1,"btn","w-100","d-flex","justify-content-center","align-items-center",3,"click","disabled"],["aria-hidden","true",1,"fa","fa-save","px-2"],["type","button",1,"btn","btn-danger","w-100","delete-button"],["aria-hidden","true",1,"fa","fa-exclamation-circle"],[1,"row","g-2"],[1,"col-6"],["type","number","placeholder","Reps",1,"form-control",3,"ngModelChange","ngModel","disabled"],["type","number","placeholder","Weight (Kg)",1,"form-control",3,"ngModelChange","ngModel","disabled"],["aria-hidden","true",1,"spinner-border","spinner-border-sm","mx-2"],["role","status",1,"visually-hidden"],[1,"card","mb-3"],[1,"card-body"],[1,"card-title"],[1,"w-100",3,"exerciseLog"],[1,"serie-label"],[1,"list-group","list-group-horizontal","pb-1"],[1,"list-group-item","w-100"],["type","button",1,"btn","btn-danger","w-100","delete-button",3,"click"],["aria-hidden","true",1,"fa","fa-trash","px-2"],["role","status",1,"robertly-spinner","spinner-border","text-primary"],[1,"visually-hidden"]],template:function(i,r){i&1&&b(0,Ae,33,21,"div",0)(1,Ue,4,0,"div",1),i&2&&v(r.isLoading()?1:0)},dependencies:[ce,oe,le,ae,de,se,ge,_e,be,ee,ie],styles:["[_nghost-%COMP%]{--bs-body-bg: var(--light-bg);--bs-body-color: var(--font-color);--bs-tertiary-bg: var(--primary);--bs-border-width: 1px;--bs-border-color: rgba(255, 255, 255, .15)}.card[_ngcontent-%COMP%]{--bs-card-spacer-y: .5rem;--bs-card-spacer-x: .5rem}.title[_ngcontent-%COMP%]{margin:0}.subtitle[_ngcontent-%COMP%]{font-size:14px;opacity:.7}.card[_ngcontent-%COMP%]{background-color:var(--bg);border:1px solid rgba(255,255,255,.1)}.serie-label[_ngcontent-%COMP%]{font-size:12px;color:#ffffffbf;padding:0 .5rem}.delete-button[_ngcontent-%COMP%]{background-color:#301b23;--bs-btn-border-color: #6e363b;color:#fa8989}"],changeDetection:0})}}return t})();export{_i as EditExerciseLogPageComponent};
