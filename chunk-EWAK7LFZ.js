import{a as ke}from"./chunk-UKUMXKLG.js";import{A as he,B as ve,I as fe,U as Ce,X as Le,Z as be,_ as Ee,a as ne,aa as ye,b as ae,ca as Se,d as j,da as G,ea as Ie,fa as F,k as se,n as ce,o as le,p as de,r as pe,s as me,u as ue,x as ge,y as xe,z as _e}from"./chunk-J2K6ZHDB.js";import{f as ee,h as te,j as ie,l as oe,m as re}from"./chunk-ETB5LIMF.js";import{$b as J,Ab as y,Ac as $,Bb as s,Bc as N,Cb as n,Da as T,Db as _,Ea as D,Gb as Y,Kb as M,Lb as h,T as O,Tb as c,Ub as A,Vb as S,_a as a,a as K,ac as Q,b as q,bc as X,cc as Z,da as H,ec as k,fc as B,g as z,gc as R,hb as L,mb as v,qa as d,rb as x,ta as W,wb as f,xb as b,z as w,zb as E,zc as P}from"./chunk-L7ZHVRLB.js";var Fe=e=>({"justify-content-between":e}),we=(e,i)=>({"btn-primary":e,"btn-secondary":i}),Te=()=>[];function De(e,i){if(e&1&&(s(0,"div",19),c(1),n()),e&2){let t=i.$implicit;a(),A(t.value)}}function Me(e,i){if(e&1&&(E(0,De,2,1,"div",19,b),k(2,"keyvalue")),e&2){let t,o=h(2);y(B(2,0,(t=o.createOrUpdateLogFormGroup().errors)==null?null:t.exercise))}}function Pe(e,i){e&1&&(s(0,"div",13),_(1,"i",20),c(2," You have unsaved changes "),n())}function Ge(e,i){if(e&1&&(s(0,"div",14)(1,"span",21),c(2),n(),_(3,"input",22)(4,"input",23),n()),e&2){let t=i.$implicit,o=i.$index;a(2),S("Serie ",o+1,""),a(),x("formControl",t.controls.reps),a(),x("formControl",t.controls.weightInKg)}}function Ue(e,i){if(e&1&&(s(0,"div",19),c(1),n()),e&2){let t=i.$implicit;a(),A(t.value)}}function Ve(e,i){if(e&1&&(E(0,Ue,2,1,"div",19,b),k(2,"keyvalue")),e&2){let t,o=h(2);y(B(2,0,(t=o.createOrUpdateLogFormGroup().errors)==null?null:t.series))}}function Oe(e,i){if(e&1){let t=Y();s(0,"button",24),M("click",function(){T(t);let r=h(2);return D(r.openDeleteModal())}),c(1," Delete "),n()}}function Ye(e,i){if(e&1&&_(0,"app-exercise-log",27),e&2){let t=i.$implicit;x("exerciseLog",t)}}function Ae(e,i){if(e&1&&(s(0,"ul",29)(1,"li",30),c(2),n(),s(3,"li",31),c(4),k(5,"number"),n()()),e&2){let t=i.$implicit,o=i.$index;a(2),S("Serie ",o+1,""),a(2),S("",R(5,2,t.brzycki,"1.2-2"),"kg")}}function Be(e,i){if(e&1&&(s(0,"div",25)(1,"div",26),c(2,"Previous entries"),n(),E(3,Ye,1,1,"app-exercise-log",27,b),n(),s(5,"div",28)(6,"div",26),c(7,"Possible 1RM (Brzycky Formula)"),n(),E(8,Ae,6,5,"ul",29,b),s(10,"ul",29)(11,"li",30),c(12,"Average"),n(),s(13,"li",31),c(14),k(15,"number"),n()()()),e&2){let t,o,r,l=h(2);a(3),y((t=(t=l.originalValue())==null?null:t.recentLogs)!==null&&t!==void 0?t:Q(4,Te)),a(5),y((o=l.originalValue())==null?null:o.series),a(6),S("",R(15,1,(r=l.originalValue())==null?null:r.brzyckiAverage,"1.2-2"),"kg")}}function Re(e,i){if(e&1){let t=Y();s(0,"div",1)(1,"div",3)(2,"h4",4),c(3),n()(),s(4,"div",5)(5,"form"),_(6,"input",6),s(7,"div",7),_(8,"input",8),n(),s(9,"div",7),_(10,"input",9),n(),s(11,"div",10)(12,"div",11),_(13,"app-typeahead",12),n(),v(14,Me,3,2),n(),v(15,Pe,3,0,"div",13),E(16,Ge,5,3,"div",14,b),v(18,Ve,3,2),n()(),s(19,"div",15),v(20,Oe,2,0,"button",16),s(21,"button",17),M("click",function(){T(t);let r=h();return D(r.cancel())}),c(22," Cancel "),n(),s(23,"button",18,0),M("click",function(){T(t);let r=h();return D(r.saveButtonClicked.set(!0))}),c(25," Save "),n(),v(26,Be,16,5),n()()}if(e&2){let t=h();a(3),S(" ",t.mode()==="edit"?"Edit":"Create"," Log "),a(5),x("formControl",t.createOrUpdateLogFormGroup().controls.date),a(2),x("formControl",t.createOrUpdateLogFormGroup().controls.user),a(3),x("items",t.exerciseLogService.exercises)("control",t.createOrUpdateLogFormGroup().controls.exercise)("itemSelector",t.exerciseSelector),a(),f(t.createOrUpdateLogFormGroup().controls.exercise.pristine?-1:14),a(),f(t.hasUnsavedChanges()?15:-1),a(),y(t.createOrUpdateLogFormGroup().controls.series.controls),a(2),f(t.createOrUpdateLogFormGroup().controls.series.pristine?-1:18),a(),x("ngClass",X(14,Fe,t.mode()==="edit")),a(),f(t.mode()==="edit"?20:-1),a(3),x("ngClass",Z(16,we,t.createOrUpdateLogFormGroup().valid,t.createOrUpdateLogFormGroup().invalid))("disabled",t.createOrUpdateLogFormGroup().invalid),a(3),f(t.mode()==="edit"?26:-1)}}function $e(e,i){e&1&&(s(0,"div",2)(1,"div",32)(2,"span",33),c(3,"Loading..."),n()()())}var ht=(()=>{let i=class i{constructor(){this.exerciseLogService=d(le),this.location=d(ee),this.router=d(ae),this.toastService=d(ye),this.authService=d(Se),this.exerciseLogApiService=d(ce),this.titleCasePipe=d(ie),this.dayjsService=d(be),this.dayjs=this.dayjsService.instance,this.route=d(ne),this.modalService=d(fe),this.originalValue=L(null),this.isLoading=L(!1),this.saveButtonClicked=L(!1),this.paramMap=j(this.route.paramMap),this.exerciseLogId=P(()=>this.paramMap()?.get(F.LOGS_ID_PARAM)),this.url=j(this.route.url,{initialValue:[]}),this.mode=P(()=>this.url().some(o=>o.path===F.LOGS_CREATE)?"create":"edit"),this.createOrUpdateLogFormGroup=P(()=>{let o=this.mode(),r=this.updateLogFormGroup(),l=G();if(o==="create"){let g=this.dayjs().format("YYYY-MM-DD");return l.controls.date.patchValue(g),l}return o==="edit"?r:l}),this.hasUnsavedChanges=L(!1),this.exerciseSelector=o=>typeof o=="string"?"":this.titleCasePipe.transform(o?.name)??"",this.updateLogFormGroup=L(G()),N(o=>{let r=this.createOrUpdateLogFormGroup(),l=this.originalValue();$(()=>{let g=r.valueChanges.pipe(H(null)).subscribe(p=>{if(!p){this.hasUnsavedChanges.set(!1);return}let m={series:U(l?.series.map(u=>q(K({},u),{brzycki:null})))??[]},C={series:U(p.series)};this.hasUnsavedChanges.set(!se(m,C))});o(()=>g.unsubscribe())})}),N(()=>{let o=this.saveButtonClicked(),r=this.exerciseLogId();$(()=>z(this,null,function*(){let l=this.mode(),g=this.createOrUpdateLogFormGroup();if(this.isLoading.set(!0),o){let p=g.value.exercise,m=this.dayjsService.parseDate(g.value.date),C=this.originalValue(),u=this.authService.user();if(!u)throw new Error("User cannot be null");if(g.valid&&typeof p!="string"&&p)if(l==="create"){let V=Ne(g,u,p,m);try{let I=yield w(this.exerciseLogApiService.createExerciseLog(V));localStorage.removeItem(Le),this.toastService.ok("Log created successfully!"),this.router.navigate([F.LOGS,F.LOGS_EDIT,I])}catch(I){this.toastService.error(`${I}`)}}else{let V=Ke(C?.id,g,u,p,m);try{yield w(this.exerciseLogApiService.updateExerciseLog(V)),this.toastService.ok("Log updated successfully!")}catch(I){this.toastService.error(`${I}`)}}}else{let p=Number(r);if(p){let m=yield w(this.exerciseLogApiService.getExerciseLogById(p)),C=G();this.originalValue.set(m),C.patchValue({exercise:m.exercise,date:this.dayjsService.parseDate(m.date).format("YYYY-MM-DD"),user:m.user.name,series:m.series.map(u=>({exerciseLogId:u.exerciseLogId,serieId:u.serieId,reps:u.reps,weightInKg:u.weightInKg}))}),this.updateLogFormGroup.set(C)}}this.saveButtonClicked.set(!1),this.isLoading.set(!1)}))})}openDeleteModal(){let o=this.modalService.open(Ie,{centered:!0}),r=o.componentInstance;r.title="Delete Record",r.subtitle="<strong>Are you sure you want to delete this record?</strong>",r.body='This record will be permanently deleted. <span class="text-danger">This operation can not be undone.</span>',r.okType="danger",o.closed.pipe(O(1)).subscribe(()=>{this.exerciseLogService.deleteLog$.next(this.originalValue())})}cancel(){this.exerciseLogService.refreshLogs$.pipe(O(1)).subscribe(()=>{this.location.back()}),this.exerciseLogService.refreshLogs$.next()}};i.\u0275fac=function(r){return new(r||i)},i.\u0275cmp=W({type:i,selectors:[["edit-exercise-log-page"]],standalone:!0,features:[J],decls:2,vars:1,consts:[["saveButton",""],[1,"footer-padding"],[1,"position-absolute","top-50","start-50","translate-middle"],[1,"modal-header"],["id","modal-basic-title",1,"modal-title"],[1,"modal-body"],["type","text","autofocus","autofocus",2,"display","none"],[1,"mb-2"],["type","date","placeholder","DD-MM-YYYY",1,"form-control",3,"formControl"],["type","text","placeholder","User",1,"form-control",3,"formControl"],[1,"mb-3"],[1,"input-group"],["placeholder","Exercise",3,"items","control","itemSelector"],[1,"mb-2","px-2"],[1,"input-group","mb-2","align-items-center"],[1,"modal-footer",3,"ngClass"],["type","button",1,"btn","btn-danger","me-auto"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn",3,"click","ngClass","disabled"],[1,"d-block","invalid-feedback"],["aria-hidden","true",1,"fa","fa-exclamation-circle"],[1,"input-group-text"],["type","number","placeholder","Reps",1,"form-control",3,"formControl"],["type","number","placeholder","Kg",1,"form-control",3,"formControl"],["type","button",1,"btn","btn-danger","me-auto",3,"click"],[1,"pt-5","w-100"],[1,"pb-2"],[1,"w-100",3,"exerciseLog"],[1,"pt-3","w-100"],[1,"list-group","list-group-horizontal","pb-1"],[1,"list-group-item","active"],[1,"list-group-item"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"]],template:function(r,l){r&1&&v(0,Re,27,19,"div",1)(1,$e,4,0,"div",2),r&2&&f(l.isLoading()?1:0)},dependencies:[ve,ge,de,xe,pe,me,_e,he,ue,Ce,Ee,ke,oe,re,te],styles:["[_nghost-%COMP%]{display:block;padding:0 .5rem;--bs-heading-color: white;--bs-modal-color: white;--bs-body-bg: var(--light-bg);--bs-body-color: var(--font-color);--bs-tertiary-bg: var(--primary);--bs-border-width: 0;--bs-modal-footer-border-width: 0;--bs-modal-header-border-width: 0;--bs-modal-header-padding: .5rem}.list-group[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 3fr;--bs-list-group-bg: var(--light-bg)}.list-group[_ngcontent-%COMP%]   .active[_ngcontent-%COMP%]{--bs-list-group-active-bg: var(--primary)}"],changeDetection:0});let e=i;return e})();function Ne(e,i,t,o){return je(i?.userId,i?.name??e.value.user,t.exerciseId,o,U(e.value.series))}function je(e,i,t,o,r){return qe(null,e,i,t,o,r)}function Ke(e,i,t,o,r){return{id:e,exerciseLog:{exerciseLogUsername:t?.name??i.value.user.toLocaleLowerCase(),exerciseLogUserId:t.userId,exerciseLogExerciseId:o.exerciseId,exerciseLogDate:r.format("YYYY-MM-DD"),series:U(i.value.series)}}}function qe(e,i,t,o,r,l){return{id:e?.id,exerciseLog:{exerciseLogUsername:t.toLocaleLowerCase(),exerciseLogUserId:i,exerciseLogExerciseId:o,exerciseLogDate:r.format("YYYY-MM-DD"),series:l}}}function ze(e){return{exerciseLogId:e.exerciseLogId,serieId:e.serieId,reps:+e.reps,weightInKg:+e.weightInKg.toFixed(1),brzycki:null}}function U(e){return(e??[]).filter(i=>!!i.reps&&!!i.weightInKg).map(ze)}export{ht as EditExerciseLogPageComponent};
