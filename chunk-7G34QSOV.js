import{a as Ie}from"./chunk-JSAGN3LZ.js";import{a as ke}from"./chunk-YC5BC7BQ.js";import{b as Te,c as Pe}from"./chunk-7TAS5YYO.js";import{a as we}from"./chunk-Y4WFIIOI.js";import{c as ne,d as ae,k as Ee,m as Le,n as be,p as ye,q as Se,w as L}from"./chunk-QQUWNONX.js";import{B as he,J as Ce,b as A,d as se,e as ce,f as le,g as de,h as pe,i as R,j as me,k as _,m as ue,n as ge,o as xe,p as _e,q as fe,r as ve}from"./chunk-DWM6OEN4.js";import{Bb as g,Cb as v,Db as h,Eb as C,Fb as s,Gb as n,Hb as p,Hc as ee,Ka as V,Kb as q,Lc as te,Mb as M,Nb as m,Nc as ie,Oc as oe,Pc as re,R as W,Ya as a,Yb as l,Zb as B,_b as S,a as I,b as w,cc as $,dc as Q,ec as D,ib as X,jc as E,kc as K,lc as N,ma as u,mc as j,nb as f,t as H,ua as P,va as k,wb as x,wc as z,x as T,xc as F,yb as J,yc as G,zc as Z}from"./chunk-QHOELIAC.js";function b(){return new R({serieId:new _,exerciseLogId:new _,reps:new _,weightInKg:new _})}var Ve=t=>{let o=t,e=new Map;le.required(o.controls.exercise)&&e.set("exercise",w(I({},e.get("exercise")),{exerciseRequired:"Exercise is required"}));let r={};for(let[c,d]of e.entries())r[c]=d;return r};function Me(){return new R({user:new _(null),exercise:new _(null),date:new _(""),series:new _e([b(),b(),b(),b(),b()])},[Ve])}function Fe(t,o){if(t&1&&(s(0,"div",22),l(1),n()),t&2){let e=o.$implicit;a(),B(e.value)}}function Ge(t,o){if(t&1&&(h(0,Fe,2,1,"div",22,v),E(2,"keyvalue")),t&2){let e,i=m(2);C(K(2,0,(e=i.formGroup().errors)==null?null:e.exercise))}}function Ae(t,o){t&1&&(s(0,"div",14),p(1,"i",23),l(2," You have unsaved changes "),n())}function Re(t,o){if(t&1&&(s(0,"div",15)(1,"form",24)(2,"div",25),p(3,"input",26),n(),s(4,"div",25),p(5,"input",27),n()()()),t&2){let e=o.$implicit;a(3),x("formControl",e.controls.reps),a(2),x("formControl",e.controls.weightInKg)}}function Ue(t,o){if(t&1&&(s(0,"div",22),l(1),n()),t&2){let e=o.$implicit;a(),B(e.value)}}function Ye(t,o){if(t&1&&(h(0,Ue,2,1,"div",22,v),E(2,"keyvalue")),t&2){let e,i=m(2);C(K(2,0,(e=i.formGroup().errors)==null?null:e.series))}}function Oe(t,o){t&1&&p(0,"i",20)}function qe(t,o){t&1&&(p(0,"span",28),s(1,"span",29),l(2,"Loading..."),n())}function Be(t,o){if(t&1&&p(0,"app-exercise-log",33),t&2){let e=o.$implicit;x("exerciseLog",e)}}function $e(t,o){if(t&1&&(s(0,"div",30)(1,"div",31)(2,"div",32),l(3,"Previous entries"),n(),h(4,Be,1,1,"app-exercise-log",33,v),E(6,"slice"),n()()),t&2){m(2);let e=D(33);a(4),C(j(6,0,e.recentLogs,0,3))}}function Ke(t,o){if(t&1&&p(0,"app-exercise-log",33),t&2){let e=o.$implicit;x("exerciseLog",e)}}function Ne(t,o){if(t&1&&(s(0,"div",30)(1,"div",31)(2,"div",32),l(3,"Recently Updated"),n(),h(4,Ke,1,1,"app-exercise-log",33,v),E(6,"slice"),n()()),t&2){let e=m(3);a(4),C(j(6,0,e.exerciseLogApiService.recentlyUpdated(),0,3))}}function je(t,o){if(t&1&&(s(0,"span",34),l(1),n(),s(2,"ul",35)(3,"li",36),l(4),E(5,"number"),n()()),t&2){let e=o.$implicit,i=o.$index;a(),S("Serie ",i+1,""),a(3),S("",N(5,2,e.brzycki,"1.2-2"),"kg")}}function ze(t,o){if(t&1&&(s(0,"div",30)(1,"div",31)(2,"div",32),l(3,"Possible 1RM (Brzycky Formula)"),n(),h(4,je,6,5,null,null,v),s(6,"span",34),l(7,"Average"),n(),s(8,"ul",35)(9,"li",36),l(10),E(11,"number"),n()()()()),t&2){m(2);let e=D(33);a(4),C(e.series),a(6),S("",N(11,1,e.brzyckiAverage,"1.2-2"),"kg")}}function He(t,o){if(t&1&&f(0,$e,7,4,"div",30)(1,Ne,7,4,"div",30)(2,ze,12,4,"div",30),t&2){m();let e=D(33),i=m();g(e?0:-1),a(),g(i.exerciseLogApiService.recentlyUpdated().length?1:-1),a(),g(e?2:-1)}}function We(t,o){if(t&1){let e=q();s(0,"button",37),M("click",function(){P(e);let r=m(2);return k(r.openDeleteModal())}),p(1,"i",38),s(2,"span"),l(3,"Delete"),n()()}}function Xe(t,o){if(t&1){let e=q();s(0,"div",0)(1,"div",2)(2,"div",3)(3,"h4",4),l(4),n(),s(5,"span",5),l(6,"Record your workout details and progress"),n()(),s(7,"div")(8,"form"),p(9,"input",6),s(10,"div",7),p(11,"input",8),n(),s(12,"div",9),p(13,"app-typeahead",10),n(),s(14,"div",11)(15,"div",12),p(16,"app-typeahead",13),n(),f(17,Ge,3,2),n(),f(18,Ae,3,0,"div",14),$(19),s(20,"div",11),h(21,Re,6,2,"div",15,v),n(),f(23,Ye,3,2),n()(),s(24,"div",16)(25,"div",17)(26,"button",18),M("click",function(){P(e);let r=m();return k(r.cancel())}),l(27," Cancel "),n()(),s(28,"div",17)(29,"button",19),M("click",function(){P(e);let r=m();return k(r.save())}),f(30,Oe,1,0,"i",20)(31,qe,3,0),l(32," Save "),n()()(),$(33),f(34,He,3,3)(35,We,4,0,"button",21),n()()}if(t&2){let e=m();a(4),S("",e.mode()==="edit"?"Edit":"Create"," Exercise Log"),a(7),x("formControl",e.formGroup().controls.date),a(2),x("control",e.formGroup().controls.user)("items",e.users())("itemSelector",e.userSelector),a(3),x("control",e.formGroup().controls.exercise)("items",e.exerciseApiService.exercises())("itemSelector",e.exerciseSelector),a(),g(e.formGroup().controls.exercise.pristine?-1:17),a(),g(e.hasUnsavedChanges()?18:-1);let i=e.formGroup().controls.series;a(3),C(i.controls),a(2),g(i.pristine?-1:23),a(6),J("btn-primary",e.formGroup().valid)("btn-secondary",e.formGroup().invalid),x("disabled",e.formGroup().invalid||e.isSaveLoading()),a(),g(e.isSaveLoading()?31:30),a(3),Q(e.originalValue.value()),a(),g(e.mode()==="edit"?34:-1),a(),g(e.mode()==="edit"?35:-1)}}function Je(t,o){t&1&&(s(0,"div",1)(1,"div",39)(2,"span",40),l(3,"Loading..."),n()()())}var Gt=(()=>{class t{constructor(){this.authService=u(ye),this.exerciseLogApiService=u(we),this.exerciseApiService=u(Le),this.location=u(ee),this.router=u(ae),this.toastService=u(be),this.titleCasePipe=u(te),this.dayjsService=u(Pe),this.dayjs=this.dayjsService.instance,this.route=u(ne),this.modalService=u(he),this.isSaveLoading=V(!1),this.isLoading=Z(()=>this.originalValue.isLoading()),this.paramMap=A(this.route.paramMap),this.exerciseLogId=F(()=>this.paramMap()?.get(L.ID)),this.url=A(this.route.url,{initialValue:[]}),this.mode=F(()=>this.url().some(e=>e.path===L.CREATE)?"create":"edit"),this.formGroup=V(Me()),this.formGroupValue=A(this.formGroup().valueChanges),this.userSelector=e=>typeof e=="string"?"":e?.name??"",this.exerciseSelector=e=>typeof e=="string"?"":this.titleCasePipe.transform(e?.name)??"",this.users=F(()=>{let e=this.authService.user();return[e,...e?.assignedUsers??[]]}),this.originalValue=se({request:this.exerciseLogId,loader:({request:e})=>{let i=Number(e);return i?this.exerciseLogApiService.getExerciseLogById(i):H(null)}}),this.#e=G(()=>{this.originalValue.error()&&this.router.navigate([L.HOME])}),this.#t=G(()=>{let e=this.mode(),i=this.originalValue.value(),{user:r}=z(()=>({user:this.authService.user()}));e==="create"&&z(()=>{let c=this.dayjs().format("YYYY-MM-DD");this.formGroup.update(d=>(d.patchValue({date:c,user:r?.name??""}),d))}),e==="edit"&&i&&this.formGroup.update(c=>(c.reset(),c.patchValue({exercise:i.exercise,date:this.dayjsService.parseDate(i.date).format("YYYY-MM-DD"),user:i.user,series:i.series.map(d=>({exerciseLogId:d.exerciseLogId,serieId:d.serieId,reps:d.reps,weightInKg:d.weightInKg}))}),c))}),this.hasUnsavedChanges=V(!1),this.#i=G(()=>{let e=this.formGroupValue(),i=this.originalValue.value(),r=this.mode();if(!e){this.hasUnsavedChanges.set(!1);return}let c={series:U(i?.series.map(Y=>w(I({},Y),{brzycki:null})))??[]},d={series:U(e.series)};this.hasUnsavedChanges.set(r==="edit"&&!Ee(c,d))})}#e;#t;#i;openDeleteModal(){let e=this.modalService.open(Se,{centered:!0}),i=e.componentInstance;i.title.set("Delete Record"),i.subtitle.set("<strong>Are you sure you want to delete this record?</strong>"),i.body.set('This record will be permanently deleted. <span class="text-danger">This operation can not be undone.</span>'),i.okType.set("danger"),e.closed.pipe(W(1)).subscribe(async()=>{let r=this.originalValue.value();if(r)try{await T(this.exerciseLogApiService.deleteExerciseLog(r.id)),this.toastService.ok("Log deleted successfully!"),this.router.navigate([L.HOME])}catch(c){let d=c;this.toastService.error(`${d.message}`)}})}async save(){let e=this.mode(),i=this.formGroup();this.isSaveLoading.set(!0);let r=i.value.user,c=i.value.exercise,d=this.dayjsService.parseDate(i.value.date),Y=this.originalValue.value();if(!r)throw new Error("User cannot be null");if(i.valid&&typeof c!="string"&&c&&typeof r!="string"&&r){if(i.disable(),e==="create"){let O=Qe(i,r,c,d);try{let y=await T(this.exerciseLogApiService.createExerciseLog(O));localStorage.removeItem(Te),this.toastService.ok("Log created successfully!"),this.router.navigate([L.EXERCISE_LOGS,L.EDIT,y])}catch(y){this.toastService.error(`${y}`)}}if(e==="edit"){let O=et(Y?.id,i,r,c,d);try{await T(this.exerciseLogApiService.updateExerciseLog(O)),this.toastService.ok("Log updated successfully!"),this.originalValue.reload()}catch(y){let De=y;this.toastService.error(`${De.message}`)}}}this.isSaveLoading.set(!1),i.enable()}cancel(){this.location.back()}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=X({type:t,selectors:[["edit-exercise-log-page"]],decls:2,vars:1,consts:[[1,"header-footer-padding"],[1,"position-absolute","top-50","start-50","translate-middle"],[1,"container"],[1,"pb-3"],[1,"title"],[1,"subtitle"],["type","text","autofocus","autofocus",2,"display","none"],[1,"mb-2"],["type","date","placeholder","DD-MM-YYYY",1,"form-control",3,"formControl"],[1,"col-12","mb-2"],["placeholder","User",3,"control","items","itemSelector"],[1,"mb-3"],[1,"input-group"],["placeholder","Exercise",3,"control","items","itemSelector"],[1,"mb-2","px-2"],[1,"pb-1"],[1,"row","g-2","mb-5"],[1,"col"],["type","button",1,"btn","btn-secondary","w-100",3,"click"],["type","button",1,"btn","w-100","d-flex","justify-content-center","align-items-center",3,"click","disabled"],["aria-hidden","true",1,"fa","fa-save","px-2"],["type","button",1,"btn","btn-danger","w-100","delete-button"],[1,"d-block","invalid-feedback"],["aria-hidden","true",1,"fa","fa-exclamation-circle"],[1,"row","g-2"],[1,"col-6"],["type","number","placeholder","Reps",1,"form-control",3,"formControl"],["type","number","placeholder","Weight (Kg)",1,"form-control",3,"formControl"],["aria-hidden","true",1,"spinner-border","spinner-border-sm","mx-2"],["role","status",1,"visually-hidden"],[1,"card","mb-3"],[1,"card-body"],[1,"card-title"],[1,"w-100",3,"exerciseLog"],[1,"serie-label"],[1,"list-group","list-group-horizontal","pb-1"],[1,"list-group-item","w-100"],["type","button",1,"btn","btn-danger","w-100","delete-button",3,"click"],["aria-hidden","true",1,"fa","fa-trash","px-2"],["role","status",1,"robertly-spinner","spinner-border","text-primary"],[1,"visually-hidden"]],template:function(i,r){i&1&&f(0,Xe,36,20,"div",0)(1,Je,4,0,"div",1),i&2&&g(r.isLoading()?1:0)},dependencies:[ve,ue,ce,ge,de,pe,xe,fe,me,Ce,Ie,ke,ie,oe,re],styles:["[_nghost-%COMP%]{--bs-body-bg: var(--light-bg);--bs-body-color: var(--font-color);--bs-tertiary-bg: var(--primary);--bs-border-width: 1px;--bs-border-color: rgba(255, 255, 255, .15)}.card[_ngcontent-%COMP%]{--bs-card-spacer-y: .5rem;--bs-card-spacer-x: .5rem}.title[_ngcontent-%COMP%]{margin:0}.subtitle[_ngcontent-%COMP%]{font-size:14px;opacity:.7}.card[_ngcontent-%COMP%]{background-color:var(--bg);border:1px solid rgba(255,255,255,.1)}.serie-label[_ngcontent-%COMP%]{font-size:12px;color:#ffffffbf;padding:0 .5rem}.delete-button[_ngcontent-%COMP%]{background-color:#301b23;--bs-btn-border-color: #6e363b;color:#fa8989}"],changeDetection:0})}}return t})();function Qe(t,o,e,i){return Ze(o?.userId,o?.name??t.value.user,e.exerciseId,i,U(t.value.series))}function Ze(t,o,e,i,r){return tt(null,t,o,e,i,r)}function et(t,o,e,i,r){return{id:t,exerciseLog:{exerciseLogUsername:e?.name,exerciseLogUserId:e.userId,exerciseLogExerciseId:i.exerciseId,exerciseLogDate:r.format("YYYY-MM-DD"),series:U(o.value.series)}}}function tt(t,o,e,i,r,c){return{id:t?.id,exerciseLog:{exerciseLogUsername:e.toLocaleLowerCase(),exerciseLogUserId:o,exerciseLogExerciseId:i,exerciseLogDate:r.format("YYYY-MM-DD"),series:c}}}function it(t){return{exerciseLogId:t.exerciseLogId,serieId:t.serieId,reps:+t.reps,weightInKg:+t.weightInKg.toFixed(1),brzycki:null}}function U(t){return(t??[]).filter(o=>!!o.reps&&!!o.weightInKg).map(it)}export{Gt as EditExerciseLogPageComponent};
