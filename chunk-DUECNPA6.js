import{a as ae}from"./chunk-CIDZOAJG.js";import{a as Y,b as A,c as $,e as ie,g as re,h as oe,i as _}from"./chunk-QG63WFVY.js";import{N as ee,Q as te,a as K,b as N,c as R,d as B,e as J,g as j,h as q,j as H,m as z,n as Q,o as W,q as X,r as Z}from"./chunk-IU3Y72BR.js";import{h as M,j as P,l as V}from"./chunk-FE5KJT64.js";import{Bb as y,Eb as S,Fb as g,Jb as d,Kb as F,Lb as I,Qb as w,Rb as D,Sb as T,Tb as k,Vb as G,Wb as O,Ya as E,ab as n,lb as p,oa as l,qa as U,qb as L,rb as x,sb as h,ub as v,va as C,vb as f,wa as b,wb as c,xb as s,yb as u}from"./chunk-UBKAMZXI.js";function ne(t,r){if(t&1&&(c(0,"div",16),d(1),s()),t&2){let e=r.$implicit;n(1),F(e.value)}}function se(t,r){if(t&1&&(v(0,ne,2,1,"div",17,h),G(2,"keyvalue")),t&2){let e=g(2);f(O(2,0,e.createOrUpdateLogFormGroup.errors==null?null:e.createOrUpdateLogFormGroup.errors.exercise))}}function ce(t,r){if(t&1&&(c(0,"div",18)(1,"span",19),d(2),s(),u(3,"input",20)(4,"input",21),s()),t&2){let e=r.$implicit,i=r.$index;n(2),I("Serie ",i+1,""),n(1),p("formControl",e.controls.reps),n(1),p("formControl",e.controls.weightInKg)}}function de(t,r){if(t&1&&(c(0,"div",16),d(1),s()),t&2){let e=r.$implicit;n(1),F(e.value)}}function le(t,r){if(t&1&&(v(0,de,2,1,"div",17,h),G(2,"keyvalue")),t&2){let e=g(2);f(O(2,0,e.createOrUpdateLogFormGroup.errors==null?null:e.createOrUpdateLogFormGroup.errors.series))}}function pe(t,r){if(t&1){let e=y();c(0,"button",22),S("click",function(){C(e);let o=g(2);return b(o.exerciseLogService.deleteLog$.next(o.originalValue()))}),d(1," Delete "),s()}}function me(t,r){if(t&1&&u(0,"app-exercise-log",23),t&2){let e=r.$implicit;p("exerciseLog",e)}}var ue=t=>({"justify-content-between":t}),ge=(t,r)=>({"btn-primary":t,"btn-secondary":r}),Le=()=>[];function xe(t,r){if(t&1){let e=y();c(0,"div",1)(1,"div",2)(2,"h4",3),d(3),s()(),c(4,"div",4)(5,"form"),u(6,"input",5),c(7,"div",6),u(8,"input",7),s(),c(9,"div",6)(10,"div",8),u(11,"app-typeahead",9),s(),L(12,se,3,2),s(),v(13,ce,5,3,"div",24,h),L(15,le,3,2),s()(),c(16,"div",10),L(17,pe,2,0,"button",11),c(18,"button",12),d(19," Cancel "),s(),c(20,"button",13),S("click",function(){C(e);let o=g();return b(o.saveExerciseLog())}),d(21," Save "),s(),c(22,"div",14)(23,"div",15),d(24,"Previous entries"),s(),v(25,me,1,1,"app-exercise-log",25,h),s()()()}if(t&2){let e=g(),i;n(3),I(" ",e.mode==="edit"?"Edit":"Create"," Log "),n(5),p("formControl",e.createOrUpdateLogFormGroup.controls.date),n(3),p("items",e.exerciseLogService.exercises)("control",e.createOrUpdateLogFormGroup.controls.exercise)("itemSelector",e.exerciseSelector),n(1),x(12,e.createOrUpdateLogFormGroup.controls.exercise.pristine?-1:12),n(1),f(e.createOrUpdateLogFormGroup.controls.series.controls),n(2),x(15,e.createOrUpdateLogFormGroup.controls.series.pristine?-1:15),n(1),p("ngClass",T(11,ue,e.mode==="edit")),n(1),x(17,e.mode==="edit"?17:-1),n(3),p("ngClass",k(13,ge,e.createOrUpdateLogFormGroup.valid,e.createOrUpdateLogFormGroup.invalid))("disabled",e.createOrUpdateLogFormGroup.invalid),n(5),f((i=(i=e.originalValue())==null?null:i.recentLogs)!==null&&i!==void 0?i:D(16,Le))}}function he(t,r){t&1&&(c(0,"div",26)(1,"div",27)(2,"span",28),d(3,"Loading..."),s()()())}var Ye=(()=>{let r=class r{constructor(){this.exerciseLogService=l(B),this.router=l(A),this.toastService=l(ie),this.authService=l(re),this.exerciseLogApiService=l($),this.titleCasePipe=l(P),this.dayJsService=l(R),this.route=l(Y),this.mode=null,this.createOrUpdateLogFormGroup=null,this.originalValue=E(null),this.isLoading=E(!1),this.exerciseSelector=i=>typeof i=="string"?"":this.titleCasePipe.transform(i?.name)??"",this.route.url.pipe(K()).subscribe(i=>{this.createOrUpdateLogFormGroup=oe(),i.some(a=>a.path===_.LOGS_CREATE)?this.mode="create":this.initEditMode()})}initEditMode(){this.isLoading.set(!0);let i=Number(this.route.snapshot.paramMap.get(_.LOGS_ID_PARAM));this.mode="edit",this.exerciseLogApiService.getExerciseLogById(i).subscribe(o=>{this.originalValue.set(o),this.createOrUpdateLogFormGroup.reset(),this.createOrUpdateLogFormGroup.patchValue({exercise:o.exercise,date:this.dayJsService.parseDate(o.date).format("YYYY-MM-DD"),user:o.user.name,series:o.series.map(a=>({exerciseLogId:a.exerciseLogId,serieId:a.serieId,reps:a.reps,weightInKg:a.weightInKg}))}),this.isLoading.set(!1)})}ngOnInit(){}saveExerciseLog(){this.isLoading.set(!0),this.mode==="create"?this.createExerciseLog():this.updateExerciseLog(this.originalValue())}createExerciseLog(){if(this.createOrUpdateLogFormGroup.invalid||typeof this.createOrUpdateLogFormGroup.value.exercise=="string")return;let i=this.authService.user(),o={exerciseLog:{exerciseLogUsername:i?.name??this.createOrUpdateLogFormGroup.value.user.toLocaleLowerCase(),exerciseLogUserId:i?.userId,exerciseLogExerciseId:this.createOrUpdateLogFormGroup.value.exercise.exerciseId,exerciseLogDate:this.dayJsService.parseDate(this.createOrUpdateLogFormGroup.value.date).format("YYYY-MM-DD"),series:(this.createOrUpdateLogFormGroup.value.series??[]).filter(a=>!!a.reps&&!!a.weightInKg).map(a=>({exerciseLogId:a.exerciseLogId,serieId:a.serieId,reps:+a.reps,weightInKg:+a.weightInKg.toFixed(1)}))}};this.exerciseLogApiService.createExerciseLog(o).subscribe({next:a=>{this.createOrUpdateLogFormGroup.reset(),localStorage.removeItem(N),this.toastService.ok("Log created successfully!"),this.router.navigate([_.LOGS,_.LOGS_EDIT,a])},error:()=>{this.toastService.error()}})}updateExerciseLog(i){if(this.createOrUpdateLogFormGroup.invalid||typeof this.createOrUpdateLogFormGroup.value.exercise=="string")return;let o=this.authService.user(),a={id:i?.id,exerciseLog:{exerciseLogUsername:o?.name??this.createOrUpdateLogFormGroup.value.user.toLocaleLowerCase(),exerciseLogUserId:o?.userId,exerciseLogExerciseId:this.createOrUpdateLogFormGroup.value.exercise.exerciseId,exerciseLogDate:this.dayJsService.parseDate(this.createOrUpdateLogFormGroup.value.date).format("YYYY-MM-DD"),series:(this.createOrUpdateLogFormGroup.value.series??[]).filter(m=>!!m.reps&&!!m.weightInKg).map(m=>({exerciseLogId:m.exerciseLogId,serieId:m.serieId,reps:+m.reps,weightInKg:+m.weightInKg.toFixed(1)}))}};this.exerciseLogApiService.updateExerciseLog(a).subscribe({next:()=>{this.createOrUpdateLogFormGroup.reset(),this.toastService.ok("Log updated successfully!"),this.initEditMode()},error:()=>{this.toastService.error()}})}};r.\u0275fac=function(o){return new(o||r)},r.\u0275cmp=U({type:r,selectors:[["edit-exercise-log-page"]],standalone:!0,features:[w],decls:2,vars:1,consts:[["class","footer-padding"],[1,"footer-padding"],[1,"modal-header"],["id","modal-basic-title",1,"modal-title"],[1,"modal-body"],["type","text","autofocus","autofocus",2,"display","none"],[1,"mb-3"],["type","date","placeholder","DD-MM-YYYY","placeholder","Reps",1,"form-control",3,"formControl"],[1,"input-group"],["placeholder","Exercise",3,"items","control","itemSelector"],[1,"modal-footer",3,"ngClass"],["type","button","class","btn btn-danger me-auto"],["type","button",1,"btn","btn-secondary"],["type","button",1,"btn",3,"ngClass","disabled","click"],[1,"pt-5","w-100"],[1,"pb-2"],[1,"d-block","invalid-feedback"],["class","d-block invalid-feedback"],[1,"input-group","mb-3","align-items-center"],[1,"input-group-text"],["type","number","placeholder","Reps",1,"form-control",3,"formControl"],["type","number","placeholder","Kg",1,"form-control",3,"formControl"],["type","button",1,"btn","btn-danger","me-auto",3,"click"],[1,"w-100",3,"exerciseLog"],["class","input-group mb-3 align-items-center"],["class","w-100",3,"exerciseLog"],[1,"position-absolute","top-50","start-50","translate-middle"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"]],template:function(o,a){o&1&&L(0,xe,27,17,"div",0)(1,he,4,0),o&2&&x(0,a.isLoading()?1:0)},dependencies:[Z,z,J,Q,j,q,W,X,H,ee,te,ae,V,M],styles:["[_nghost-%COMP%]{display:block;padding:0 .5rem;--bs-heading-color: white;--bs-modal-color: white;--bs-body-bg: var(--light-bg);--bs-body-color: var(--font-color);--bs-tertiary-bg: var(--primary);--bs-border-width: 0;--bs-modal-footer-border-width: 0;--bs-modal-header-border-width: 0;--bs-modal-header-padding: .5rem}"],changeDetection:0});let t=r;return t})();export{Ye as EditExerciseLogPageComponent};
