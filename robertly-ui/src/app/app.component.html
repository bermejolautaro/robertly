<nav class="navbar navbar-dark bg-primary bg-gradient fw-bold px-3">
  <div class="container-fluid d-flex justify-content-end align-items-center">
    <!-- #region USERNAME DROPDOWN -->
    <div ngbDropdown display="dynamic" class="d-flex justify-content-end">
      <button
        type="button"
        class="btn d-flex justify-content-between align-items-center me-3"
        style="outline: none; border: none; color: white; font-weight: 500"
        ngbDropdownToggle
      >
        {{ exerciseLogService.selectedUsernameLabel() | titlecase }}
      </button>
      <div ngbDropdownMenu>
        <button ngbDropdownItem (click)="exerciseLogService.selectedUsername$.next(null)">All Users</button>
        @for (username of exerciseLogService.usernames(); track username) {
          <button
            ngbDropdownItem
            [ngClass]="{ active: username === exerciseLogService.selectedUsername() }"
            (click)="exerciseLogService.selectedUsername$.next(username)"
          >
            {{ username | titlecase }}
          </button>
        }
      </div>
    </div>
    <!-- #endregion -->
    <button type="button" class="btn" style="outline: none; border: none; padding: 0">
      <i
        class="fa fa-refresh"
        style="font-size: 20px; color: white"
        [ngClass]="{ spin: isSpinning }"
        (click)="isSpinning = true; fetchData()"
        (animationend)="isSpinning = false"
      ></i>
    </button>
  </div>
</nav>

<!-- #region FILTERS -->
<div class="container my-4">
  <!-- #region DROPDOWN TYPE -->
  <div class="row mb-2 gx-2">
    <div class="col-12">
      <div ngbDropdown class="d-flex justify-content-center">
        <button type="button" class="btn btn-outline-primary w-100 d-flex justify-content-between align-items-center" ngbDropdownToggle>
          {{ exerciseLogService.selectedTypeLabel() | titlecase }}
        </button>
        <div ngbDropdownMenu class="w-100">
          @if (exerciseLogService.selectedType()) {
            <button ngbDropdownItem (click)="exerciseLogService.selectedType$.next(null)">Clear filter</button>
          }
          @for (type of exerciseLogService.types(); track type) {
            <button
              ngbDropdownItem
              [ngClass]="{ active: type === exerciseLogService.selectedType() }"
              (click)="exerciseLogService.selectedType$.next(type)"
            >
              {{ type | titlecase }}
            </button>
          }
        </div>
      </div>
    </div>
  </div>
  <!-- #endregion -->

  <!-- #region TYPEAHEAD EXERCISE -->
  <div class="col-12">
    <input
      type="text"
      class="form-control mb-2"
      [(ngModel)]="exerciseTypeahead"
      (selectItem)="onExerciseTypeaheadChange($event)"
      [ngbTypeahead]="exerciseSearch"
      (focus)="exerciseTypeahead = ''; exerciseFocus$.next(exerciseTypeahead)"
      (blur)="exerciseTypeahead = exerciseLogService.selectedExerciseLabel()"
      [popupClass]="'typeahead'"
      [resultFormatter]="exerciseFormatter"
      [inputFormatter]="exerciseFormatter"
      #exerciseTypeaheadInput
    />
  </div>
  <!-- #endregion -->

  <!-- #region WEIGHT EXERCISE -->

  <div class="col-12">
    <input
      type="text"
      class="form-control mb-2"
      [(ngModel)]="weightTypeahead"
      (selectItem)="onWeightTypeaheadChange($event)"
      [ngbTypeahead]="weightSearch"
      (focus)="weightTypeahead = ''; weightFocus$.next(weightTypeahead)"
      (blur)="weightTypeahead = exerciseLogService.selectedWeightLabel()"
      [popupClass]="'typeahead'"
      [resultFormatter]="weightFormatter"
      [inputFormatter]="weightFormatter"
      #weightTypeaheadInput
    />
  </div>
  <!-- #endregion -->
</div>
<!-- #endregion -->

<div [style.marginBottom.rem]="8">
  <router-outlet></router-outlet>
</div>

@if (exerciseLogService.loaded()) {
  <button class="btn btn-lg btn-primary" (click)="open('create')">
    <i class="fa fa-plus"></i>
  </button>
}

<nav class="navbar navbar-dark bg-primary bg-gradient fixed-bottom fw-bold">
  <div class="container-fluid">
    <ul class="navbar-nav flex-row gap-3 justify-content-center w-100">
      <li class="nav-item w-100">
        <a
          class="nav-link text-center d-flex justify-content-center align-items-center gap-2"
          [routerLink]="LOGS_PATH"
          routerLinkActive="active"
          [routerLinkActiveOptions]="{ exact: true }"
        >
          Logs <i class="fa fa-history"></i>
        </a>
      </li>
      <li class="nav-item w-100">
        <a
          class="nav-link text-center d-flex justify-content-center align-items-center gap-2"
          [routerLink]="STATS_PATH"
          routerLinkActive="active"
        >
          Stats <i class="fa fa-bar-chart"></i>
        </a>
      </li>
    </ul>
  </div>
</nav>
