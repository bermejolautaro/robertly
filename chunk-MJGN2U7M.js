import{a as ne}from"./chunk-TS3LMNYW.js";import{a as ae}from"./chunk-XL2GRWJJ.js";import{a as ie}from"./chunk-TYQOADUA.js";import{c as re}from"./chunk-BC6MS7IG.js";import{c as O,d as U,n as ee,p as oe,q as te,w as g,y as de}from"./chunk-FEJMBTUO.js";import{B as Q,J as Z,b as S,d as F,e as $,f as y,g as x,h as B,i as J,j as W,k as u,m as X,o as z,q as H,r as K}from"./chunk-WTXVKF6G.js";import{$ as D,Bb as v,Fb as i,Gb as r,Hb as l,Ia as T,Ic as j,Ka as k,Kb as R,Mb as f,Mc as G,Nb as Y,R as w,Ya as d,Yb as m,_b as I,ib as M,ma as n,nb as h,t as _,ua as A,va as P,wb as c,wc as N,x as p,xc as L,yb as V,yc as q,z as E}from"./chunk-VRIC2HH7.js";function se(a,b){a&1&&l(0,"i",15)}function le(a,b){a&1&&(l(0,"span",17),i(1,"span",18),m(2,"Loading..."),r())}function me(a,b){if(a&1){let e=R();i(0,"button",19),f("click",function(){A(e);let o=Y();return P(o.openDeleteModal())}),l(1,"i",20),i(2,"span"),m(3,"Delete"),r()()}}var Te=(()=>{class a{constructor(){this.location=n(j),this.router=n(U),this.toastService=n(ee),this.titleCasePipe=n(G),this.route=n(O),this.modalService=n(Q),this.authService=n(oe),this.dayjs=n(de),this.foodLogsApiService=n(ne),this.foodsApiService=n(ae),this.foodLogIdFromRoute=T(void 0,{alias:"id"}),this.url=S(this.route.url,{initialValue:[]}),this.mode=L(()=>this.url().some(e=>e.path===g.CREATE)?"create":"edit"),this.foods=F({loader:()=>this.foodsApiService.getFoods(),defaultValue:[]}),this.userSelector=e=>typeof e=="string"?"":e?.name??"",this.foodSelector=e=>typeof e=="string"?"":this.titleCasePipe.transform(e?.name)??"",this.users=L(()=>{let e=this.authService.user();return[e,...e?.assignedUsers??[]]}),this.isSaveLoading=k(!1),this.titleCaseSelector=e=>e?this.titleCasePipe.transform(e):"",this.originalValue=F({request:this.foodLogIdFromRoute,loader:({request:e})=>e?this.foodLogsApiService.getFoodLogById(e):_(null)}),this.foodLogForm=new J({user:new u(null),food:new u(null),date:new u("",y.required),amount:new u(null,y.required)}),this.amountPlaceholder=S(this.foodLogForm.controls.food.valueChanges.pipe(D(null),E(e=>e?`Amount (${e.unit})`:"Amount"))),q(()=>{let e=this.mode(),t=this.originalValue.value(),o=N(()=>this.authService.user());if(e==="create"){let s=this.dayjs().format("YYYY-MM-DD");this.foodLogForm.patchValue({date:s,user:o?.name??""})}e==="edit"&&t&&(this.foodLogForm.reset(),this.foodLogForm.patchValue({date:re(t.date).format("YYYY-MM-DD"),food:t.food,user:t.user}))})}openDeleteModal(){let e=this.modalService.open(te,{centered:!0});e.componentInstance.configurate({title:"Delete Record",subtitle:"<strong>Are you sure you want to delete this record?</strong>",body:'This record will be permanently deleted. <span class="text-danger">This operation can not be undone.</span>',okType:"danger"}),e.closed.pipe(w(1)).subscribe(async()=>{let o=this.originalValue.value();if(o?.foodLogId)try{await p(this.foodLogsApiService.deleteFoodLog(o.foodLogId)),this.router.navigate([g.EXERCISES])}catch(s){let C=s;this.toastService.error(`${C.message}`)}})}async save(){if(this.foodLogForm.invalid)return;let e=this.originalValue.value(),t=this.foodLogForm.value.user,o=this.foodLogForm.value.food;if(this.foodLogForm.invalid||typeof o=="string"||!o||typeof t=="string"||!t)return;this.isSaveLoading.set(!0),this.foodLogForm.disable();let s={foodLogId:e?.foodLogId??null,date:this.foodLogForm.value.date,user:t,food:o,amount:this.foodLogForm.value.amount};try{this.mode()==="create"?await p(this.foodLogsApiService.createFoodLog(s)):await p(this.foodLogsApiService.updateFoodLog(s))}catch{this.toastService.error("An error occurred while saving the log.")}finally{this.isSaveLoading.set(!1),this.foodLogForm.enable(),this.router.navigate([g.FOODS])}}cancel(){this.location.back()}static{this.\u0275fac=function(t){return new(t||a)}}static{this.\u0275cmp=M({type:a,selectors:[["edit-food-log-page"]],inputs:{foodLogIdFromRoute:[1,"id","foodLogIdFromRoute"]},decls:27,vars:17,consts:[[1,"header-footer-padding"],[1,"container"],[1,"pb-3"],[1,"title"],[1,"subtitle"],[1,"mb-2"],["type","date","placeholder","DD-MM-YYYY",1,"form-control",3,"formControl"],[1,"mb-3"],["placeholder","User",3,"control","items","itemSelector"],["placeholder","Food",3,"control","items","itemSelector"],["type","text",1,"form-control",3,"placeholder","formControl"],[1,"row","g-2","mb-3"],[1,"col"],["type","button",1,"btn","btn-secondary","w-100",3,"click"],["type","button",1,"btn","w-100","d-flex","justify-content-center","align-items-center",3,"click","disabled"],["aria-hidden","true",1,"fa","fa-save","px-2"],["type","button",1,"btn","btn-danger","w-100","delete-button"],["aria-hidden","true",1,"spinner-border","spinner-border-sm","mx-2"],["role","status",1,"visually-hidden"],["type","button",1,"btn","btn-danger","w-100","delete-button",3,"click"],["aria-hidden","true",1,"fa","fa-trash","px-2"]],template:function(t,o){t&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4",3),m(4),r(),i(5,"span",4),m(6,"Track your daily meals and your calorie intake"),r()(),i(7,"div")(8,"form")(9,"div",5),l(10,"input",6),r(),i(11,"div",7),l(12,"app-typeahead",8),r(),i(13,"div",7),l(14,"app-typeahead",9),r(),i(15,"div",5),l(16,"input",10),r()()(),i(17,"div",11)(18,"div",12)(19,"button",13),f("click",function(){return o.cancel()}),m(20," Cancel "),r()(),i(21,"div",12)(22,"button",14),f("click",function(){return o.save()}),h(23,se,1,0,"i",15)(24,le,3,0),m(25," Save "),r()()(),h(26,me,4,0,"button",16),r()()),t&2&&(d(4),I("",o.mode()==="edit"?"Edit":"Create"," Food Log"),d(6),c("formControl",o.foodLogForm.controls.date),d(2),c("control",o.foodLogForm.controls.user)("items",o.users())("itemSelector",o.userSelector),d(2),c("control",o.foodLogForm.controls.food)("items",o.foods.value())("itemSelector",o.foodSelector),d(2),c("placeholder",o.amountPlaceholder())("formControl",o.foodLogForm.controls.amount),d(6),V("btn-primary",o.foodLogForm.valid)("btn-secondary",o.foodLogForm.invalid),c("disabled",o.foodLogForm.invalid||o.isSaveLoading()),d(),v(o.isSaveLoading()?24:23),d(3),v(o.mode()==="edit"?26:-1))},dependencies:[K,X,$,x,B,z,H,W,Z,ie],encapsulation:2,changeDetection:0})}}return a})();export{Te as EditFoodLogPageComponent};
