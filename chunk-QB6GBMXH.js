import{a as ee}from"./chunk-BJTZI6DR.js";import{a as oe}from"./chunk-6CANKP75.js";import{a as X}from"./chunk-SDZBR5WF.js";import{a as Z}from"./chunk-EPMAUOH7.js";import{c as $}from"./chunk-H77DQZCO.js";import{B as x,D as te,c as N,e as j,r as H,t as K,u as Q}from"./chunk-EQNXLAES.js";import{A as J,b as B,d as P,f as q,h as z,m as G,p as U}from"./chunk-6EYGD3XX.js";import{Ac as Y,Bb as y,Bc as W,Fb as r,Gb as a,Hb as F,Ia as D,Ka as u,Kb as w,Mb as S,Nb as l,Nc as R,R as M,Rc as I,Ya as s,Yb as g,_b as A,ac as h,bc as _,cc as L,ib as T,ma as d,nb as C,t as V,ua as c,va as m,wb as f,x as v,yb as k,yc as O,zc as p}from"./chunk-ARLDQED4.js";function ie(n,b){n&1&&F(0,"i",16)}function ne(n,b){n&1&&(F(0,"span",18),r(1,"span",19),g(2,"Loading..."),a())}function re(n,b){if(n&1){let e=w();r(0,"button",20),S("click",function(){c(e);let o=l(2);return m(o.openDeleteModal())}),F(1,"i",21),r(2,"span"),g(3,"Delete"),a()()}}function ae(n,b){if(n&1){let e=w();r(0,"div",0)(1,"div",2)(2,"div",3)(3,"h4",4),g(4),a(),r(5,"span",5),g(6,"Track your daily meals and your calorie intake"),a()(),r(7,"div")(8,"div",6)(9,"input",7),L("ngModelChange",function(o){c(e);let i=l();return _(i.foodLogForm.date,o)||(i.foodLogForm.date=o),m(o)}),a()(),r(10,"div",8)(11,"app-typeahead",9),L("valueChange",function(o){c(e);let i=l();return _(i.foodLogForm.user,o)||(i.foodLogForm.user=o),m(o)}),a()(),r(12,"div",8)(13,"app-typeahead",10),L("valueChange",function(o){c(e);let i=l();return _(i.foodLogForm.food,o)||(i.foodLogForm.food=o),m(o)}),a()(),r(14,"div",6)(15,"input",11),L("ngModelChange",function(o){c(e);let i=l();return _(i.foodLogForm.amount,o)||(i.foodLogForm.amount=o),m(o)}),a()()(),r(16,"div",12)(17,"div",13)(18,"button",14),S("click",function(){c(e);let o=l();return m(o.cancel())}),g(19," Cancel "),a()(),r(20,"div",13)(21,"button",15),S("click",function(){c(e);let o=l();return m(o.save())}),C(22,ie,1,0,"i",16)(23,ne,3,0),g(24," Save "),a()()(),C(25,re,4,0,"button",17),a()()}if(n&2){let e=l();s(4),A("",e.mode()==="edit"?"Edit":"Create"," Food Log"),s(5),h("ngModel",e.foodLogForm.date),s(2),h("value",e.foodLogForm.user),f("items",e.users())("itemSelector",e.userSelector),s(2),h("value",e.foodLogForm.food),f("items",e.foods.value())("itemSelector",e.foodSelector),s(2),f("placeholder",e.amountPlaceholder()),h("ngModel",e.foodLogForm.amount),s(6),k("btn-primary",e.foodLogFormValid())("btn-secondary",!e.foodLogFormValid()||e.isSaveLoading()),f("disabled",!e.foodLogFormValid()||e.isSaveLoading()),s(),y(e.isSaveLoading()?23:22),s(3),y(e.mode()==="edit"?25:-1)}}function de(n,b){n&1&&(r(0,"div",1)(1,"div",22)(2,"span",23),g(3,"Loading..."),a()()())}var Ee=(()=>{class n{constructor(){this.location=d(R),this.router=d(j),this.toastService=d(H),this.titleCasePipe=d(I),this.route=d(N),this.modalService=d(J),this.authService=d(K),this.dayjs=d(te),this.foodLogsApiService=d(Z),this.foodsApiService=d(oe),this.foodLogIdFromRoute=D(void 0,{alias:"id"}),this.isLoading=W(()=>this.originalValue.isLoading()||this.foods.isLoading()),this.url=B(this.route.url,{initialValue:[]}),this.mode=p(()=>this.url().some(e=>e.path===x.CREATE)?"create":"edit"),this.foods=P({loader:()=>this.foodsApiService.getFoods(),defaultValue:[]}),this.userSelector=e=>typeof e=="string"?"":e?.name??"",this.foodSelector=e=>typeof e=="string"?"":this.titleCasePipe.transform(e?.name)??"",this.users=p(()=>{let e=this.authService.user.value();return[e,...e?.assignedUsers??[]]}),this.isSaveLoading=u(!1),this.titleCaseSelector=e=>e?this.titleCasePipe.transform(e):"",this.originalValue=P({request:this.foodLogIdFromRoute,loader:({request:e})=>e?this.foodLogsApiService.getFoodLogById(e):V(null)}),this.foodLogForm={user:u(null),food:u(null),date:u(null),amount:u(null)},this.foodLogFormValue=p(()=>this.foodLogForm),this.foodLogFormValid=p(()=>!0),this.foodLogFormEnabled=u(!0),this.amountPlaceholder=p(()=>{let e=this.foodLogForm.food();return e?`Amount (${e.unit})`:"Amount"}),Y(()=>{let e=this.mode(),t=this.originalValue.value(),o=O(()=>this.authService.user.value());if(e==="create"){let i=this.dayjs().format("YYYY-MM-DD");this.foodLogForm.date.set(i),this.foodLogForm.user.set(o)}e==="edit"&&t&&(this.foodLogForm.date.set($(this.dayjs,t.date).format("YYYY-MM-DD")),this.foodLogForm.food.set(t.food),this.foodLogForm.user.set(t.user),this.foodLogForm.amount.set(t.amount.toString()))})}openDeleteModal(){let e=this.modalService.open(Q,{centered:!0});e.componentInstance.configurate({title:"Delete Record",subtitle:"<strong>Are you sure you want to delete this record?</strong>",body:'This record will be permanently deleted. <span class="text-danger">This operation can not be undone.</span>',okType:"danger"}),e.closed.pipe(M(1)).subscribe(async()=>{let o=this.originalValue.value();if(o?.foodLogId)try{await v(this.foodLogsApiService.deleteFoodLog(o.foodLogId)),this.router.navigate([x.FOOD_LOGS])}catch(i){let E=i;this.toastService.error(`${E.message}`)}})}async save(){if(!this.foodLogFormValid())return;let e=this.originalValue.value(),t=this.foodLogForm.user(),o=this.foodLogForm.food();if(!this.foodLogFormValid()||!o||!t)return;this.isSaveLoading.set(!0),this.foodLogFormEnabled.set(!1);let i={foodLogId:e?.foodLogId??null,date:this.foodLogForm.date(),user:t,food:o,amount:Number(this.foodLogForm.amount())};try{this.mode()==="create"?await v(this.foodLogsApiService.createFoodLog(i)):await v(this.foodLogsApiService.updateFoodLog(i))}catch{this.toastService.error("An error ocurred while saving the log.")}finally{this.isSaveLoading.set(!1),this.foodLogFormEnabled.set(!0),this.router.navigate([x.FOOD_LOGS])}}cancel(){this.location.back()}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=T({type:n,selectors:[["edit-food-log-page"]],inputs:{foodLogIdFromRoute:[1,"id","foodLogIdFromRoute"]},decls:2,vars:1,consts:[[1,"header-footer-padding"],[1,"position-absolute","top-50","start-50","translate-middle"],[1,"container"],[1,"pb-3"],[1,"title"],[1,"subtitle"],[1,"mb-2"],["type","date","placeholder","DD-MM-YYYY",1,"form-control",3,"ngModelChange","ngModel"],[1,"mb-3"],["placeholder","User",3,"valueChange","value","items","itemSelector"],["placeholder","Food",3,"valueChange","value","items","itemSelector"],["type","text","onlyNumbers","",1,"form-control",3,"ngModelChange","placeholder","ngModel"],[1,"row","g-2","mb-3"],[1,"col"],["type","button",1,"btn","btn-secondary","w-100",3,"click"],["type","button",1,"btn","w-100","d-flex","justify-content-center","align-items-center",3,"click","disabled"],["aria-hidden","true",1,"fa","fa-save","px-2"],["type","button",1,"btn","btn-danger","w-100","delete-button"],["aria-hidden","true",1,"spinner-border","spinner-border-sm","mx-2"],["role","status",1,"visually-hidden"],["type","button",1,"btn","btn-danger","w-100","delete-button",3,"click"],["aria-hidden","true",1,"fa","fa-trash","px-2"],["role","status",1,"robertly-spinner","spinner-border","text-primary"],[1,"visually-hidden"]],template:function(t,o){t&1&&C(0,ae,26,17,"div",0)(1,de,4,0,"div",1),t&2&&y(o.isLoading()?1:0)},dependencies:[U,q,z,G,X,ee],styles:["[_nghost-%COMP%]{--bs-body-bg: var(--light-bg);--bs-body-color: var(--font-color);--bs-tertiary-bg: var(--primary);--bs-border-width: 1px;--bs-border-color: rgba(255, 255, 255, .15)}.card[_ngcontent-%COMP%]{--bs-card-spacer-y: .5rem;--bs-card-spacer-x: .5rem}.title[_ngcontent-%COMP%]{margin:0}.subtitle[_ngcontent-%COMP%]{font-size:14px;opacity:.7}.card[_ngcontent-%COMP%]{background-color:var(--bg);border:1px solid rgba(255,255,255,.1)}.serie-label[_ngcontent-%COMP%]{font-size:12px;color:#ffffffbf;padding:0 .5rem}.delete-button[_ngcontent-%COMP%]{background-color:#301b23;--bs-btn-border-color: #6e363b;color:#fa8989}"],changeDetection:0})}}return n})();export{Ee as EditFoodLogPageComponent};
