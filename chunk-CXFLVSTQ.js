import{a as ce}from"./chunk-GEQY6VYQ.js";import{L as re,N as oe,P as ne,R as ae,S as se,T as _,a as A,b as K,c as j,d as N,e as $,f as R,g as B,h as q,j as H,k as z,m as J,p as Q,q as W,r as X,s as Z,t as ee,y as te,z as ie}from"./chunk-M2ODD6WG.js";import{h as P,j as Y,l as V}from"./chunk-5STWZ2YQ.js";import{Bb as G,Eb as u,Fb as g,Jb as l,Kb as O,Lb as U,Qb as S,R as F,Rb as D,Sb as M,Tb as T,Vb as k,Wb as w,Ya as I,ab as c,lb as m,oa as d,qa as b,qb as h,rb as x,sb as v,ub as L,va as E,vb as C,wa as y,wb as s,xb as a,yb as f}from"./chunk-F4YOWNUG.js";var le=(()=>{let i=class i{constructor(){this.modal=d(te)}};i.\u0275fac=function(o){return new(o||i)},i.\u0275cmp=b({type:i,selectors:[["app-confirm-modal"]],standalone:!0,features:[S],decls:17,vars:0,consts:[[1,"modal-header"],["id","modal-title",1,"modal-title"],["type","button","aria-describedby","modal-title",1,"btn-close",3,"click"],[1,"modal-body"],[1,"text-danger"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-danger",3,"click"]],template:function(o,n){o&1&&(s(0,"div",0)(1,"h4",1),l(2," Profile deletion "),a(),s(3,"button",2),u("click",function(){return n.modal.dismiss("Cross click")}),a()(),s(4,"div",3)(5,"p")(6,"strong"),l(7,"Are you sure you want to delete this record?"),a()(),s(8,"p"),l(9," This record will be permanently deleted. "),s(10,"span",4),l(11,"This operation can not be undone."),a()()(),s(12,"div",5)(13,"button",6),u("click",function(){return n.modal.dismiss()}),l(14," Cancel "),a(),s(15,"button",7),u("click",function(){return n.modal.close()}),l(16," Ok "),a()())},changeDetection:0});let e=i;return e})();function pe(e,i){if(e&1&&(s(0,"div",15),l(1),a()),e&2){let t=i.$implicit;c(1),O(t.value)}}function me(e,i){if(e&1&&(L(0,pe,2,1,"div",16,v),k(2,"keyvalue")),e&2){let t=g(2);C(w(2,0,t.createOrUpdateLogFormGroup.errors==null?null:t.createOrUpdateLogFormGroup.errors.exercise))}}function ue(e,i){if(e&1&&(s(0,"div",17)(1,"span",18),l(2),a(),f(3,"input",19)(4,"input",20),a()),e&2){let t=i.$implicit,r=i.$index;c(2),U("Serie ",r+1,""),c(1),m("formControl",t.controls.reps),c(1),m("formControl",t.controls.weightInKg)}}function ge(e,i){if(e&1&&(s(0,"div",15),l(1),a()),e&2){let t=i.$implicit;c(1),O(t.value)}}function he(e,i){if(e&1&&(L(0,ge,2,1,"div",16,v),k(2,"keyvalue")),e&2){let t=g(2);C(w(2,0,t.createOrUpdateLogFormGroup.errors==null?null:t.createOrUpdateLogFormGroup.errors.series))}}function xe(e,i){if(e&1){let t=G();s(0,"button",21),u("click",function(){E(t);let o=g(2);return y(o.openDeleteModal())}),l(1," Delete "),a()}}function fe(e,i){if(e&1&&f(0,"app-exercise-log",24),e&2){let t=i.$implicit;m("exerciseLog",t)}}var _e=()=>[];function ve(e,i){if(e&1&&(s(0,"div",22)(1,"div",23),l(2,"Previous entries"),a(),L(3,fe,1,1,"app-exercise-log",25,v),a()),e&2){let t=g(2),r;c(3),C((r=(r=t.originalValue())==null?null:r.recentLogs)!==null&&r!==void 0?r:D(0,_e))}}var Le=e=>({"justify-content-between":e}),Ce=(e,i)=>({"btn-primary":e,"btn-secondary":i});function be(e,i){if(e&1){let t=G();s(0,"div",1)(1,"div",2)(2,"h4",3),l(3),a()(),s(4,"div",4)(5,"form"),f(6,"input",5),s(7,"div",6),f(8,"input",7),a(),s(9,"div",6)(10,"div",8),f(11,"app-typeahead",9),a(),h(12,me,3,2),a(),L(13,ue,5,3,"div",26,v),h(15,he,3,2),a()(),s(16,"div",10),h(17,xe,2,0,"button",11),s(18,"button",12),u("click",function(){E(t);let o=g();return y(o.cancel())}),l(19," Cancel "),a(),s(20,"button",13),u("click",function(){E(t);let o=g();return y(o.saveExerciseLog())}),l(21," Save "),a(),h(22,ve,5,1,"div",14),a()()}if(e&2){let t=g();c(3),U(" ",t.mode==="edit"?"Edit":"Create"," Log "),c(5),m("formControl",t.createOrUpdateLogFormGroup.controls.date),c(3),m("items",t.exerciseLogService.exercises)("control",t.createOrUpdateLogFormGroup.controls.exercise)("itemSelector",t.exerciseSelector),c(1),x(12,t.createOrUpdateLogFormGroup.controls.exercise.pristine?-1:12),c(1),C(t.createOrUpdateLogFormGroup.controls.series.controls),c(2),x(15,t.createOrUpdateLogFormGroup.controls.series.pristine?-1:15),c(1),m("ngClass",M(12,Le,t.mode==="edit")),c(1),x(17,t.mode==="edit"?17:-1),c(3),m("ngClass",T(14,Ce,t.createOrUpdateLogFormGroup.valid,t.createOrUpdateLogFormGroup.invalid))("disabled",t.createOrUpdateLogFormGroup.invalid),c(2),x(22,t.mode==="edit"?22:-1)}}function Ee(e,i){e&1&&(s(0,"div",27)(1,"div",28)(2,"span",29),l(3,"Loading..."),a()()())}var Qe=(()=>{let i=class i{constructor(){this.exerciseLogService=d(B),this.router=d(K),this.toastService=d(ne),this.authService=d(ae),this.exerciseLogApiService=d(R),this.titleCasePipe=d(Y),this.dayjsService=d($),this.dayjs=this.dayjsService.instance,this.route=d(A),this.modalService=d(ie),this.mode=null,this.createOrUpdateLogFormGroup=null,this.originalValue=I(null),this.isLoading=I(!1),this.exerciseSelector=r=>typeof r=="string"?"":this.titleCasePipe.transform(r?.name)??"",this.route.url.pipe(j()).subscribe(r=>{if(this.createOrUpdateLogFormGroup=se(),r.some(n=>n.path===_.LOGS_CREATE)){this.mode="create";let n=this.dayjs().format("YYYY-MM-DD");this.createOrUpdateLogFormGroup.controls.date.patchValue(n)}else this.initEditMode()})}openDeleteModal(){this.modalService.open(le,{centered:!0}).closed.pipe(F(1)).subscribe(()=>{this.exerciseLogService.deleteLog$.next(this.originalValue())})}saveExerciseLog(){this.isLoading.set(!0),this.mode==="create"?this.createExerciseLog():this.updateExerciseLog(this.originalValue())}cancel(){this.exerciseLogService.refreshLogs$.pipe(F(1)).subscribe(()=>{this.router.navigate([_.LOGS])}),this.exerciseLogService.refreshLogs$.next()}createExerciseLog(){if(this.createOrUpdateLogFormGroup.invalid||typeof this.createOrUpdateLogFormGroup.value.exercise=="string")return;let r=this.authService.user(),o={exerciseLog:{exerciseLogUsername:r?.name??this.createOrUpdateLogFormGroup.value.user.toLocaleLowerCase(),exerciseLogUserId:r?.userId,exerciseLogExerciseId:this.createOrUpdateLogFormGroup.value.exercise.exerciseId,exerciseLogDate:this.dayjsService.parseDate(this.createOrUpdateLogFormGroup.value.date).format("YYYY-MM-DD"),series:(this.createOrUpdateLogFormGroup.value.series??[]).filter(n=>!!n.reps&&!!n.weightInKg).map(n=>({exerciseLogId:n.exerciseLogId,serieId:n.serieId,reps:+n.reps,weightInKg:+n.weightInKg.toFixed(1)}))}};this.exerciseLogApiService.createExerciseLog(o).subscribe({next:n=>{this.createOrUpdateLogFormGroup.reset(),localStorage.removeItem(N),this.toastService.ok("Log created successfully!"),this.router.navigate([_.LOGS,_.LOGS_EDIT,n])},error:()=>{this.toastService.error()}})}updateExerciseLog(r){if(this.createOrUpdateLogFormGroup.invalid||typeof this.createOrUpdateLogFormGroup.value.exercise=="string")return;let o=this.authService.user(),n={id:r?.id,exerciseLog:{exerciseLogUsername:o?.name??this.createOrUpdateLogFormGroup.value.user.toLocaleLowerCase(),exerciseLogUserId:o?.userId,exerciseLogExerciseId:this.createOrUpdateLogFormGroup.value.exercise.exerciseId,exerciseLogDate:this.dayjsService.parseDate(this.createOrUpdateLogFormGroup.value.date).format("YYYY-MM-DD"),series:(this.createOrUpdateLogFormGroup.value.series??[]).filter(p=>!!p.reps&&!!p.weightInKg).map(p=>({exerciseLogId:p.exerciseLogId,serieId:p.serieId,reps:+p.reps,weightInKg:+p.weightInKg.toFixed(1)}))}};this.exerciseLogApiService.updateExerciseLog(n).subscribe({next:()=>{this.createOrUpdateLogFormGroup.reset(),this.toastService.ok("Log updated successfully!"),this.initEditMode()},error:()=>{this.toastService.error()}})}initEditMode(){this.isLoading.set(!0);let r=Number(this.route.snapshot.paramMap.get(_.LOGS_ID_PARAM));this.mode="edit",this.exerciseLogApiService.getExerciseLogById(r).subscribe(o=>{this.originalValue.set(o),this.createOrUpdateLogFormGroup.reset(),this.createOrUpdateLogFormGroup.patchValue({exercise:o.exercise,date:this.dayjsService.parseDate(o.date).format("YYYY-MM-DD"),user:o.user.name,series:o.series.map(n=>({exerciseLogId:n.exerciseLogId,serieId:n.serieId,reps:n.reps,weightInKg:n.weightInKg}))}),this.isLoading.set(!1)})}};i.\u0275fac=function(o){return new(o||i)},i.\u0275cmp=b({type:i,selectors:[["edit-exercise-log-page"]],standalone:!0,features:[S],decls:2,vars:1,consts:[["class","footer-padding"],[1,"footer-padding"],[1,"modal-header"],["id","modal-basic-title",1,"modal-title"],[1,"modal-body"],["type","text","autofocus","autofocus",2,"display","none"],[1,"mb-3"],["type","date","placeholder","DD-MM-YYYY","placeholder","Reps",1,"form-control",3,"formControl"],[1,"input-group"],["placeholder","Exercise",3,"items","control","itemSelector"],[1,"modal-footer",3,"ngClass"],["type","button","class","btn btn-danger me-auto"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn",3,"ngClass","disabled","click"],["class","pt-5 w-100"],[1,"d-block","invalid-feedback"],["class","d-block invalid-feedback"],[1,"input-group","mb-3","align-items-center"],[1,"input-group-text"],["type","number","placeholder","Reps",1,"form-control",3,"formControl"],["type","number","placeholder","Kg",1,"form-control",3,"formControl"],["type","button",1,"btn","btn-danger","me-auto",3,"click"],[1,"pt-5","w-100"],[1,"pb-2"],[1,"w-100",3,"exerciseLog"],["class","w-100",3,"exerciseLog"],["class","input-group mb-3 align-items-center"],[1,"position-absolute","top-50","start-50","translate-middle"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"]],template:function(o,n){o&1&&h(0,be,23,17,"div",0)(1,Ee,4,0),o&2&&x(0,n.isLoading()?1:0)},dependencies:[ee,Q,q,W,H,z,X,Z,J,re,oe,ce,V,P],styles:["[_nghost-%COMP%]{display:block;padding:0 .5rem;--bs-heading-color: white;--bs-modal-color: white;--bs-body-bg: var(--light-bg);--bs-body-color: var(--font-color);--bs-tertiary-bg: var(--primary);--bs-border-width: 0;--bs-modal-footer-border-width: 0;--bs-modal-header-border-width: 0;--bs-modal-header-padding: .5rem}"],changeDetection:0});let e=i;return e})();export{Qe as EditExerciseLogPageComponent};
