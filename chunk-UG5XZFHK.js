import{a as Le}from"./chunk-M7PBZZMJ.js";import{a as ye}from"./chunk-2S4BMT6Y.js";import{A as xe,G as _e,I as fe,J as ve,K as he,M as Ce,N as Ee,O as be,P as L,a as ee,b as te,c as k,d as ie,e as oe,f as ne,g as re,h as ae,j as se,k as le,m as ce,p as de,q as pe,r as me,s as ue,t as ge}from"./chunk-SLXMBMHO.js";import{f as W,j as J,l as Q,m as X,n as Z}from"./chunk-KWBPPEPJ.js";import{Bb as x,Db as z,Gb as u,Gc as T,Hb as f,Hc as H,Ib as v,Ic as O,Jb as h,Jc as B,Kb as r,Lb as n,Mb as d,Pb as Y,Tb as P,U as G,Ub as g,a as $,b as j,cb as a,dc as l,ec as A,fc as b,g as q,kb as N,qa as m,qc as C,rc as U,sc as R,tc as F,ub as I,v as K,ya as y,z as D,za as S,zb as _}from"./chunk-W53POS3V.js";function Se(t,o){if(t&1&&(r(0,"div",22),l(1),n()),t&2){let e=o.$implicit;a(),A(e.value)}}function Ie(t,o){if(t&1&&(v(0,Se,2,1,"div",22,f),C(2,"keyvalue")),t&2){let e,i=g(2);h(U(2,0,(e=i.formGroup().errors)==null?null:e.exercise))}}function Pe(t,o){t&1&&(r(0,"div",14),d(1,"i",23),l(2," You have unsaved changes "),n())}function Te(t,o){if(t&1&&(r(0,"div",15)(1,"form",24)(2,"div",25),d(3,"input",26),n(),r(4,"div",25),d(5,"input",27),n()()()),t&2){let e=o.$implicit;a(3),x("formControl",e.controls.reps),a(2),x("formControl",e.controls.weightInKg)}}function ke(t,o){if(t&1&&(r(0,"div",22),l(1),n()),t&2){let e=o.$implicit;a(),A(e.value)}}function Ve(t,o){if(t&1&&(v(0,ke,2,1,"div",22,f),C(2,"keyvalue")),t&2){let e,i=g(2);h(U(2,0,(e=i.formGroup().errors)==null?null:e.series))}}function we(t,o){t&1&&d(0,"i",20)}function Me(t,o){t&1&&(d(0,"span",28),r(1,"span",29),l(2,"Loading..."),n())}function De(t,o){if(t&1&&d(0,"app-exercise-log",33),t&2){let e=o.$implicit;x("exerciseLog",e)}}function Ge(t,o){if(t&1&&(r(0,"div",30)(1,"div",31)(2,"div",32),l(3,"Previous entries"),n(),v(4,De,1,1,"app-exercise-log",33,f),C(6,"slice"),n()()),t&2){let e=g(3);a(4),h(F(6,0,e.originalValue.value().recentLogs,0,3))}}function Ye(t,o){if(t&1&&d(0,"app-exercise-log",33),t&2){let e=o.$implicit;x("exerciseLog",e)}}function Ae(t,o){if(t&1&&(r(0,"div",30)(1,"div",31)(2,"div",32),l(3,"Recently Updated"),n(),v(4,Ye,1,1,"app-exercise-log",33,f),C(6,"slice"),n()()),t&2){let e=g(3);a(4),h(F(6,0,e.exerciseLogApiService.recentlyUpdated(),0,3))}}function Ue(t,o){if(t&1&&(r(0,"span",34),l(1),n(),r(2,"ul",35)(3,"li",36),l(4),C(5,"number"),n()()),t&2){let e=o.$implicit,i=o.$index;a(),b("Serie ",i+1,""),a(3),b("",R(5,2,e.brzycki,"1.2-2"),"kg")}}function Re(t,o){if(t&1&&(r(0,"div",30)(1,"div",31)(2,"div",32),l(3,"Possible 1RM (Brzycky Formula)"),n(),v(4,Ue,6,5,null,null,f),r(6,"span",34),l(7,"Average"),n(),r(8,"ul",35)(9,"li",36),l(10),C(11,"number"),n()()()()),t&2){let e=g(3);a(4),h(e.originalValue.value().series),a(6),b("",R(11,1,e.originalValue.value().brzyckiAverage,"1.2-2"),"kg")}}function Fe(t,o){if(t&1&&_(0,Ge,7,4,"div",30)(1,Ae,7,4,"div",30)(2,Re,12,4,"div",30),t&2){let e=g(2);u(e.originalValue.value()?0:-1),a(),u(e.exerciseLogApiService.recentlyUpdated().length?1:-1),a(),u(e.originalValue.value()?2:-1)}}function Oe(t,o){if(t&1){let e=Y();r(0,"button",37),P("click",function(){y(e);let s=g(2);return S(s.openDeleteModal())}),d(1,"i",38),r(2,"span"),l(3,"Delete"),n()()}}function Be(t,o){if(t&1){let e=Y();r(0,"div",0)(1,"div",2)(2,"div",3)(3,"h4",4),l(4),n(),r(5,"span",5),l(6,"Record your workout details and progress"),n()(),r(7,"div")(8,"form"),d(9,"input",6),r(10,"div",7),d(11,"input",8),n(),r(12,"div",9),d(13,"app-typeahead",10),n(),r(14,"div",11)(15,"div",12),d(16,"app-typeahead",13),n(),_(17,Ie,3,2),n(),_(18,Pe,3,0,"div",14),r(19,"div",11),v(20,Te,6,2,"div",15,f),n(),_(22,Ve,3,2),n()(),r(23,"div",16)(24,"div",17)(25,"button",18),P("click",function(){y(e);let s=g();return S(s.cancel())}),l(26," Cancel "),n()(),r(27,"div",17)(28,"button",19),P("click",function(){y(e);let s=g();return S(s.save())}),_(29,we,1,0,"i",20)(30,Me,3,0),l(31," Save "),n()()(),_(32,Fe,3,3)(33,Oe,4,0,"button",21),n()()}if(t&2){let e=g();a(4),b("",e.mode()==="edit"?"Edit":"Create"," Exercise Log"),a(7),x("formControl",e.formGroup().controls.date),a(2),x("control",e.formGroup().controls.user)("items",e.users())("itemSelector",e.userSelector),a(3),x("control",e.formGroup().controls.exercise)("items",e.exerciseLogService.exercises())("itemSelector",e.exerciseSelector),a(),u(e.formGroup().controls.exercise.pristine?-1:17),a(),u(e.hasUnsavedChanges()?18:-1),a(2),h(e.formGroup().controls.series.controls),a(2),u(e.formGroup().controls.series.pristine?-1:22),a(6),z("btn-primary",e.formGroup().valid)("btn-secondary",e.formGroup().invalid),x("disabled",e.formGroup().invalid||e.isSaveLoading()),a(),u(e.isSaveLoading()?30:29),a(3),u(e.mode()==="edit"?32:-1),a(),u(e.mode()==="edit"?33:-1)}}function $e(t,o){t&1&&(r(0,"div",1)(1,"div",39)(2,"span",40),l(3,"Loading..."),n()()())}var ft=(()=>{class t{constructor(){this.exerciseLogService=m(ne),this.authService=m(Ce),this.exerciseLogApiService=m(re),this.location=m(W),this.router=m(te),this.toastService=m(he),this.titleCasePipe=m(J),this.dayjsService=m(ve),this.dayjs=this.dayjsService.instance,this.route=m(ee),this.modalService=m(xe),this.isSaveLoading=I(!1),this.isLoading=H(()=>this.originalValue.isLoading()),this.paramMap=k(this.route.paramMap),this.exerciseLogId=T(()=>this.paramMap()?.get(L.LOGS_ID_PARAM)),this.url=k(this.route.url,{initialValue:[]}),this.mode=T(()=>this.url().some(e=>e.path===L.LOGS_CREATE)?"create":"edit"),this.formGroup=I(Ee()),this.formGroupValue=k(this.formGroup().valueChanges),this.userSelector=e=>typeof e=="string"?"":e?.name??"",this.exerciseSelector=e=>typeof e=="string"?"":this.titleCasePipe.transform(e?.name)??"",this.users=T(()=>{let e=this.authService.user();return[e,...e?.assignedUsers??[]]}),this.originalValue=ie({request:this.exerciseLogId,loader:({request:e})=>{let i=Number(e);return i?this.exerciseLogApiService.getExerciseLogById(i):K(null)}}),this.#e=B(()=>{let e=this.mode(),i=this.originalValue.value(),{user:s}=O(()=>({user:this.authService.user()}));e==="create"&&O(()=>{let c=this.dayjs().format("YYYY-MM-DD");this.formGroup.update(p=>(p.patchValue({date:c,user:s?.name??""}),p))}),e==="edit"&&i&&this.formGroup.update(c=>(c.reset(),c.patchValue({exercise:i.exercise,date:this.dayjsService.parseDate(i.date).format("YYYY-MM-DD"),user:i.user,series:i.series.map(p=>({exerciseLogId:p.exerciseLogId,serieId:p.serieId,reps:p.reps,weightInKg:p.weightInKg}))}),c))}),this.hasUnsavedChanges=I(!1),this.#t=B(()=>{let e=this.formGroupValue(),i=this.originalValue.value(),s=this.mode();if(!e){this.hasUnsavedChanges.set(!1);return}let c={series:V(i?.series.map(w=>j($({},w),{brzycki:null})))??[]},p={series:V(e.series)};this.hasUnsavedChanges.set(s==="edit"&&!oe(c,p))})}#e;#t;openDeleteModal(){let e=this.modalService.open(be,{centered:!0}),i=e.componentInstance;i.title="Delete Record",i.subtitle="<strong>Are you sure you want to delete this record?</strong>",i.body='This record will be permanently deleted. <span class="text-danger">This operation can not be undone.</span>',i.okType="danger",e.closed.pipe(G(1)).subscribe(()=>{this.exerciseLogService.deleteLog$.next(this.originalValue.value())})}save(){return q(this,null,function*(){let e=this.mode(),i=this.formGroup();this.isSaveLoading.set(!0);let s=i.value.user,c=i.value.exercise,p=this.dayjsService.parseDate(i.value.date),w=this.originalValue.value();if(!s)throw new Error("User cannot be null");if(i.valid&&typeof c!="string"&&c&&typeof s!="string"&&s){if(i.disable(),e==="create"){let M=je(i,s,c,p);try{let E=yield D(this.exerciseLogApiService.createExerciseLog(M));localStorage.removeItem(fe),this.toastService.ok("Log created successfully!"),this.router.navigate([L.LOGS,L.LOGS_EDIT,E])}catch(E){this.toastService.error(`${E}`)}}if(e==="edit"){let M=Ke(w?.id,i,s,c,p);try{yield D(this.exerciseLogApiService.updateExerciseLog(M)),this.toastService.ok("Log updated successfully!"),this.originalValue.reload()}catch(E){this.toastService.error(`${E}`)}}}this.isSaveLoading.set(!1),i.enable()})}cancel(){this.exerciseLogService.refreshLogs$.pipe(G(1)).subscribe(()=>{this.location.back()}),this.exerciseLogService.refreshLogs$.next()}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=N({type:t,selectors:[["edit-exercise-log-page"]],decls:2,vars:1,consts:[[1,"header-footer-padding"],[1,"position-absolute","top-50","start-50","translate-middle"],[1,"container"],[1,"pb-3"],[1,"title"],[1,"subtitle"],["type","text","autofocus","autofocus",2,"display","none"],[1,"mb-2"],["type","date","placeholder","DD-MM-YYYY",1,"form-control",3,"formControl"],[1,"col-12","mb-2"],["placeholder","User",3,"control","items","itemSelector"],[1,"mb-3"],[1,"input-group"],["placeholder","Exercise",3,"control","items","itemSelector"],[1,"mb-2","px-2"],[1,"pb-1"],[1,"row","g-2","mb-5"],[1,"col"],["type","button",1,"btn","btn-secondary","w-100",3,"click"],["type","button",1,"btn","w-100","d-flex","justify-content-center","align-items-center",3,"click","disabled"],["aria-hidden","true",1,"fa","fa-save","px-2"],["type","button",1,"btn","btn-danger","w-100","delete-button"],[1,"d-block","invalid-feedback"],["aria-hidden","true",1,"fa","fa-exclamation-circle"],[1,"row","g-2"],[1,"col-6"],["type","number","placeholder","Reps",1,"form-control",3,"formControl"],["type","number","placeholder","Weight (Kg)",1,"form-control",3,"formControl"],["aria-hidden","true",1,"spinner-border","spinner-border-sm","mx-2"],["role","status",1,"visually-hidden"],[1,"card","mb-3"],[1,"card-body"],[1,"card-title"],[1,"w-100",3,"exerciseLog"],[1,"serie-label"],[1,"list-group","list-group-horizontal","pb-1"],[1,"list-group-item","w-100"],["type","button",1,"btn","btn-danger","w-100","delete-button",3,"click"],["aria-hidden","true",1,"fa","fa-trash","px-2"],["role","status",1,".robertly-spinner","spinner-border","text-primary"],[1,"visually-hidden"]],template:function(i,s){i&1&&_(0,Be,34,19,"div",0)(1,$e,4,0,"div",1),i&2&&u(s.isLoading()?1:0)},dependencies:[ge,de,ae,pe,se,le,me,ue,ce,_e,Le,ye,Q,X,Z],styles:["[_nghost-%COMP%]{--bs-body-bg: var(--light-bg);--bs-body-color: var(--font-color);--bs-tertiary-bg: var(--primary);--bs-border-width: 1px;--bs-border-color: rgba(255, 255, 255, .15)}.card[_ngcontent-%COMP%]{--bs-card-spacer-y: .5rem;--bs-card-spacer-x: .5rem}.title[_ngcontent-%COMP%]{margin:0}.subtitle[_ngcontent-%COMP%]{font-size:14px;opacity:.7}.card[_ngcontent-%COMP%]{background-color:var(--bg);border:1px solid rgba(255,255,255,.1)}.serie-label[_ngcontent-%COMP%]{font-size:12px;color:#ffffffbf;padding:0 .5rem}.delete-button[_ngcontent-%COMP%]{background-color:#301b23;--bs-btn-border-color: #6e363b;color:#fa8989}"],changeDetection:0})}}return t})();function je(t,o,e,i){return qe(o?.userId,o?.name??t.value.user,e.exerciseId,i,V(t.value.series))}function qe(t,o,e,i,s){return Ne(null,t,o,e,i,s)}function Ke(t,o,e,i,s){return{id:t,exerciseLog:{exerciseLogUsername:e?.name,exerciseLogUserId:e.userId,exerciseLogExerciseId:i.exerciseId,exerciseLogDate:s.format("YYYY-MM-DD"),series:V(o.value.series)}}}function Ne(t,o,e,i,s,c){return{id:t?.id,exerciseLog:{exerciseLogUsername:e.toLocaleLowerCase(),exerciseLogUserId:o,exerciseLogExerciseId:i,exerciseLogDate:s.format("YYYY-MM-DD"),series:c}}}function ze(t){return{exerciseLogId:t.exerciseLogId,serieId:t.serieId,reps:+t.reps,weightInKg:+t.weightInKg.toFixed(1),brzycki:null}}function V(t){return(t??[]).filter(o=>!!o.reps&&!!o.weightInKg).map(ze)}export{ft as EditExerciseLogPageComponent};
