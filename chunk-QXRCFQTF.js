import{a as Le}from"./chunk-CAIFTKPT.js";import{a as q}from"./chunk-KMRCF7MH.js";import{a as Ie}from"./chunk-57WNUYAP.js";import{a as be}from"./chunk-ZUBOAKQJ.js";import"./chunk-YOZSAP4L.js";import{a as j,b as ye}from"./chunk-JWGIT43Z.js";import{a as Ee}from"./chunk-KY7B6MWQ.js";import"./chunk-JRGS3YIA.js";import{d as se,f as le,m as xe,q as fe,r as he,t as ve,u as Ce,v as Se,w as P,y as we}from"./chunk-MMNCJC44.js";import{$c as ce,Ad as _e,Bb as R,Db as _,Gc as ne,Ka as l,Kc as re,Lb as X,Mc as ae,N as G,Nb as s,Nc as oe,Pb as u,Rb as w,Sb as M,Tb as T,Ua as J,Ub as Z,Uc as z,Vb as $,Wb as B,Wc as F,Zc as de,cc as x,ea as f,ec as h,ed as pe,fc as O,hd as ge,id as me,ja as b,jc as N,ka as E,kc as D,lc as W,mb as v,mc as ee,nb as C,ob as k,pb as V,pc as ie,qb as U,rb as y,sb as r,sd as ue,ta as g,tb as n,u as Q,ub as I,y as H,yc as te,zb as K}from"./chunk-NQKVPPC6.js";function Me(a,d){a&1&&(r(0,"div",13),I(1,"i",21),s(2," You have unsaved changes "),n())}function Te(a,d){if(a&1){let e=K();r(0,"div",14)(1,"div",22)(2,"div",23)(3,"input",24),T("ngModelChange",function(i){let o=b(e).$implicit;return M(o().reps,i)||(o().reps=i),E(i)}),n()(),r(4,"div",23)(5,"input",25),T("ngModelChange",function(i){let o=b(e).$implicit;return M(o().weightInKg,i)||(o().weightInKg=i),E(i)}),n()()()()}if(a&2){let e=d.$implicit,t=_(2);l(3),w("ngModel",e().reps),y("disabled",!t.formEnabled())("allowDecimals",!1),l(2),w("ngModel",e().weightInKg),y("disabled",!t.formEnabled())}}function De(a,d){a&1&&I(0,"i",19)}function Pe(a,d){a&1&&(I(0,"span",26),r(1,"span",27),s(2,"Loading..."),n())}function ke(a,d){if(a&1&&I(0,"app-exercise-log",31),a&2){let e=d.$implicit;y("exerciseLog",e)}}function Ve(a,d){if(a&1&&(r(0,"div",28)(1,"div",29)(2,"div",30),s(3,"Previous entries"),n(),V(4,ke,1,1,"app-exercise-log",31,k),x(6,"slice"),n()()),a&2){_(2);let e=B(28);l(4),U(O(6,0,e.recentLogs,0,3))}}function Ue(a,d){if(a&1&&I(0,"app-exercise-log",31),a&2){let e=d.$implicit;y("exerciseLog",e)}}function Be(a,d){if(a&1&&(r(0,"div",28)(1,"div",29)(2,"div",30),s(3,"Recently Updated"),n(),V(4,Ue,1,1,"app-exercise-log",31,k),x(6,"slice"),n()()),a&2){let e=_(3);l(4),U(O(6,0,e.recentlyUpdated.value(),0,3))}}function Ae(a,d){if(a&1&&(r(0,"div",28)(1,"div",29)(2,"div",30),s(3,"Stats"),n(),r(4,"div",32)(5,"span",33),s(6,"Total Reps"),n(),r(7,"span",33),s(8),n(),r(9,"span",33),s(10,"Average Reps"),n(),r(11,"span",33),s(12),n(),r(13,"span",33),s(14,"Tonnage"),n(),r(15,"span",33),s(16),n()()()()),a&2){_(2);let e=B(28);l(8),u("",e.totalReps," reps"),l(4),u("",e.averageReps," reps"),l(4),u("",e.tonnage,"kg")}}function Ke(a,d){if(a&1&&(r(0,"span",33),s(1),n(),r(2,"span",33),s(3),x(4,"number"),n(),r(5,"span",33),s(6),x(7,"number"),n(),r(8,"span",33),s(9),x(10,"number"),n(),r(11,"span",33),s(12),x(13,"number"),n(),r(14,"span",33),s(15),x(16,"number"),n()),a&2){let e=d.$implicit,t=d.$index;l(),u("Serie ",t+1),l(2),u("",h(4,6,e.brzycki,"1.2-2"),"kg"),l(3),u("",h(7,9,e.brzycki,"1.2-2"),"kg"),l(3),u("",h(10,12,e.brzycki,"1.2-2"),"kg"),l(3),u("",h(13,15,e.brzycki,"1.2-2"),"kg"),l(3),u("",h(16,18,e.brzycki,"1.2-2"),"kg")}}function Re(a,d){if(a&1&&(r(0,"div",28)(1,"div",29)(2,"div",30),s(3,"Possible 1RM (Multiple Formulas)"),n(),r(4,"div",34),I(5,"span",33),r(6,"span",35),s(7,"Brzycki"),n(),r(8,"span",35),s(9,"Epley"),n(),r(10,"span",35),s(11,"Lander"),n(),r(12,"span",35),s(13,"Lombardi"),n(),r(14,"span",35),s(15,"Mayhew"),n(),V(16,Ke,17,21,null,null,k),r(18,"span",36),s(19,"Average"),n(),r(20,"span",36),s(21),x(22,"number"),n(),r(23,"span",36),s(24),x(25,"number"),n(),r(26,"span",36),s(27),x(28,"number"),n(),r(29,"span",36),s(30),x(31,"number"),n(),r(32,"span",36),s(33),x(34,"number"),n()()()()),a&2){_(2);let e=B(28);l(16),U(e.series),l(5),u("",h(22,5,e.averageBrzycki,"1.2-2"),"kg"),l(3),u("",h(25,8,e.averageEpley,"1.2-2"),"kg"),l(3),u("",h(28,11,e.averageLander,"1.2-2"),"kg"),l(3),u("",h(31,14,e.averageLombardi,"1.2-2"),"kg"),l(3),u("",h(34,17,e.averageMayhew,"1.2-2"),"kg")}}function Ye(a,d){if(a&1&&(v(0,Ve,7,4,"div",28),v(1,Be,7,4,"div",28),v(2,Ae,17,3,"div",28),v(3,Re,35,20,"div",28)),a&2){let e;_();let t=B(28),i=_();C(t?0:-1),l(),C((e=i.recentlyUpdated.value())!=null&&e.length?1:-1),l(),C(t?2:-1),l(),C(t?3:-1)}}function Oe(a,d){if(a&1){let e=K();r(0,"button",37),R("click",function(){b(e);let i=_(2);return E(i.openDeleteModal())}),I(1,"i",38),r(2,"span"),s(3,"Delete"),n()()}}function Ne(a,d){if(a&1){let e=K();r(0,"div",0)(1,"div",2)(2,"div",3)(3,"h4",4),s(4),n(),r(5,"span",5),s(6,"Record your workout details and progress"),n()(),r(7,"div")(8,"div",6)(9,"input",7),T("ngModelChange",function(i){b(e);let o=_();return M(o.formSignal.date,i)||(o.formSignal.date=i),E(i)}),n()(),r(10,"div",8)(11,"app-typeahead",9),T("valueChange",function(i){b(e);let o=_();return M(o.formSignal.user,i)||(o.formSignal.user=i),E(i)}),n()(),r(12,"div",10)(13,"div",11)(14,"app-typeahead",12),T("valueChange",function(i){b(e);let o=_();return M(o.formSignal.exercise,i)||(o.formSignal.exercise=i),E(i)}),n()()(),v(15,Me,3,0,"div",13),r(16,"div",10),V(17,Te,6,5,"div",14,k),n()(),r(19,"div",15)(20,"div",16)(21,"button",17),R("click",function(){b(e);let i=_();return E(i.cancel())}),s(22," Cancel "),n()(),r(23,"div",16)(24,"button",18),R("click",function(){b(e);let i=_();return E(i.save())}),v(25,De,1,0,"i",19)(26,Pe,3,0),s(27," Save "),n()()(),Z(28),v(29,Ye,4,4),v(30,Oe,4,0,"button",20),n()()}if(a&2){let e=_();l(4),u("",e.mode()==="edit"?"Edit":"Create"," Exercise Log"),l(5),w("ngModel",e.formSignal.date),y("disabled",!e.formEnabled()),l(2),w("value",e.formSignal.user),y("items",e.users())("itemSelector",e.userSelector)("disabled",!e.formEnabled()),l(3),w("value",e.formSignal.exercise),y("items",e.exerciseApiService.exercises())("itemSelector",e.exerciseSelector)("disabled",!e.formEnabled()),l(),C(e.hasUnsavedChanges()?15:-1);let t=e.formSignal.series();l(2),U(t),l(7),X("btn-primary",e.formValid())("btn-secondary",!e.formValid()||!e.hasUnsavedChanges()||e.isSaveLoading()),y("disabled",!e.formValid()||e.isSaveLoading()||e.mode()==="edit"&&!e.hasUnsavedChanges()),l(),C(e.isSaveLoading()?26:25),l(3),$(e.originalValue.value()),l(),C(e.mode()==="edit"?29:-1),l(),C(e.mode()==="edit"?30:-1)}}function We(a,d){a&1&&(r(0,"div",1)(1,"div",39)(2,"span",40),s(3,"Loading..."),n()()())}var mi=(()=>{let d=class d{constructor(){this.exerciseLogId=ie(null,{alias:"id",transform:te}),this.authService=f(ve),this.exerciseLogApiService=f(Ee),this.exerciseApiService=f(fe),this.offlineQueueService=f(Se),this.location=f(ne),this.router=f(le),this.toastService=f(he),this.titleCasePipe=f(re),this.dayjs=f(we),this.route=f(se),this.modalService=f(ue),this.randomUuid=crypto.randomUUID(),this.isSaveLoading=g(!1),this.isLoading=ee(()=>this.originalValue.isLoading()),this.paramMap=z(this.route.paramMap),this.url=z(this.route.url,{initialValue:[]}),this.mode=D(()=>this.url().some(t=>t.path===P.CREATE)?"create":"edit"),this.formSignal={user:g(null),exercise:g(null),date:g(""),series:g([g({serieId:null,reps:g(null),weightInKg:g(null)}),g({serieId:null,reps:g(null),weightInKg:g(null)}),g({serieId:null,reps:g(null),weightInKg:g(null)}),g({serieId:null,reps:g(null),weightInKg:g(null)}),g({serieId:null,reps:g(null),weightInKg:g(null)})])},this.formValid=D(()=>!!this.formValue()),this.formValue=D(()=>{let t=this.formSignal.exercise();if(!t)return null;let i=this.formSignal.user();if(!i)return null;let o=this.formSignal.series().map(p=>p()).map(p=>({serieId:p.serieId,reps:p.reps(),weightInKg:p.weightInKg()}));return o.some(p=>!p.reps&&p.weightInKg||p.reps&&!p.weightInKg)?null:{user:i,exercise:t,date:this.formSignal.date(),series:o}}),this.formEnabled=g(!0),this.userSelector=t=>t?.name??"",this.exerciseSelector=t=>this.titleCasePipe.transform(t?.name)??"",this.users=D(()=>{let t=this.authService.user.value();return[t,...t?.assignedUsers??[]]}),this.originalValue=F({params:this.exerciseLogId,stream:({params:t})=>t?this.exerciseLogApiService.getExerciseLogById(t):Q(null)}),this.recentlyUpdated=F({stream:()=>this.exerciseLogApiService.getRecentlyUpdated()}),this.hasUnsavedChanges=D(()=>{let t=this.formValue(),i=this.mode();if(i==="create"||!t)return!1;let o=this.originalValue.value();if(!o?.series||!o?.exercise||!o?.user||!o?.exerciseLogDate)return!1;let p=o?.series.map(L=>({serieId:L.serieId,weightInKg:L.weightInKg?.toString()??null,reps:L.reps?.toString()??null}))??[],m=t.series.filter(L=>!!L.reps||!!L.weightInKg);return i==="edit"&&!xe(p,m)||o?.exercise.exerciseId!==t.exercise?.exerciseId||o?.user.userId!==t.user.userId||this.dayjs(o?.exerciseLogDate).unix()!==this.dayjs(t.date).unix()}),this.setup_effect_when_original_value_throws_an_error_then_navigate_to_home(),this.setup_effect_when_mode_or_original_value_changes_then_update_form()}setup_effect_when_original_value_throws_an_error_then_navigate_to_home(){W(()=>{this.originalValue.error()&&this.router.navigate([P.HOME])})}setup_effect_when_mode_or_original_value_changes_then_update_form(){W(()=>{let t=this.mode(),i=this.originalValue.value(),{user:o}=N(()=>({user:this.authService.user.value()}));t==="create"&&N(()=>{let p=this.dayjs().format("YYYY-MM-DD");this.formSignal.date.set(p),this.formSignal.user.set(o)}),t==="edit"&&i?.exercise&&i.exerciseLogDate&&i.user&&(this.formSignal.exercise.set(i.exercise),this.formSignal.date.set(this.dayjs(i.exerciseLogDate,[...j]).format("YYYY-MM-DD")),this.formSignal.user.set(i.user),this.formSignal.series.update(p=>{if(!i.series)return p;for(let m=0;m<p.length;m++)p[m]?.set({serieId:i.series[m]?.serieId??null,reps:g(i.series[m]?.reps?.toString()??null),weightInKg:g(i.series[m]?.weightInKg?.toString()??null)});return p})),this.isSaveLoading.set(!1)})}openDeleteModal(){let t=this.modalService.open(Ce,{centered:!0});t.componentInstance.configurate({title:"Delete Record",subtitle:"<strong>Are you sure you want to delete this record?</strong>",body:'This record will be permanently deleted. <span class="text-danger">This operation can not be undone.</span>',okType:"danger"}),t.closed.pipe(G(1)).subscribe(async()=>{let o=this.originalValue.value();if(o?.exerciseLogId)try{await H(this.exerciseLogApiService.deleteExerciseLog(o.exerciseLogId)),this.toastService.ok("Log deleted successfully!"),this.router.navigate([P.HOME])}catch(p){let m=p;this.toastService.error(`${m.message}`)}})}async save(){let t=this.mode(),i=this.formSignal.user(),o=this.formSignal.exercise(),p=this.dayjs(this.formSignal.date(),[...j]);if(!i)throw new Error("User cannot be null");if(this.formValid()){if(this.formEnabled.set(!1),t==="create"){let m=this.formSignal.series().map(c=>{let S=c();return{exerciseLogId:this.exerciseLogId(),serieId:S.serieId,reps:q(S.reps()),weightInKg:q(S.weightInKg()),brzycki:0}}),A=m.filter(c=>!!c.reps&&!!c.weightInKg),Y={seriesIdsToDelete:m.filter(c=>!c.reps||!c.weightInKg).filter(c=>!!c.serieId).map(c=>c.serieId),exerciseLog:{exerciseLogUserId:i.userId,exerciseLogExerciseId:o?.exerciseId??null,exerciseLogDate:p.format("YYYY-MM-DD"),series:A,averageBrzycki:null,averageEpley:null,averageLander:null,averageLombardi:null,averageMayhew:null,averageOConner:null,averageWathan:null,totalReps:null,tonnage:null,averageReps:null,recentLogs:null,createdAtUtc:null,lastUpdatedAtUtc:null,createdByUserId:null,exercise:null,exerciseLogId:null,lastUpdatedByUserId:null,user:null}};this.offlineQueueService.isOnline()?this.isSaveLoading.set(!0):(this.isSaveLoading.set(!0),setTimeout(()=>{this.isSaveLoading.set(!1)},1e3)),this.offlineQueueService.enqueue({id:this.randomUuid,method:"POST",endpoint:"exercise-logs",payload:Y,retries:0,maxRetries:3,optimisticType:"exercise-log",userUuid:this.authService.userUuid(),onActionDone:c=>{let S=c;this.isSaveLoading.set(!1),this.router.navigate([P.EXERCISE_LOGS,P.EDIT,S])}}),this.toastService.ok("Log enqueued for creation successfully!"),localStorage.removeItem(ye)}if(t==="edit"){let m=this.formSignal.series().map(c=>{let S=c();return{exerciseLogId:this.exerciseLogId(),serieId:S.serieId,reps:Number(S.reps()),weightInKg:Number(S.weightInKg()),brzycki:0}}),A=m.filter(c=>!!c.reps&&!!c.weightInKg),Y={seriesIdsToDelete:m.filter(c=>!c.reps||!c.weightInKg).filter(c=>!!c.serieId).map(c=>c.serieId),id:this.exerciseLogId(),exerciseLog:{exerciseLogUserId:i.userId,exerciseLogExerciseId:o?.exerciseId??null,exerciseLogDate:p.format("YYYY-MM-DD"),series:A,averageBrzycki:null,totalReps:null,tonnage:null,averageReps:null,recentLogs:null,createdAtUtc:null,lastUpdatedAtUtc:null,createdByUserId:null,exercise:null,exerciseLogId:null,lastUpdatedByUserId:null,user:null,averageEpley:null,averageLander:null,averageLombardi:null,averageMayhew:null,averageOConner:null,averageWathan:null}};this.offlineQueueService.isOnline()?this.isSaveLoading.set(!0):(this.isSaveLoading.set(!0),setTimeout(()=>{this.isSaveLoading.set(!1)},1e3)),this.offlineQueueService.enqueue({id:this.randomUuid,method:"PUT",endpoint:`exercise-logs/${this.exerciseLogId()}`,payload:Y,retries:0,maxRetries:3,optimisticType:"exercise-log",userUuid:this.authService.userUuid(),onActionDone:()=>{this.originalValue.reload()}}),this.toastService.ok("Log enqueued for update successfully!")}}this.formEnabled.set(!0)}cancel(){this.location.back()}};d.\u0275fac=function(i){return new(i||d)},d.\u0275cmp=J({type:d,selectors:[["edit-exercise-log-page"]],inputs:{exerciseLogId:[1,"id","exerciseLogId"]},decls:2,vars:1,consts:[[1,"header-footer-padding"],[1,"position-absolute","top-50","start-50","translate-middle"],[1,"container"],[1,"pb-3"],[1,"title"],[1,"subtitle"],[1,"mb-2"],["type","date","placeholder","DD-MM-YYYY",1,"form-control",3,"ngModelChange","ngModel","disabled"],[1,"col-12","mb-2"],["placeholder","User",3,"valueChange","value","items","itemSelector","disabled"],[1,"mb-3"],[1,"input-group"],["placeholder","Exercise",3,"valueChange","value","items","itemSelector","disabled"],[1,"mb-2","px-2"],[1,"pb-1"],[1,"row","g-2","mb-5"],[1,"col"],["type","button",1,"btn","btn-secondary","w-100",3,"click"],["type","button",1,"btn","w-100","d-flex","justify-content-center","align-items-center",3,"click","disabled"],["aria-hidden","true",1,"fa","fa-save","px-2"],["type","button",1,"btn","btn-danger","w-100","delete-button"],["aria-hidden","true",1,"fa","fa-exclamation-circle"],[1,"row","g-2"],[1,"col-6"],["type","text","inputmode","decimal","placeholder","Reps","onlyNumbers","",1,"form-control",3,"ngModelChange","ngModel","disabled","allowDecimals"],["type","text","inputmode","decimal","placeholder","Weight (Kg)","onlyNumbers","",1,"form-control",3,"ngModelChange","ngModel","disabled"],["aria-hidden","true",1,"spinner-border","spinner-border-sm","mx-2"],["role","status",1,"visually-hidden"],[1,"card","mb-3"],[1,"card-body"],[1,"card-title"],[1,"w-100",3,"exerciseLog"],[1,"grid-stats"],[1,"serie-label"],[1,"grid-one-rep-max"],[1,"serie-label","pb-2"],[1,"serie-label","pt-2"],["type","button",1,"btn","btn-danger","w-100","delete-button",3,"click"],["aria-hidden","true",1,"fa","fa-trash","px-2"],["role","status",1,"app-spinner","spinner-border","text-primary"],[1,"visually-hidden"]],template:function(i,o){i&1&&v(0,Ne,31,21,"div",0)(1,We,4,0,"div",1),i&2&&C(o.isLoading()?1:0)},dependencies:[me,de,ce,ge,pe,_e,be,Le,Ie,ae,oe],styles:["[_nghost-%COMP%]{--bs-body-bg: var(--light-bg);--bs-body-color: var(--font-color);--bs-tertiary-bg: var(--primary);--bs-border-width: 1px;--bs-border-color: rgba(255, 255, 255, .15)}.card[_ngcontent-%COMP%]{--bs-card-spacer-y: .5rem;--bs-card-spacer-x: .5rem}.title[_ngcontent-%COMP%]{margin:0}.subtitle[_ngcontent-%COMP%]{font-size:14px;opacity:.7}.card[_ngcontent-%COMP%]{background-color:var(--bg);border:1px solid rgba(255,255,255,.1)}.serie-label[_ngcontent-%COMP%]{font-size:12px;color:#ffffffbf}.delete-button[_ngcontent-%COMP%]{background-color:#301b23;--bs-btn-border-color: #6e363b;color:#fa8989}.grid-stats[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr}.grid-one-rep-max[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(6,1fr)}"],changeDetection:0});let a=d;return a})();export{mi as EditExerciseLogPageComponent};
