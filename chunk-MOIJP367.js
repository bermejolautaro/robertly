import{a as G}from"./chunk-VGAENA3S.js";import{a as z}from"./chunk-SDZBR5WF.js";import{a as K}from"./chunk-VGWT7OUG.js";import{a as w}from"./chunk-QTLWTFZX.js";import{a as $}from"./chunk-X2GHADVM.js";import"./chunk-IPNJGKG7.js";import"./chunk-H77DQZCO.js";import{q,t as B}from"./chunk-EQNXLAES.js";import{I as U,b as g,d as v,l as d,p as y,y as W}from"./chunk-6EYGD3XX.js";import{Ac as h,Bb as S,Cb as V,Db as b,Eb as D,Fb as o,Gb as n,Ha as T,Hb as u,Ic as j,Ka as a,Kb as M,Mb as P,Nb as x,Rc as O,Ya as l,Yb as E,Zb as A,ac as R,bc as k,cc as N,ib as C,ma as p,nb as _,ua as F,va as I,wb as c,zc as L}from"./chunk-ARLDQED4.js";var H=(()=>{class r{constructor(){this.filtersChanged=T(),this.exerciseApiService=p(q),this.authService=p(B),this.exerciseLogApiService=p(w),this.titleCasePipe=p(O),this.userSelector=e=>e?.name??"",this.exerciseFormatter=e=>this.titleCasePipe.transform(e),this.weightFormatter=e=>isNaN(parseInt(e??""))?"":`${e}kg`,this.exerciseSelector=e=>typeof e=="string"?"":this.titleCasePipe.transform(e?.name)??"",this.userControl=new d(null),this.typeControl=new d(null),this.exerciseControl=new d(null),this.weightControl=new d(null),this.userControlValues=g(this.userControl.valueChanges),this.typeControlValues=g(this.typeControl.valueChanges),this.exerciseControlValues=g(this.exerciseControl.valueChanges),this.weightControlValues=g(this.weightControl.valueChanges),this.users=a([]),this.types=a([]),this.weights=a([]),this.exercises=a([]),this.filters=v({loader:()=>this.exerciseLogApiService.getFilters(this.userControl.value?.userId,this.exerciseControl.value?.exerciseId,this.typeControl.value,this.weightControl.value?+this.weightControl.value:null)}),h(()=>{let e=this.filters.value(),i=this.authService.user.value();e&&(this.users.set([i,...i?.assignedUsers??[]]),this.types.set(e.types),this.weights.set(e.weights.map(t=>`${t}`)),this.exercises.set(this.exerciseApiService.exercises().filter(t=>e.exercisesIds.includes(t.exerciseId))))}),h(()=>{let e=this.userControlValues(),i=this.typeControlValues(),t=this.exerciseControlValues(),s=this.weightControlValues(),m=e?[e.userId]:[],J=i?[i]:[],Q=t?.exerciseId?[t.exerciseId]:[],X=s?[+s]:[];this.filters.reload(),this.filtersChanged.emit({userId:m,exercisesIds:Q,types:J,weights:X})})}static{this.\u0275fac=function(i){return new(i||r)}}static{this.\u0275cmp=C({type:r,selectors:[["app-filters"]],outputs:{filtersChanged:"filtersChanged"},decls:9,vars:11,consts:[[1,"col-12","mb-2"],["placeholder","User",3,"control","items","itemSelector"],[1,"row","mb-2","gx-2"],[1,"col-12"],["placeholder","Type",3,"control","items"],["placeholder","Exercise",3,"control","items","itemSelector"],["placeholder","Weight (kg)",3,"control","items","itemSelector"]],template:function(i,t){i&1&&(o(0,"div",0),u(1,"app-typeahead",1),n(),o(2,"div",2)(3,"div",3),u(4,"app-dropdown",4),n()(),o(5,"div",0),u(6,"app-typeahead",5),n(),o(7,"div",0),u(8,"app-typeahead",6),n()),i&2&&(l(),c("control",t.userControl)("items",t.users())("itemSelector",t.userSelector),l(3),c("control",t.typeControl)("items",t.types()),l(2),c("control",t.exerciseControl)("items",t.exercises())("itemSelector",t.exerciseSelector),l(2),c("control",t.weightControl)("items",t.weights())("itemSelector",t.weightFormatter))},dependencies:[U,y,W,z,K],encapsulation:2,changeDetection:0})}}return r})();function Z(r,f){if(r&1&&(o(0,"span",3),E(1),n()),r&2){let e=x();l(),A(e.filtersCount())}}function ee(r,f){if(r&1&&u(0,"app-exercise-log",9),r&2){let e=f.$implicit;c("exerciseLog",e)}}function te(r,f){r&1&&(o(0,"div",10),E(1,"No results found"),n())}function ie(r,f){if(r&1){let e=M();o(0,"app-paginator",12),N("currentPageChange",function(t){F(e);let s=x();return k(s.currentPage,t)||(s.currentPage=t),I(t)}),n()}if(r&2){let e,i=x();R("currentPage",i.currentPage),c("pageCount",(e=(e=i.logsResource.value())==null?null:e.pageCount)!==null&&e!==void 0?e:0)}}var Le=(()=>{class r{constructor(){this.document=p(j),this.exerciseLogApiService=p(w),this.showFilters=a(!1),this.currentPage=a(0),this.filter=a(null),this.filtersCount=L(()=>{let e=this.filter();return e?Object.values(e).reduce((i,t)=>i+t.length,0):0}),this.logsResource=v({request:this.filter,loader:({request:e})=>{let i=e?.userId.at(0),t=e?.types.at(0),s=e?.exercisesIds.at(0),m=e?.weights.at(0);return this.exerciseLogApiService.getExerciseLogs(this.currentPage(),i,t??null,s??null,m??null)}}),this.logs=L(()=>this.logsResource.isLoading()?[null,null,null,null,null]:this.logsResource.value()?.data),h(()=>{this.currentPage(),this.logsResource.reload()})}ngOnInit(){this.document.defaultView?.scroll({top:0,left:0,behavior:"smooth"})}onFilterChange(e){this.currentPage.set(0),this.filter.set(e),this.logsResource.reload()}static{this.\u0275fac=function(i){return new(i||r)}}static{this.\u0275cmp=C({type:r,selectors:[["app-exercise-logs-page"]],decls:13,vars:4,consts:[[1,"header-footer-padding"],[1,"container"],[1,"d-flex","justify-content-end"],[1,"active-filters"],[1,"btn","btn-secondary",3,"click"],[1,"fa","fa-sliders"],[1,"mt-2",3,"hidden"],[3,"filtersChanged"],[1,"mt-2"],[3,"exerciseLog"],[1,"d-flex","justify-content-center","align-items-center","my-5"],[3,"currentPage","pageCount"],[3,"currentPageChange","currentPage","pageCount"]],template:function(i,t){if(i&1&&(o(0,"div",0)(1,"div",1)(2,"div",2),_(3,Z,2,1,"span",3),o(4,"button",4),P("click",function(){return t.showFilters.set(!t.showFilters())}),u(5,"i",5),n()(),o(6,"div",6)(7,"app-filters",7),P("filtersChanged",function(m){return t.onFilterChange(m)}),n()(),o(8,"div",8),b(9,ee,1,1,"app-exercise-log",9,V,!1,te,2,0,"div",10),n(),_(12,ie,1,2,"app-paginator",11),n()()),i&2){let s;l(3),S(t.filtersCount()?3:-1),l(3),c("hidden",!t.showFilters()),l(3),D(t.logs()),l(3),S((s=t.logs())!=null&&s.length?12:-1)}},dependencies:[y,G,H,$],styles:[".toggle-filters[_ngcontent-%COMP%]{border:1px solid white;border-radius:5px;width:2rem;height:2rem}.active-filters[_ngcontent-%COMP%]{display:inline;position:relative;text-align:center;background:#ef4444;border-radius:100%;width:18px;height:18px;font-size:12px;font-weight:700;top:-6px;right:-44px}"],changeDetection:0})}}return r})();export{Le as ExerciseLogsPageComponent};
