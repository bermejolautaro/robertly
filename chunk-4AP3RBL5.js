import{a as N}from"./chunk-KMRCF7MH.js";import{a as ye}from"./chunk-3MSJMJSE.js";import{a as Le}from"./chunk-BJTZI6DR.js";import{a as Ce}from"./chunk-SDZBR5WF.js";import{a as Se}from"./chunk-THUUCY7H.js";import"./chunk-LGJTZP4D.js";import{a as Ee,b as be}from"./chunk-B2DMEX42.js";import{B as P,c as ae,e as oe,m as ue,q as _e,r as xe,t as he,u as fe,v as ve}from"./chunk-S2NLS6NO.js";import{A as me,I as ge,b as j,d as F,f as se,h as le,m as de,p as ce,q as pe}from"./chunk-6EYGD3XX.js";import{Ac as z,Bb as f,Bc as ee,Cb as k,Db as D,Eb as V,Fb as n,Gb as r,Hb as b,Ia as G,Ka as c,Kb as K,Mb as R,Nb as u,Nc as te,R as H,Rc as ie,Tc as ne,Uc as re,Ya as l,Yb as s,_b as g,ac as I,bc as w,cc as M,dc as Y,ec as J,fc as U,ib as X,kc as _,ma as x,mc as h,nb as L,nc as W,t as q,ua as C,va as S,wb as E,x as Q,xc as Z,yb as $,yc as O,zc as T}from"./chunk-ARLDQED4.js";function Ie(a,p){a&1&&(n(0,"div",14),b(1,"i",22),s(2," You have unsaved changes "),r())}function we(a,p){if(a&1){let e=K();n(0,"div",15)(1,"div",23)(2,"div",24)(3,"input",25),M("ngModelChange",function(t){let o=C(e).$implicit;return w(o().reps,t)||(o().reps=t),S(t)}),r()(),n(4,"div",24)(5,"input",26),M("ngModelChange",function(t){let o=C(e).$implicit;return w(o().weightInKg,t)||(o().weightInKg=t),S(t)}),r()()()()}if(a&2){let e=p.$implicit,i=u(2);l(3),I("ngModel",e().reps),E("disabled",!i.formEnabled())("allowDecimals",!1),l(2),I("ngModel",e().weightInKg),E("disabled",!i.formEnabled())}}function Me(a,p){a&1&&b(0,"i",20)}function Te(a,p){a&1&&(b(0,"span",27),n(1,"span",28),s(2,"Loading..."),r())}function Pe(a,p){if(a&1&&b(0,"app-exercise-log",32),a&2){let e=p.$implicit;E("exerciseLog",e)}}function ke(a,p){if(a&1&&(n(0,"div",29)(1,"div",30)(2,"div",31),s(3,"Previous entries"),r(),D(4,Pe,1,1,"app-exercise-log",32,k),_(6,"slice"),r()()),a&2){u(2);let e=U(30);l(4),V(W(6,0,e.recentLogs,0,3))}}function De(a,p){if(a&1&&b(0,"app-exercise-log",32),a&2){let e=p.$implicit;E("exerciseLog",e)}}function Ve(a,p){if(a&1&&(n(0,"div",29)(1,"div",30)(2,"div",31),s(3,"Recently Updated"),r(),D(4,De,1,1,"app-exercise-log",32,k),_(6,"slice"),r()()),a&2){let e=u(3);l(4),V(W(6,0,e.recentlyUpdated.value(),0,3))}}function Ue(a,p){if(a&1&&(n(0,"div",29)(1,"div",30)(2,"div",31),s(3,"Stats"),r(),n(4,"div",33)(5,"span",34),s(6,"Total Reps"),r(),n(7,"span",34),s(8),r(),n(9,"span",34),s(10,"Average Reps"),r(),n(11,"span",34),s(12),r(),n(13,"span",34),s(14,"Tonnage"),r(),n(15,"span",34),s(16),r()()()()),a&2){u(2);let e=U(30);l(8),g("",e.totalReps," reps"),l(4),g("",e.averageReps," reps"),l(4),g("",e.tonnage,"kg")}}function Be(a,p){if(a&1&&(n(0,"span",34),s(1),r(),n(2,"span",34),s(3),_(4,"number"),r(),n(5,"span",34),s(6),_(7,"number"),r(),n(8,"span",34),s(9),_(10,"number"),r(),n(11,"span",34),s(12),_(13,"number"),r(),n(14,"span",34),s(15),_(16,"number"),r()),a&2){let e=p.$implicit,i=p.$index;l(),g("Serie ",i+1,""),l(2),g("",h(4,6,e.brzycki,"1.2-2"),"kg"),l(3),g("",h(7,9,e.brzycki,"1.2-2"),"kg"),l(3),g("",h(10,12,e.brzycki,"1.2-2"),"kg"),l(3),g("",h(13,15,e.brzycki,"1.2-2"),"kg"),l(3),g("",h(16,18,e.brzycki,"1.2-2"),"kg")}}function Ke(a,p){if(a&1&&(n(0,"div",29)(1,"div",30)(2,"div",31),s(3,"Possible 1RM (Multiple Formulas)"),r(),n(4,"div",35),b(5,"span",34),n(6,"span",36),s(7,"Brzycki"),r(),n(8,"span",36),s(9,"Epley"),r(),n(10,"span",36),s(11,"Lander"),r(),n(12,"span",36),s(13,"Lombardi"),r(),n(14,"span",36),s(15,"Mayhew"),r(),D(16,Be,17,21,null,null,k),n(18,"span",37),s(19,"Average"),r(),n(20,"span",37),s(21),_(22,"number"),r(),n(23,"span",37),s(24),_(25,"number"),r(),n(26,"span",37),s(27),_(28,"number"),r(),n(29,"span",37),s(30),_(31,"number"),r(),n(32,"span",37),s(33),_(34,"number"),r()()()()),a&2){u(2);let e=U(30);l(16),V(e.series),l(5),g("",h(22,5,e.averageBrzycki,"1.2-2"),"kg"),l(3),g("",h(25,8,e.averageEpley,"1.2-2"),"kg"),l(3),g("",h(28,11,e.averageLander,"1.2-2"),"kg"),l(3),g("",h(31,14,e.averageLombardi,"1.2-2"),"kg"),l(3),g("",h(34,17,e.averageMayhew,"1.2-2"),"kg")}}function Re(a,p){if(a&1&&L(0,ke,7,4,"div",29)(1,Ve,7,4,"div",29)(2,Ue,17,3,"div",29)(3,Ke,35,20,"div",29),a&2){let e;u();let i=U(30),t=u();f(i?0:-1),l(),f((e=t.recentlyUpdated.value())!=null&&e.length?1:-1),l(),f(i?2:-1),l(),f(i?3:-1)}}function Ae(a,p){if(a&1){let e=K();n(0,"button",38),R("click",function(){C(e);let t=u(2);return S(t.openDeleteModal())}),b(1,"i",39),n(2,"span"),s(3,"Delete"),r()()}}function Ye(a,p){if(a&1){let e=K();n(0,"div",0)(1,"div",2)(2,"div",3)(3,"h4",4),s(4),r(),n(5,"span",5),s(6,"Record your workout details and progress"),r()(),n(7,"div"),b(8,"input",6),n(9,"div",7)(10,"input",8),M("ngModelChange",function(t){C(e);let o=u();return w(o.formSignal.date,t)||(o.formSignal.date=t),S(t)}),r()(),n(11,"div",9)(12,"app-typeahead",10),M("valueChange",function(t){C(e);let o=u();return w(o.formSignal.user,t)||(o.formSignal.user=t),S(t)}),r()(),n(13,"div",11)(14,"div",12)(15,"app-typeahead",13),M("valueChange",function(t){C(e);let o=u();return w(o.formSignal.exercise,t)||(o.formSignal.exercise=t),S(t)}),r()()(),L(16,Ie,3,0,"div",14),Y(17),n(18,"div",11),D(19,we,6,5,"div",15,k),r()(),n(21,"div",16)(22,"div",17)(23,"button",18),R("click",function(){C(e);let t=u();return S(t.cancel())}),s(24," Cancel "),r()(),n(25,"div",17)(26,"button",19),R("click",function(){C(e);let t=u();return S(t.save())}),L(27,Me,1,0,"i",20)(28,Te,3,0),s(29," Save "),r()()(),Y(30),L(31,Re,4,4)(32,Ae,4,0,"button",21),r()()}if(a&2){let e=u();l(4),g("",e.mode()==="edit"?"Edit":"Create"," Exercise Log"),l(6),I("ngModel",e.formSignal.date),E("disabled",!e.formEnabled()),l(2),I("value",e.formSignal.user),E("items",e.users())("itemSelector",e.userSelector)("disabled",!e.formEnabled()),l(3),I("value",e.formSignal.exercise),E("items",e.exerciseApiService.exercises())("itemSelector",e.exerciseSelector)("disabled",!e.formEnabled()),l(),f(e.hasUnsavedChanges()?16:-1);let i=e.formSignal.series();l(3),V(i),l(7),$("btn-primary",e.formValid())("btn-secondary",!e.formValid()||!e.hasUnsavedChanges()||e.isSaveLoading()),E("disabled",!e.formValid()||e.isSaveLoading()||e.mode()==="edit"&&!e.hasUnsavedChanges()),l(),f(e.isSaveLoading()?28:27),l(3),J(e.originalValue.value()),l(),f(e.mode()==="edit"?31:-1),l(),f(e.mode()==="edit"?32:-1)}}function We(a,p){a&1&&(n(0,"div",1)(1,"div",40)(2,"span",41),s(3,"Loading..."),r()()())}var mt=(()=>{class a{constructor(){this.exerciseLogId=G(null,{alias:"id",transform:Z}),this.authService=x(he),this.exerciseLogApiService=x(Se),this.exerciseApiService=x(_e),this.offlineQueueService=x(ve),this.location=x(te),this.router=x(oe),this.toastService=x(xe),this.titleCasePipe=x(ie),this.dayjsService=x(be),this.dayjs=this.dayjsService.instance,this.route=x(ae),this.modalService=x(me),this.isSaveLoading=c(!1),this.isLoading=ee(()=>this.originalValue.isLoading()),this.paramMap=j(this.route.paramMap),this.url=j(this.route.url,{initialValue:[]}),this.mode=T(()=>this.url().some(e=>e.path===P.CREATE)?"create":"edit"),this.formSignal={user:c(null),exercise:c(null),date:c(""),series:c([c({serieId:null,reps:c(null),weightInKg:c(null)}),c({serieId:null,reps:c(null),weightInKg:c(null)}),c({serieId:null,reps:c(null),weightInKg:c(null)}),c({serieId:null,reps:c(null),weightInKg:c(null)}),c({serieId:null,reps:c(null),weightInKg:c(null)})])},this.formValid=T(()=>!!this.formValue()),this.formValue=T(()=>{let e=this.formSignal.exercise();if(!e)return null;let i=this.formSignal.user();if(!i)return null;let t=this.formSignal.series().map(o=>o()).map(o=>({serieId:o.serieId,reps:o.reps(),weightInKg:o.weightInKg()}));return t.some(o=>!o.reps&&o.weightInKg||o.reps&&!o.weightInKg)?null:{user:i,exercise:e,date:this.formSignal.date(),series:t}}),this.formEnabled=c(!0),this.userSelector=e=>e?.name??"",this.exerciseSelector=e=>this.titleCasePipe.transform(e?.name)??"",this.users=T(()=>{let e=this.authService.user.value();return[e,...e?.assignedUsers??[]]}),this.originalValue=F({request:this.exerciseLogId,loader:({request:e})=>e?this.exerciseLogApiService.getExerciseLogById(e):q(null)}),this.recentlyUpdated=F({loader:()=>this.exerciseLogApiService.getRecentlyUpdated()}),this.hasUnsavedChanges=T(()=>{let e=this.formValue(),i=this.mode();if(i==="create"||!e)return!1;let t=this.originalValue.value();if(!t?.series||!t?.exercise||!t?.user||!t?.exerciseLogDate)return!1;let o=t?.series.map(y=>({serieId:y.serieId,weightInKg:y.weightInKg?.toString()??null,reps:y.reps?.toString()??null}))??[],m=e.series.filter(y=>!!y.reps||!!y.weightInKg);return i==="edit"&&!ue(o,m)||t?.exercise.exerciseId!==e.exercise?.exerciseId||t?.user.userId!==e.user.userId||this.dayjs(t?.exerciseLogDate).unix()!==this.dayjs(e.date).unix()}),this.setup_effect_when_original_value_throws_an_error_then_navigate_to_home(),this.setup_effect_when_mode_or_original_value_changes_then_update_form()}setup_effect_when_mode_or_original_value_changes_then_update_form(){z(()=>{let e=this.mode(),i=this.originalValue.value(),{user:t}=O(()=>({user:this.authService.user.value()}));e==="create"&&O(()=>{let o=this.dayjs().format("YYYY-MM-DD");this.formSignal.date.set(o),this.formSignal.user.set(t)}),e==="edit"&&i?.exercise&&i.exerciseLogDate&&i.user&&(this.formSignal.exercise.set(i.exercise),this.formSignal.date.set(this.dayjsService.parseDate(i.exerciseLogDate).format("YYYY-MM-DD")),this.formSignal.user.set(i.user),this.formSignal.series.update(o=>{if(!i.series)return o;for(let m=0;m<o.length;m++)o[m]?.set({serieId:i.series[m]?.serieId??null,reps:c(i.series[m]?.reps?.toString()??null),weightInKg:c(i.series[m]?.weightInKg?.toString()??null)});return o}))})}setup_effect_when_original_value_throws_an_error_then_navigate_to_home(){z(()=>{this.originalValue.error()&&this.router.navigate([P.HOME])})}openDeleteModal(){let e=this.modalService.open(fe,{centered:!0});e.componentInstance.configurate({title:"Delete Record",subtitle:"<strong>Are you sure you want to delete this record?</strong>",body:'This record will be permanently deleted. <span class="text-danger">This operation can not be undone.</span>',okType:"danger"}),e.closed.pipe(H(1)).subscribe(async()=>{let t=this.originalValue.value();if(t?.exerciseLogId)try{await Q(this.exerciseLogApiService.deleteExerciseLog(t.exerciseLogId)),this.toastService.ok("Log deleted successfully!"),this.router.navigate([P.HOME])}catch(o){let m=o;this.toastService.error(`${m.message}`)}})}async save(){let e=this.mode();this.isSaveLoading.set(!0);let i=this.formSignal.user(),t=this.formSignal.exercise(),o=this.dayjsService.parseDate(this.formSignal.date());if(!i)throw new Error("User cannot be null");if(this.formValid()){if(this.formEnabled.set(!1),e==="create"){let m=this.formSignal.series().map(d=>{let v=d();return{exerciseLogId:this.exerciseLogId(),serieId:v.serieId,reps:N(v.reps()),weightInKg:N(v.weightInKg()),brzycki:0}}),B=m.filter(d=>!!d.reps&&!!d.weightInKg),A={seriesIdsToDelete:m.filter(d=>!d.reps||!d.weightInKg).filter(d=>!!d.serieId).map(d=>d.serieId),exerciseLog:{exerciseLogUserId:i.userId,exerciseLogExerciseId:t?.exerciseId??null,exerciseLogDate:o.format("YYYY-MM-DD"),series:B,averageBrzycki:null,averageEpley:null,averageLander:null,averageLombardi:null,averageMayhew:null,averageOConner:null,averageWathan:null,totalReps:null,tonnage:null,averageReps:null,recentLogs:null,createdAtUtc:null,lastUpdatedAtUtc:null,createdByUserId:null,exercise:null,exerciseLogId:null,lastUpdatedByUserId:null,user:null}};this.offlineQueueService.enqueue({id:crypto.randomUUID(),method:"POST",endpoint:"exercise-logs",payload:A,retries:0,maxRetries:3,optimisticType:"exercise-log",userUuid:this.authService.userUuid(),onActionDone:d=>{let v=d;this.router.navigate([P.EXERCISE_LOGS,P.EDIT,v])}}),this.toastService.ok("Log enqueued for creation successfully!");try{localStorage.removeItem(Ee)}catch(d){this.toastService.error(`${d}`)}}if(e==="edit"){let m=this.formSignal.series().map(d=>{let v=d();return{exerciseLogId:this.exerciseLogId(),serieId:v.serieId,reps:Number(v.reps()),weightInKg:Number(v.weightInKg()),brzycki:0}}),B=m.filter(d=>!!d.reps&&!!d.weightInKg),A={seriesIdsToDelete:m.filter(d=>!d.reps||!d.weightInKg).filter(d=>!!d.serieId).map(d=>d.serieId),id:this.exerciseLogId(),exerciseLog:{exerciseLogUserId:i.userId,exerciseLogExerciseId:t?.exerciseId??null,exerciseLogDate:o.format("YYYY-MM-DD"),series:B,averageBrzycki:null,totalReps:null,tonnage:null,averageReps:null,recentLogs:null,createdAtUtc:null,lastUpdatedAtUtc:null,createdByUserId:null,exercise:null,exerciseLogId:null,lastUpdatedByUserId:null,user:null,averageEpley:null,averageLander:null,averageLombardi:null,averageMayhew:null,averageOConner:null,averageWathan:null}};this.offlineQueueService.enqueue({id:crypto.randomUUID(),method:"PUT",endpoint:`exercise-logs/${this.exerciseLogId()}`,payload:A,retries:0,maxRetries:3,optimisticType:"exercise-log",userUuid:this.authService.userUuid(),onActionDone:()=>{this.originalValue.reload()}}),this.toastService.ok("Log enqueued for update successfully!")}}this.isSaveLoading.set(!1),this.formEnabled.set(!0)}cancel(){this.location.back()}static{this.\u0275fac=function(i){return new(i||a)}}static{this.\u0275cmp=X({type:a,selectors:[["edit-exercise-log-page"]],inputs:{exerciseLogId:[1,"id","exerciseLogId"]},decls:2,vars:1,consts:[[1,"header-footer-padding"],[1,"position-absolute","top-50","start-50","translate-middle"],[1,"container"],[1,"pb-3"],[1,"title"],[1,"subtitle"],["type","text","autofocus","autofocus",2,"display","none"],[1,"mb-2"],["type","date","placeholder","DD-MM-YYYY",1,"form-control",3,"ngModelChange","ngModel","disabled"],[1,"col-12","mb-2"],["placeholder","User",3,"valueChange","value","items","itemSelector","disabled"],[1,"mb-3"],[1,"input-group"],["placeholder","Exercise",3,"valueChange","value","items","itemSelector","disabled"],[1,"mb-2","px-2"],[1,"pb-1"],[1,"row","g-2","mb-5"],[1,"col"],["type","button",1,"btn","btn-secondary","w-100",3,"click"],["type","button",1,"btn","w-100","d-flex","justify-content-center","align-items-center",3,"click","disabled"],["aria-hidden","true",1,"fa","fa-save","px-2"],["type","button",1,"btn","btn-danger","w-100","delete-button"],["aria-hidden","true",1,"fa","fa-exclamation-circle"],[1,"row","g-2"],[1,"col-6"],["type","text","inputmode","decimal","placeholder","Reps","onlyNumbers","",1,"form-control",3,"ngModelChange","ngModel","disabled","allowDecimals"],["type","text","inputmode","decimal","placeholder","Weight (Kg)","onlyNumbers","",1,"form-control",3,"ngModelChange","ngModel","disabled"],["aria-hidden","true",1,"spinner-border","spinner-border-sm","mx-2"],["role","status",1,"visually-hidden"],[1,"card","mb-3"],[1,"card-body"],[1,"card-title"],[1,"w-100",3,"exerciseLog"],[2,"display","grid","grid-template-columns","1fr 1fr"],[1,"serie-label"],[2,"display","grid","grid-template-columns","repeat(6, 1fr)"],[1,"serie-label","pb-2"],[1,"serie-label","pt-2"],["type","button",1,"btn","btn-danger","w-100","delete-button",3,"click"],["aria-hidden","true",1,"fa","fa-trash","px-2"],["role","status",1,"robertly-spinner","spinner-border","text-primary"],[1,"visually-hidden"]],template:function(i,t){i&1&&L(0,Ye,33,21,"div",0)(1,We,4,0,"div",1),i&2&&f(t.isLoading()?1:0)},dependencies:[pe,se,le,ce,de,ge,Ce,ye,ne,re,Le],styles:["[_nghost-%COMP%]{--bs-body-bg: var(--light-bg);--bs-body-color: var(--font-color);--bs-tertiary-bg: var(--primary);--bs-border-width: 1px;--bs-border-color: rgba(255, 255, 255, .15)}.card[_ngcontent-%COMP%]{--bs-card-spacer-y: .5rem;--bs-card-spacer-x: .5rem}.title[_ngcontent-%COMP%]{margin:0}.subtitle[_ngcontent-%COMP%]{font-size:14px;opacity:.7}.card[_ngcontent-%COMP%]{background-color:var(--bg);border:1px solid rgba(255,255,255,.1)}.serie-label[_ngcontent-%COMP%]{font-size:12px;color:#ffffffbf}.delete-button[_ngcontent-%COMP%]{background-color:#301b23;--bs-btn-border-color: #6e363b;color:#fa8989}"],changeDetection:0})}}return a})();export{mt as EditExerciseLogPageComponent};
