import{a as te}from"./chunk-KMRCF7MH.js";import{a as oe}from"./chunk-7VF7C7KY.js";import{a as ne}from"./chunk-MJOXRQPP.js";import{a as ee}from"./chunk-ATME4OV3.js";import{c as q,e as G,r as x,u as $,w as v}from"./chunk-MZNJ3QJ4.js";import{$c as X,Ab as y,Cb as A,Dc as z,Gc as U,Ka as d,Kb as I,Mb as b,N as D,Ob as O,Qb as p,Qc as H,Rb as c,Sb as g,Sc as J,Ua as L,Uc as K,Wc as Q,Zb as R,cd as Y,ea as u,hc as _,ic as B,ja as V,ka as W,mb as M,mc as j,nb as E,nd as Z,rb as f,sb as r,ta as m,tb as a,u as N,ub as S,y as F,yb as k}from"./chunk-QFD2HAQI.js";var re=()=>["g","ml","u","tbsp","tsp"];function ae(l,s){l&1&&S(0,"i",15)}function de(l,s){l&1&&(S(0,"span",17),r(1,"span",18),b(2,"Loading..."),a())}function le(l,s){if(l&1){let ie=k();r(0,"button",19),y("click",function(){V(ie);let n=A();return W(n.openDeleteModal())}),S(1,"i",20),r(2,"span"),b(3,"Delete"),a()()}}var Pe=(()=>{let s=class s{constructor(){this.location=u(z),this.router=u(G),this.toastService=u(x),this.titleCasePipe=u(U),this.route=u(q),this.modalService=u(Z),this.foodsApiService=u(ne),this.foodIdFromRoute=j(void 0,{alias:"id"}),this.url=H(this.route.url,{initialValue:[]}),this.mode=_(()=>this.url().some(o=>o.path===v.CREATE)?"create":"edit"),this.food=J({stream:()=>{let o=this.foodIdFromRoute();return o?this.foodsApiService.getFoodById(o):N(null)}}),this.isSaveLoading=m(!1),this.titleCaseSelector=o=>o?this.titleCasePipe.transform(o):"",this.foodFormSignal={name:m(null),calories:m(null),protein:m(null),fat:m(null),unit:m(null),amount:m(null)},this.foodFormValue=_(()=>{let o=this.foodFormSignal.name();if(!o)return null;let n=this.foodFormSignal.fat(),e=te(n),i=this.foodFormSignal.calories(),t=i?Number(i):null;if(t==null)return null;let C=this.foodFormSignal.protein(),h=C?Number(C):null;if(h==null)return null;let w=this.foodFormSignal.unit();if(!w)return null;let P=this.foodFormSignal.amount(),T=P?Number(P):null;return T?{name:o,calories:t,protein:h,fat:e,unit:w,amount:T}:null}),this.foodFormEnabled=m(!0),this.foodFormValid=_(()=>{let o=this.foodFormValue();if(!o)return!1;let{name:n,calories:e,protein:i,unit:t,fat:C,amount:h}=o;return!0}),B(()=>{let o=this.food.value();o&&(this.foodFormSignal.name.set(o.name),this.foodFormSignal.calories.set(o.calories.toString()),this.foodFormSignal.protein.set(o.protein.toString()),this.foodFormSignal.fat.set(o.fat?.toString()??""),this.foodFormSignal.unit.set(o.unit),this.foodFormSignal.amount.set(o.amount.toString()))})}openDeleteModal(){let o=this.modalService.open($,{centered:!0});o.componentInstance.configurate({title:"Delete Record",subtitle:"<strong>Are you sure you want to delete this record?</strong>",body:'This record will be permanently deleted. <span class="text-danger">This operation can not be undone.</span>',okType:"danger"}),o.closed.pipe(D(1)).subscribe(async()=>{let e=this.food.value();if(e?.foodId)try{await F(this.foodsApiService.deleteFood(e.foodId)),this.router.navigate([v.FOODS])}catch(i){let t=i;this.toastService.error(`${t.message}`)}})}async save(){let o=this.foodFormValue();if(!o||!this.foodFormValid())return;this.isSaveLoading.set(!0),this.foodFormEnabled.set(!1);let n={foodId:this.food.value()?.foodId??null,name:o.name,calories:o.calories,protein:o.protein,fat:o.fat,unit:o.unit.toLowerCase(),amount:o.amount};try{this.mode()==="create"?await F(this.foodsApiService.createFood(n)):await F(this.foodsApiService.updateFood(n))}catch{this.toastService.error("An error ocurred while saving this food.")}finally{this.isSaveLoading.set(!1),this.foodFormEnabled.set(!0),this.router.navigate([v.FOODS])}}cancel(){this.location.back()}};s.\u0275fac=function(n){return new(n||s)},s.\u0275cmp=L({type:s,selectors:[["edit-food-page"]],inputs:{foodIdFromRoute:[1,"id","foodIdFromRoute"]},decls:28,vars:22,consts:[[1,"header-footer-padding"],[1,"container"],[1,"pb-3"],[1,"title"],[1,"mb-3"],["type","text","placeholder","Name",1,"form-control",3,"ngModelChange","ngModel","disabled"],["type","text","placeholder","Calories","onlyNumbers","",1,"form-control",3,"ngModelChange","ngModel","disabled"],["type","text","placeholder","Protein","onlyNumbers","",1,"form-control",3,"ngModelChange","ngModel","disabled"],["type","text","placeholder","Fat","onlyNumbers","",1,"form-control",3,"ngModelChange","ngModel","disabled"],["placeholder","Unit",3,"valueChange","value","items","disabled"],["type","text","placeholder","Amount Per Unit","onlyNumbers","",1,"form-control",3,"ngModelChange","ngModel","disabled"],[1,"row","g-2","mb-3"],[1,"col"],["type","button",1,"btn","btn-secondary","w-100",3,"click"],["type","button",1,"btn","w-100","d-flex","justify-content-center","align-items-center",3,"click","disabled"],["aria-hidden","true",1,"fa","fa-save","px-2"],["type","button",1,"btn","btn-danger","w-100","delete-button"],["aria-hidden","true",1,"spinner-border","spinner-border-sm","mx-2"],["role","status",1,"visually-hidden"],["type","button",1,"btn","btn-danger","w-100","delete-button",3,"click"],["aria-hidden","true",1,"fa","fa-trash","px-2"]],template:function(n,e){n&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4",3),b(4),a()(),r(5,"div")(6,"div",4)(7,"input",5),g("ngModelChange",function(t){return c(e.foodFormSignal.name,t)||(e.foodFormSignal.name=t),t}),a()(),r(8,"div",4)(9,"input",6),g("ngModelChange",function(t){return c(e.foodFormSignal.calories,t)||(e.foodFormSignal.calories=t),t}),a()(),r(10,"div",4)(11,"input",7),g("ngModelChange",function(t){return c(e.foodFormSignal.protein,t)||(e.foodFormSignal.protein=t),t}),a()(),r(12,"div",4)(13,"input",8),g("ngModelChange",function(t){return c(e.foodFormSignal.fat,t)||(e.foodFormSignal.fat=t),t}),a()(),r(14,"div",4)(15,"app-typeahead",9),g("valueChange",function(t){return c(e.foodFormSignal.unit,t)||(e.foodFormSignal.unit=t),t}),a()(),r(16,"div",4)(17,"input",10),g("ngModelChange",function(t){return c(e.foodFormSignal.amount,t)||(e.foodFormSignal.amount=t),t}),a()()(),r(18,"div",11)(19,"div",12)(20,"button",13),y("click",function(){return e.cancel()}),b(21," Cancel "),a()(),r(22,"div",12)(23,"button",14),y("click",function(){return e.save()}),M(24,ae,1,0,"i",15)(25,de,3,0),b(26," Save "),a()()(),M(27,le,4,0,"button",16),a()()),n&2&&(d(4),O("",e.mode()==="edit"?"Edit":"Create"," Food"),d(3),p("ngModel",e.foodFormSignal.name),f("disabled",!e.foodFormEnabled()),d(2),p("ngModel",e.foodFormSignal.calories),f("disabled",!e.foodFormEnabled()),d(2),p("ngModel",e.foodFormSignal.protein),f("disabled",!e.foodFormEnabled()),d(2),p("ngModel",e.foodFormSignal.fat),f("disabled",!e.foodFormEnabled()),d(2),p("value",e.foodFormSignal.unit),f("items",R(21,re))("disabled",!e.foodFormEnabled()),d(2),p("ngModel",e.foodFormSignal.amount),f("disabled",!e.foodFormEnabled()),d(6),I("btn-primary",e.foodFormValid())("btn-secondary",!e.foodFormValid()||e.isSaveLoading()),f("disabled",!e.foodFormValid()||e.isSaveLoading()),d(),E(e.isSaveLoading()?25:24),d(3),E(e.mode()==="edit"?27:-1))},dependencies:[Y,K,Q,X,ee,oe],styles:["[_nghost-%COMP%]{--bs-body-bg: var(--light-bg);--bs-body-color: var(--font-color);--bs-tertiary-bg: var(--primary);--bs-border-width: 1px;--bs-border-color: rgba(255, 255, 255, .15)}.card[_ngcontent-%COMP%]{--bs-card-spacer-y: .5rem;--bs-card-spacer-x: .5rem}.title[_ngcontent-%COMP%]{margin:0}.subtitle[_ngcontent-%COMP%]{font-size:14px;opacity:.7}.card[_ngcontent-%COMP%]{background-color:var(--bg);border:1px solid rgba(255,255,255,.1)}.serie-label[_ngcontent-%COMP%]{font-size:12px;color:#ffffffbf;padding:0 .5rem}.delete-button[_ngcontent-%COMP%]{background-color:#301b23;--bs-btn-border-color: #6e363b;color:#fa8989}"],changeDetection:0});let l=s;return l})();export{Pe as EditFoodPageComponent};
