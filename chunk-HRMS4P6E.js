import{a as ye}from"./chunk-LQH2WIU5.js";import{a as Se}from"./chunk-XC7JP2KN.js";import{$ as _e,A as ue,B as ge,C as xe,J as he,W as fe,Z as ve,a as te,aa as Ce,b as ie,ca as Le,d as k,da as be,e as oe,ea as Ee,fa as y,l as re,o as ne,p as ae,q as se,s as le,t as ce,v as de,y as pe,z as me}from"./chunk-YAGZ6F4K.js";import{f as Q,h as W,j as X,l as Z,m as ee}from"./chunk-QN4ZLGYB.js";import{Cc as R,Dc as H,Eb as x,Ec as J,Fb as f,Fc as U,Hb as v,Ib as _,Jb as s,Kb as n,Lb as m,Ob as G,Sb as V,T as P,Tb as u,a as $,b as O,bb as a,bc as c,cc as Y,dc as C,g as B,jb as j,jc as q,kc as K,lc as z,nc as E,oc as F,pc as A,qa as d,tb as M,v as N,xb as g,ya as S,z as D,za as I,zb as p}from"./chunk-RORB2MO5.js";var Ie=t=>({"justify-content-between":t}),Ve=(t,o)=>({"btn-primary":t,"btn-secondary":o}),ke=()=>[];function Te(t,o){if(t&1&&(s(0,"div",19),c(1),n()),t&2){let e=o.$implicit;a(),Y(e.value)}}function we(t,o){if(t&1&&(v(0,Te,2,1,"div",19,f),E(2,"keyvalue")),t&2){let e,i=u(2);_(F(2,0,(e=i.formGroup().errors)==null?null:e.exercise))}}function De(t,o){t&1&&(s(0,"div",13),m(1,"i",20),c(2," You have unsaved changes "),n())}function Pe(t,o){if(t&1&&(s(0,"div",14)(1,"span",21),c(2),n(),m(3,"input",22)(4,"input",23),n()),t&2){let e=o.$implicit,i=o.$index;a(2),C("Serie ",i+1,""),a(),p("formControl",e.controls.reps),a(),p("formControl",e.controls.weightInKg)}}function Me(t,o){if(t&1&&(s(0,"div",19),c(1),n()),t&2){let e=o.$implicit;a(),Y(e.value)}}function Ge(t,o){if(t&1&&(v(0,Me,2,1,"div",19,f),E(2,"keyvalue")),t&2){let e,i=u(2);_(F(2,0,(e=i.formGroup().errors)==null?null:e.series))}}function Ye(t,o){if(t&1){let e=G();s(0,"button",24),V("click",function(){S(e);let r=u(2);return I(r.openDeleteModal())}),c(1," Delete "),n()}}function Fe(t,o){if(t&1&&m(0,"app-exercise-log",27),t&2){let e=o.$implicit;p("exerciseLog",e)}}function Ae(t,o){if(t&1&&(s(0,"ul",29)(1,"li",30),c(2),n(),s(3,"li",31),c(4),E(5,"number"),n()()),t&2){let e=o.$implicit,i=o.$index;a(2),C("Serie ",i+1,""),a(2),C("",A(5,2,e.brzycki,"1.2-2"),"kg")}}function Re(t,o){if(t&1&&(s(0,"div",25)(1,"div",26),c(2,"Previous entries"),n(),v(3,Fe,1,1,"app-exercise-log",27,f),n(),s(5,"div",28)(6,"div",26),c(7,"Possible 1RM (Brzycky Formula)"),n(),v(8,Ae,6,5,"ul",29,f),s(10,"ul",29)(11,"li",30),c(12,"Average"),n(),s(13,"li",31),c(14),E(15,"number"),n()()()),t&2){let e,i,r,l=u(2);a(3),_((e=(e=l.originalValue.value())==null?null:e.recentLogs)!==null&&e!==void 0?e:q(4,ke)),a(5),_((i=l.originalValue.value())==null?null:i.series),a(6),C("",A(15,1,(r=l.originalValue.value())==null?null:r.brzyckiAverage,"1.2-2"),"kg")}}function Ue(t,o){if(t&1){let e=G();s(0,"div",1)(1,"div",3)(2,"h4",4),c(3),n()(),s(4,"div",5)(5,"form"),m(6,"input",6),s(7,"div",7),m(8,"input",8),n(),s(9,"div",7),m(10,"input",9),n(),s(11,"div",10)(12,"div",11),m(13,"app-typeahead",12),n(),g(14,we,3,2),n(),g(15,De,3,0,"div",13),v(16,Pe,5,3,"div",14,f),g(18,Ge,3,2),n()(),s(19,"div",15),g(20,Ye,2,0,"button",16),s(21,"button",17),V("click",function(){S(e);let r=u();return I(r.cancel())}),c(22," Cancel "),n(),s(23,"button",18,0),V("click",function(){S(e);let r=u();return I(r.save())}),c(25," Save "),n(),g(26,Re,16,5),n()()}if(t&2){let e=u();a(3),C(" ",e.mode()==="edit"?"Edit":"Create"," Log "),a(5),p("formControl",e.formGroup().controls.date),a(2),p("formControl",e.formGroup().controls.user),a(3),p("items",e.exerciseLogService.exercises())("control",e.formGroup().controls.exercise)("itemSelector",e.exerciseSelector),a(),x(e.formGroup().controls.exercise.pristine?-1:14),a(),x(e.hasUnsavedChanges()?15:-1),a(),_(e.formGroup().controls.series.controls),a(2),x(e.formGroup().controls.series.pristine?-1:18),a(),p("ngClass",K(14,Ie,e.mode()==="edit")),a(),x(e.mode()==="edit"?20:-1),a(3),p("ngClass",z(16,Ve,e.formGroup().valid,e.formGroup().invalid))("disabled",e.formGroup().invalid),a(3),x(e.mode()==="edit"?26:-1)}}function $e(t,o){t&1&&(s(0,"div",2)(1,"div",32)(2,"span",33),c(3,"Loading..."),n()()())}var xt=(()=>{class t{constructor(){this.exerciseLogService=d(ae),this.location=d(Q),this.router=d(ie),this.toastService=d(Ce),this.authService=d(Le),this.exerciseLogApiService=d(ne),this.titleCasePipe=d(X),this.dayjsService=d(_e),this.dayjs=this.dayjsService.instance,this.route=d(te),this.modalService=d(he),this.isLoading=H(()=>this.originalValue.isLoading()),this.paramMap=k(this.route.paramMap),this.exerciseLogId=R(()=>this.paramMap()?.get(y.LOGS_ID_PARAM)),this.url=k(this.route.url,{initialValue:[]}),this.mode=R(()=>this.url().some(e=>e.path===y.LOGS_CREATE)?"create":"edit"),this.formGroup=M(be()),this.formGroupValue=k(this.formGroup().valueChanges),this.originalValue=oe({request:this.exerciseLogId,loader:({request:e})=>{let i=Number(e);return i?this.exerciseLogApiService.getExerciseLogById(i):N(null)}}),this.#e=U(()=>{let e=this.mode(),i=this.originalValue.value();e==="create"&&J(()=>{let r=this.authService.user(),l=this.dayjs().format("YYYY-MM-DD");this.formGroup.update(h=>(h.patchValue({date:l,user:r?.name??""}),h))}),e==="edit"&&i&&i&&this.formGroup.update(r=>(r.reset(),r.patchValue({exercise:i.exercise,date:this.dayjsService.parseDate(i.date).format("YYYY-MM-DD"),user:i.user.name,series:i.series.map(l=>({exerciseLogId:l.exerciseLogId,serieId:l.serieId,reps:l.reps,weightInKg:l.weightInKg}))}),r))}),this.hasUnsavedChanges=M(!1),this.#t=U(()=>{let e=this.formGroupValue(),i=this.originalValue.value(),r=this.mode();if(!e){this.hasUnsavedChanges.set(!1);return}let l={series:T(i?.series.map(L=>O($({},L),{brzycki:null})))??[]},h={series:T(e.series)};this.hasUnsavedChanges.set(r==="edit"&&!re(l,h))}),this.exerciseSelector=e=>typeof e=="string"?"":this.titleCasePipe.transform(e?.name)??""}#e;#t;openDeleteModal(){let e=this.modalService.open(Ee,{centered:!0}),i=e.componentInstance;i.title="Delete Record",i.subtitle="<strong>Are you sure you want to delete this record?</strong>",i.body='This record will be permanently deleted. <span class="text-danger">This operation can not be undone.</span>',i.okType="danger",e.closed.pipe(P(1)).subscribe(()=>{this.exerciseLogService.deleteLog$.next(this.originalValue.value())})}save(){return B(this,null,function*(){let e=this.mode(),i=this.formGroup();this.isLoading.set(!0);let r=i.value.exercise,l=this.dayjsService.parseDate(i.value.date),h=this.originalValue.value(),L=this.authService.user();if(!L)throw new Error("User cannot be null");if(i.valid&&typeof r!="string"&&r){if(e==="create"){let w=Oe(i,L,r,l);try{let b=yield D(this.exerciseLogApiService.createExerciseLog(w));localStorage.removeItem(ve),this.toastService.ok("Log created successfully!"),this.router.navigate([y.LOGS,y.LOGS_EDIT,b])}catch(b){this.toastService.error(`${b}`)}}if(e==="edit"){let w=Ne(h?.id,i,L,r,l);try{yield D(this.exerciseLogApiService.updateExerciseLog(w)),this.toastService.ok("Log updated successfully!"),this.originalValue.reload()}catch(b){this.toastService.error(`${b}`)}}}this.isLoading.set(!1)})}cancel(){this.exerciseLogService.refreshLogs$.pipe(P(1)).subscribe(()=>{this.location.back()}),this.exerciseLogService.refreshLogs$.next()}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=j({type:t,selectors:[["edit-exercise-log-page"]],decls:2,vars:1,consts:[["saveButton",""],[1,"footer-padding"],[1,"position-absolute","top-50","start-50","translate-middle"],[1,"modal-header"],["id","modal-basic-title",1,"modal-title"],[1,"modal-body"],["type","text","autofocus","autofocus",2,"display","none"],[1,"mb-2"],["type","date","placeholder","DD-MM-YYYY",1,"form-control",3,"formControl"],["type","text","placeholder","User",1,"form-control",3,"formControl"],[1,"mb-3"],[1,"input-group"],["placeholder","Exercise",3,"items","control","itemSelector"],[1,"mb-2","px-2"],[1,"input-group","mb-2","align-items-center"],[1,"modal-footer",3,"ngClass"],["type","button",1,"btn","btn-danger","me-auto"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn",3,"click","ngClass","disabled"],[1,"d-block","invalid-feedback"],["aria-hidden","true",1,"fa","fa-exclamation-circle"],[1,"input-group-text"],["type","number","placeholder","Reps",1,"form-control",3,"formControl"],["type","number","placeholder","Kg",1,"form-control",3,"formControl"],["type","button",1,"btn","btn-danger","me-auto",3,"click"],[1,"pt-5","w-100"],[1,"pb-2"],[1,"w-100",3,"exerciseLog"],[1,"pt-3","w-100"],[1,"list-group","list-group-horizontal","pb-1"],[1,"list-group-item","active"],[1,"list-group-item"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"]],template:function(i,r){i&1&&g(0,Ue,27,19,"div",1)(1,$e,4,0,"div",2),i&2&&x(r.isLoading()?1:0)},dependencies:[xe,pe,se,me,le,ce,ue,ge,de,fe,ye,Se,Z,ee,W],styles:["[_nghost-%COMP%]{display:block;padding:0 .5rem;--bs-heading-color: white;--bs-modal-color: white;--bs-body-bg: var(--light-bg);--bs-body-color: var(--font-color);--bs-tertiary-bg: var(--primary);--bs-border-width: 0;--bs-modal-footer-border-width: 0;--bs-modal-header-border-width: 0;--bs-modal-header-padding: .5rem}.list-group[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 3fr;--bs-list-group-bg: var(--light-bg)}.list-group[_ngcontent-%COMP%]   .active[_ngcontent-%COMP%]{--bs-list-group-active-bg: var(--primary)}"],changeDetection:0})}}return t})();function Oe(t,o,e,i){return Be(o?.userId,o?.name??t.value.user,e.exerciseId,i,T(t.value.series))}function Be(t,o,e,i,r){return je(null,t,o,e,i,r)}function Ne(t,o,e,i,r){return{id:t,exerciseLog:{exerciseLogUsername:e?.name??o.value.user.toLocaleLowerCase(),exerciseLogUserId:e.userId,exerciseLogExerciseId:i.exerciseId,exerciseLogDate:r.format("YYYY-MM-DD"),series:T(o.value.series)}}}function je(t,o,e,i,r,l){return{id:t?.id,exerciseLog:{exerciseLogUsername:e.toLocaleLowerCase(),exerciseLogUserId:o,exerciseLogExerciseId:i,exerciseLogDate:r.format("YYYY-MM-DD"),series:l}}}function qe(t){return{exerciseLogId:t.exerciseLogId,serieId:t.serieId,reps:+t.reps,weightInKg:+t.weightInKg.toFixed(1),brzycki:null}}function T(t){return(t??[]).filter(o=>!!o.reps&&!!o.weightInKg).map(qe)}export{xt as EditExerciseLogPageComponent};
