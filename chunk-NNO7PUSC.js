import{a as oe}from"./chunk-7VF7C7KY.js";import{a as te}from"./chunk-MJOXRQPP.js";import{a as Z}from"./chunk-ATME4OV3.js";import{a as $}from"./chunk-4NXJAWG4.js";import{a as ee}from"./chunk-JWGIT43Z.js";import{c as j,e as B,r as K,t as Q,u as X,w,y as ie}from"./chunk-MZNJ3QJ4.js";import{$c as q,Ab as x,Cb as m,Dc as W,Gc as I,Ka as l,Kb as A,Mb as u,N as D,Ob as k,Qb as _,Qc as z,Rb as b,Sb as v,Sc as V,Ua as T,Uc as G,Wc as U,cd as J,ea as s,gc as O,hc as h,ic as N,ja as c,jc as R,ka as g,mb as y,mc as Y,nb as F,nd as H,rb as L,sb as r,ta as f,tb as a,u as P,ub as S,y as C,yb as M}from"./chunk-QFD2HAQI.js";function ne(n,d){n&1&&S(0,"i",16)}function re(n,d){n&1&&(S(0,"span",18),r(1,"span",19),u(2,"Loading..."),a())}function ae(n,d){if(n&1){let t=M();r(0,"button",20),x("click",function(){c(t);let o=m(2);return g(o.openDeleteModal())}),S(1,"i",21),r(2,"span"),u(3,"Delete"),a()()}}function de(n,d){if(n&1){let t=M();r(0,"div",0)(1,"div",2)(2,"div",3)(3,"h4",4),u(4),a(),r(5,"span",5),u(6,"Track your daily meals and your calorie intake"),a()(),r(7,"div")(8,"div",6)(9,"input",7),v("ngModelChange",function(o){c(t);let i=m();return b(i.foodLogForm.date,o)||(i.foodLogForm.date=o),g(o)}),a()(),r(10,"div",8)(11,"app-typeahead",9),v("valueChange",function(o){c(t);let i=m();return b(i.foodLogForm.user,o)||(i.foodLogForm.user=o),g(o)}),a()(),r(12,"div",8)(13,"app-typeahead",10),v("valueChange",function(o){c(t);let i=m();return b(i.foodLogForm.food,o)||(i.foodLogForm.food=o),g(o)}),a()(),r(14,"div",6)(15,"input",11),v("ngModelChange",function(o){c(t);let i=m();return b(i.foodLogForm.amount,o)||(i.foodLogForm.amount=o),g(o)}),a()()(),r(16,"div",12)(17,"div",13)(18,"button",14),x("click",function(){c(t);let o=m();return g(o.cancel())}),u(19," Cancel "),a()(),r(20,"div",13)(21,"button",15),x("click",function(){c(t);let o=m();return g(o.save())}),y(22,ne,1,0,"i",16)(23,re,3,0),u(24," Save "),a()()(),y(25,ae,4,0,"button",17),a()()}if(n&2){let t=m();l(4),k("",t.mode()==="edit"?"Edit":"Create"," Food Log"),l(5),_("ngModel",t.foodLogForm.date),l(2),_("value",t.foodLogForm.user),L("items",t.users())("itemSelector",t.userSelector),l(2),_("value",t.foodLogForm.food),L("items",t.foods.value())("itemSelector",t.foodSelector),l(2),L("placeholder",t.amountPlaceholder()),_("ngModel",t.foodLogForm.amount),l(6),A("btn-primary",t.foodLogFormValid())("btn-secondary",!t.foodLogFormValid()||t.isSaveLoading()),L("disabled",!t.foodLogFormValid()||t.isSaveLoading()),l(),F(t.isSaveLoading()?23:22),l(3),F(t.mode()==="edit"?25:-1)}}function se(n,d){n&1&&(r(0,"div",1)(1,"div",22)(2,"span",23),u(3,"Loading..."),a()()())}var Ee=(()=>{let d=class d{constructor(){this.location=s(W),this.router=s(B),this.toastService=s(K),this.titleCasePipe=s(I),this.route=s(j),this.modalService=s(H),this.authService=s(Q),this.dayjs=s(ie),this.foodLogsApiService=s($),this.foodsApiService=s(te),this.foodLogIdFromRoute=Y(void 0,{alias:"id"}),this.isLoading=R(()=>this.originalValue.isLoading()||this.foods.isLoading()),this.url=z(this.route.url,{initialValue:[]}),this.mode=h(()=>this.url().some(e=>e.path===w.CREATE)?"create":"edit"),this.foods=V({stream:()=>this.foodsApiService.getFoods(),defaultValue:[]}),this.userSelector=e=>typeof e=="string"?"":e?.name??"",this.foodSelector=e=>typeof e=="string"?"":this.titleCasePipe.transform(e?.name)??"",this.users=h(()=>{let e=this.authService.user.value();return[e,...e?.assignedUsers??[]]}),this.isSaveLoading=f(!1),this.titleCaseSelector=e=>e?this.titleCasePipe.transform(e):"",this.originalValue=V({params:this.foodLogIdFromRoute,stream:({params:e})=>e?this.foodLogsApiService.getFoodLogById(e):P(null)}),this.foodLogForm={user:f(null),food:f(null),date:f(null),amount:f(null)},this.foodLogFormValue=h(()=>this.foodLogForm),this.foodLogFormValid=h(()=>!0),this.foodLogFormEnabled=f(!0),this.amountPlaceholder=h(()=>{let e=this.foodLogForm.food();return e?`Amount (${e.unit})`:"Amount"}),N(()=>{let e=this.mode(),o=this.originalValue.value(),i=O(()=>this.authService.user.value());if(e==="create"){let p=this.dayjs().format("YYYY-MM-DD");this.foodLogForm.date.set(p),this.foodLogForm.user.set(i)}e==="edit"&&o&&(this.foodLogForm.date.set(this.dayjs(o.date,[...ee]).format("YYYY-MM-DD")),this.foodLogForm.food.set(o.food),this.foodLogForm.user.set(o.user),this.foodLogForm.amount.set(o.amount.toString()))})}openDeleteModal(){let e=this.modalService.open(X,{centered:!0});e.componentInstance.configurate({title:"Delete Record",subtitle:"<strong>Are you sure you want to delete this record?</strong>",body:'This record will be permanently deleted. <span class="text-danger">This operation can not be undone.</span>',okType:"danger"}),e.closed.pipe(D(1)).subscribe(async()=>{let i=this.originalValue.value();if(i?.foodLogId)try{await C(this.foodLogsApiService.deleteFoodLog(i.foodLogId)),this.router.navigate([w.FOOD_LOGS])}catch(p){let E=p;this.toastService.error(`${E.message}`)}})}async save(){if(!this.foodLogFormValid())return;let e=this.originalValue.value(),o=this.foodLogForm.user(),i=this.foodLogForm.food();if(!this.foodLogFormValid()||!i||!o)return;this.isSaveLoading.set(!0),this.foodLogFormEnabled.set(!1);let p={foodLogId:e?.foodLogId??null,date:this.foodLogForm.date(),user:o,food:i,amount:Number(this.foodLogForm.amount())};try{this.mode()==="create"?await C(this.foodLogsApiService.createFoodLog(p)):await C(this.foodLogsApiService.updateFoodLog(p))}catch{this.toastService.error("An error ocurred while saving the log.")}finally{this.isSaveLoading.set(!1),this.foodLogFormEnabled.set(!0),this.router.navigate([w.FOOD_LOGS])}}cancel(){this.location.back()}};d.\u0275fac=function(o){return new(o||d)},d.\u0275cmp=T({type:d,selectors:[["edit-food-log-page"]],inputs:{foodLogIdFromRoute:[1,"id","foodLogIdFromRoute"]},decls:2,vars:1,consts:[[1,"header-footer-padding"],[1,"position-absolute","top-50","start-50","translate-middle"],[1,"container"],[1,"pb-3"],[1,"title"],[1,"subtitle"],[1,"mb-2"],["type","date","placeholder","DD-MM-YYYY",1,"form-control",3,"ngModelChange","ngModel"],[1,"mb-3"],["placeholder","User",3,"valueChange","value","items","itemSelector"],["placeholder","Food",3,"valueChange","value","items","itemSelector"],["type","text","onlyNumbers","",1,"form-control",3,"ngModelChange","placeholder","ngModel"],[1,"row","g-2","mb-3"],[1,"col"],["type","button",1,"btn","btn-secondary","w-100",3,"click"],["type","button",1,"btn","w-100","d-flex","justify-content-center","align-items-center",3,"click","disabled"],["aria-hidden","true",1,"fa","fa-save","px-2"],["type","button",1,"btn","btn-danger","w-100","delete-button"],["aria-hidden","true",1,"spinner-border","spinner-border-sm","mx-2"],["role","status",1,"visually-hidden"],["type","button",1,"btn","btn-danger","w-100","delete-button",3,"click"],["aria-hidden","true",1,"fa","fa-trash","px-2"],["role","status",1,"robertly-spinner","spinner-border","text-primary"],[1,"visually-hidden"]],template:function(o,i){o&1&&y(0,de,26,17,"div",0)(1,se,4,0,"div",1),o&2&&F(i.isLoading()?1:0)},dependencies:[J,G,U,q,Z,oe],styles:["[_nghost-%COMP%]{--bs-body-bg: var(--light-bg);--bs-body-color: var(--font-color);--bs-tertiary-bg: var(--primary);--bs-border-width: 1px;--bs-border-color: rgba(255, 255, 255, .15)}.card[_ngcontent-%COMP%]{--bs-card-spacer-y: .5rem;--bs-card-spacer-x: .5rem}.title[_ngcontent-%COMP%]{margin:0}.subtitle[_ngcontent-%COMP%]{font-size:14px;opacity:.7}.card[_ngcontent-%COMP%]{background-color:var(--bg);border:1px solid rgba(255,255,255,.1)}.serie-label[_ngcontent-%COMP%]{font-size:12px;color:#ffffffbf;padding:0 .5rem}.delete-button[_ngcontent-%COMP%]{background-color:#301b23;--bs-btn-border-color: #6e363b;color:#fa8989}"],changeDetection:0});let n=d;return n})();export{Ee as EditFoodLogPageComponent};
