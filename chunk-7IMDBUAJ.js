import{a as te}from"./chunk-FPQFDGDB.js";import{a as oe}from"./chunk-LJA7ROG2.js";import{c as q,d as G,n as $,q as ee,w as y}from"./chunk-6PXCT3Y7.js";import{A as Z,I as x,b as H,d as J,e as K,g as Q,l as X,p as Y}from"./chunk-FDMSHLJI.js";import{$b as f,Bb as M,Fb as r,Gb as a,Hb as b,Ia as A,Jc as z,Ka as s,Kb as O,Mb as F,Nb as R,Nc as U,R as V,Ya as d,Yb as g,_b as N,ac as p,bc as c,gc as B,ib as I,ma as m,nb as v,t as W,ua as k,va as L,wb as u,x as h,yb as D,yc as S,zc as j}from"./chunk-SEHCXKDS.js";var ne=()=>["g","ml"];function ie(l,E){l&1&&b(0,"i",15)}function re(l,E){l&1&&(b(0,"span",17),r(1,"span",18),g(2,"Loading..."),a())}function ae(l,E){if(l&1){let o=O();r(0,"button",19),F("click",function(){k(o);let e=R();return L(e.openDeleteModal())}),b(1,"i",20),r(2,"span"),g(3,"Delete"),a()()}}var ve=(()=>{class l{constructor(){this.location=m(z),this.router=m(G),this.toastService=m($),this.titleCasePipe=m(U),this.route=m(q),this.modalService=m(Z),this.foodsApiService=m(te),this.foodIdFromRoute=A(void 0,{alias:"id"}),this.url=H(this.route.url,{initialValue:[]}),this.mode=S(()=>this.url().some(o=>o.path===y.CREATE)?"create":"edit"),this.food=J({loader:()=>{let o=this.foodIdFromRoute();return o?this.foodsApiService.getFoodById(o):W(null)}}),this.isSaveLoading=s(!1),this.titleCaseSelector=o=>o?this.titleCasePipe.transform(o):"",this.foodFormSignal={name:s(null),calories:s(null),protein:s(null),fat:s(null),unit:s(null),amount:s(null)},this.foodFormValue=S(()=>{let o=this.foodFormSignal.name();if(!o)return null;let n=this.foodFormSignal.fat();if(n!==""&&!/$[\d+]^/.test(n??""))return null;let e=n?Number(n):null,i=this.foodFormSignal.calories(),t=i?Number(i):null;if(!t)return null;let _=this.foodFormSignal.protein(),C=_?Number(_):null;if(!C)return null;let w=this.foodFormSignal.unit();if(!w)return null;let P=this.foodFormSignal.amount(),T=P?Number(P):null;return T?{name:o,calories:t,protein:C,fat:e,unit:w,amount:T}:null}),this.foodFormEnabled=s(!0),this.foodFormValid=S(()=>{let o=this.foodFormValue();if(!o)return!1;let{name:n,calories:e,protein:i,unit:t,fat:_,amount:C}=o;return!0}),j(()=>{let o=this.food.value();o&&(this.foodFormSignal.name.set(o.name),this.foodFormSignal.calories.set(o.calories.toString()),this.foodFormSignal.protein.set(o.protein.toString()),this.foodFormSignal.fat.set(o.fat?.toString()??""),this.foodFormSignal.unit.set(o.unit),this.foodFormSignal.amount.set(o.amount.toString()))})}openDeleteModal(){let o=this.modalService.open(ee,{centered:!0});o.componentInstance.configurate({title:"Delete Record",subtitle:"<strong>Are you sure you want to delete this record?</strong>",body:'This record will be permanently deleted. <span class="text-danger">This operation can not be undone.</span>',okType:"danger"}),o.closed.pipe(V(1)).subscribe(async()=>{let e=this.food.value();if(e?.foodId)try{await h(this.foodsApiService.deleteFood(e.foodId)),this.router.navigate([y.FOODS])}catch(i){let t=i;this.toastService.error(`${t.message}`)}})}async save(){let o=this.foodFormValue();if(!o||!this.foodFormValid())return;this.isSaveLoading.set(!0),this.foodFormEnabled.set(!1);let n={foodId:this.food.value()?.foodId??null,name:o.name,calories:o.calories,protein:o.protein,fat:o.fat,unit:o.unit.toLowerCase(),amount:o.amount};try{this.mode()==="create"?await h(this.foodsApiService.createFood(n)):await h(this.foodsApiService.updateFood(n))}catch{this.toastService.error("An error occurred while saving this food.")}finally{this.isSaveLoading.set(!1),this.foodFormEnabled.set(!0),this.router.navigate([y.FOODS])}}cancel(){this.location.back()}static{this.\u0275fac=function(n){return new(n||l)}}static{this.\u0275cmp=I({type:l,selectors:[["edit-food-page"]],inputs:{foodIdFromRoute:[1,"id","foodIdFromRoute"]},decls:28,vars:22,consts:[[1,"header-footer-padding"],[1,"container"],[1,"pb-3"],[1,"title"],[1,"mb-3"],["type","text","placeholder","Name",1,"form-control",3,"ngModelChange","ngModel","disabled"],["type","text","placeholder","Calories",1,"form-control",3,"ngModelChange","ngModel","disabled"],["type","text","placeholder","Protein",1,"form-control",3,"ngModelChange","ngModel","disabled"],["type","text","placeholder","Fat",1,"form-control",3,"ngModelChange","ngModel","disabled"],["placeholder","Unit",3,"valueChange","value","items","disabled"],["type","text","placeholder","Amount Per Unit",1,"form-control",3,"ngModelChange","ngModel","disabled"],[1,"row","g-2","mb-3"],[1,"col"],["type","button",1,"btn","btn-secondary","w-100",3,"click"],["type","button",1,"btn","w-100","d-flex","justify-content-center","align-items-center",3,"click","disabled"],["aria-hidden","true",1,"fa","fa-save","px-2"],["type","button",1,"btn","btn-danger","w-100","delete-button"],["aria-hidden","true",1,"spinner-border","spinner-border-sm","mx-2"],["role","status",1,"visually-hidden"],["type","button",1,"btn","btn-danger","w-100","delete-button",3,"click"],["aria-hidden","true",1,"fa","fa-trash","px-2"]],template:function(n,e){n&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4",3),g(4),a()(),r(5,"div")(6,"div",4)(7,"input",5),c("ngModelChange",function(t){return p(e.foodFormSignal.name,t)||(e.foodFormSignal.name=t),t}),a()(),r(8,"div",4)(9,"input",6),c("ngModelChange",function(t){return p(e.foodFormSignal.calories,t)||(e.foodFormSignal.calories=t),t}),a()(),r(10,"div",4)(11,"input",7),c("ngModelChange",function(t){return p(e.foodFormSignal.protein,t)||(e.foodFormSignal.protein=t),t}),a()(),r(12,"div",4)(13,"input",8),c("ngModelChange",function(t){return p(e.foodFormSignal.fat,t)||(e.foodFormSignal.fat=t),t}),a()(),r(14,"div",4)(15,"app-typeahead",9),c("valueChange",function(t){return p(e.foodFormSignal.unit,t)||(e.foodFormSignal.unit=t),t}),a()(),r(16,"div",4)(17,"input",10),c("ngModelChange",function(t){return p(e.foodFormSignal.amount,t)||(e.foodFormSignal.amount=t),t}),a()()(),r(18,"div",11)(19,"div",12)(20,"button",13),F("click",function(){return e.cancel()}),g(21," Cancel "),a()(),r(22,"div",12)(23,"button",14),F("click",function(){return e.save()}),v(24,ie,1,0,"i",15)(25,re,3,0),g(26," Save "),a()()(),v(27,ae,4,0,"button",16),a()()),n&2&&(d(4),N("",e.mode()==="edit"?"Edit":"Create"," Food"),d(3),f("ngModel",e.foodFormSignal.name),u("disabled",!e.foodFormEnabled()),d(2),f("ngModel",e.foodFormSignal.calories),u("disabled",!e.foodFormEnabled()),d(2),f("ngModel",e.foodFormSignal.protein),u("disabled",!e.foodFormEnabled()),d(2),f("ngModel",e.foodFormSignal.fat),u("disabled",!e.foodFormEnabled()),d(2),f("value",e.foodFormSignal.unit),u("items",B(21,ne))("disabled",!e.foodFormEnabled()),d(2),f("ngModel",e.foodFormSignal.amount),u("disabled",!e.foodFormEnabled()),d(6),D("btn-primary",e.foodFormValid())("btn-secondary",!e.foodFormValid()),u("disabled",!e.foodFormValid()||e.isSaveLoading()),d(),M(e.isSaveLoading()?25:24),d(3),M(e.mode()==="edit"?27:-1))},dependencies:[Y,K,Q,X,x,oe],styles:["[_nghost-%COMP%]{--bs-body-bg: var(--light-bg);--bs-body-color: var(--font-color);--bs-tertiary-bg: var(--primary);--bs-border-width: 1px;--bs-border-color: rgba(255, 255, 255, .15)}.card[_ngcontent-%COMP%]{--bs-card-spacer-y: .5rem;--bs-card-spacer-x: .5rem}.title[_ngcontent-%COMP%]{margin:0}.subtitle[_ngcontent-%COMP%]{font-size:14px;opacity:.7}.card[_ngcontent-%COMP%]{background-color:var(--bg);border:1px solid rgba(255,255,255,.1)}.serie-label[_ngcontent-%COMP%]{font-size:12px;color:#ffffffbf;padding:0 .5rem}.delete-button[_ngcontent-%COMP%]{background-color:#301b23;--bs-btn-border-color: #6e363b;color:#fa8989}"],changeDetection:0})}}return l})();export{ve as EditFoodPageComponent};
