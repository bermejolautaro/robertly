import{a as q}from"./chunk-KMRCF7MH.js";import{a as Ee}from"./chunk-LOFE7OAR.js";import{a as Le}from"./chunk-BJTZI6DR.js";import{a as Ce}from"./chunk-SDZBR5WF.js";import{a as Se}from"./chunk-OAODVB4G.js";import"./chunk-QBBUNREG.js";import{a as be,b as ye}from"./chunk-NM7XLQOB.js";import{B as w,c as oe,e as se,m as ue,q as fe,r as he,t as _e,u as xe,v as ve}from"./chunk-DQGT253Z.js";import{A as me,I as ge,b as j,d as N,f as ae,h as le,m as de,p as ce,q as pe}from"./chunk-6EYGD3XX.js";import{Ac as F,Bb as v,Bc as ee,Cb as T,Db as M,Eb as P,Fb as l,Gb as s,Hb as S,Ia as G,Ka as a,Kb as K,Mb as U,Nb as g,Nc as ie,R as Q,Rc as te,Tc as ne,Uc as re,Ya as d,Yb as m,_b as V,ac as y,bc as E,cc as L,dc as R,ec as J,fc as Y,ib as X,kc as D,ma as u,mc as O,nb as b,nc as W,t as z,ua as h,va as _,wb as x,x as H,xc as Z,yb as $,yc as B,zc as I}from"./chunk-ARLDQED4.js";function Ie(n,c){n&1&&(l(0,"div",14),S(1,"i",22),m(2," You have unsaved changes "),s())}function we(n,c){if(n&1){let e=K();l(0,"div",15)(1,"div",23)(2,"div",24)(3,"input",25),L("ngModelChange",function(i){let r=h(e).$implicit;return E(r().reps,i)||(r().reps=i),_(i)}),s()(),l(4,"div",24)(5,"input",26),L("ngModelChange",function(i){let r=h(e).$implicit;return E(r().weightInKg,i)||(r().weightInKg=i),_(i)}),s()()()()}if(n&2){let e=c.$implicit,t=g(2);d(3),y("ngModel",e().reps),x("disabled",!t.formEnabled())("allowDecimals",!1),d(2),y("ngModel",e().weightInKg),x("disabled",!t.formEnabled())}}function Te(n,c){n&1&&S(0,"i",20)}function Me(n,c){n&1&&(S(0,"span",27),l(1,"span",28),m(2,"Loading..."),s())}function Pe(n,c){if(n&1&&S(0,"app-exercise-log",32),n&2){let e=c.$implicit;x("exerciseLog",e)}}function Ve(n,c){if(n&1&&(l(0,"div",29)(1,"div",30)(2,"div",31),m(3,"Previous entries"),s(),M(4,Pe,1,1,"app-exercise-log",32,T),D(6,"slice"),s()()),n&2){g(2);let e=Y(30);d(4),P(W(6,0,e.recentLogs,0,3))}}function De(n,c){if(n&1&&S(0,"app-exercise-log",32),n&2){let e=c.$implicit;x("exerciseLog",e)}}function ke(n,c){if(n&1&&(l(0,"div",29)(1,"div",30)(2,"div",31),m(3,"Recently Updated"),s(),M(4,De,1,1,"app-exercise-log",32,T),D(6,"slice"),s()()),n&2){let e=g(3);d(4),P(W(6,0,e.recentlyUpdated.value(),0,3))}}function Ke(n,c){if(n&1&&(l(0,"span",33),m(1),s(),l(2,"ul",34)(3,"li",35),m(4),D(5,"number"),s()()),n&2){let e=c.$implicit,t=c.$index;d(),V("Serie ",t+1,""),d(3),V("",O(5,2,e.brzycki,"1.2-2"),"kg")}}function Ue(n,c){if(n&1&&(l(0,"div",29)(1,"div",30)(2,"div",31),m(3,"Possible 1RM (Brzycky Formula)"),s(),M(4,Ke,6,5,null,null,T),l(6,"span",33),m(7,"Average"),s(),l(8,"ul",34)(9,"li",35),m(10),D(11,"number"),s()()()()),n&2){g(2);let e=Y(30);d(4),P(e.series),d(6),V("",O(11,1,e.brzyckiAverage,"1.2-2"),"kg")}}function Ye(n,c){if(n&1&&b(0,Ve,7,4,"div",29)(1,ke,7,4,"div",29)(2,Ue,12,4,"div",29),n&2){let e;g();let t=Y(30),i=g();v(t?0:-1),d(),v((e=i.recentlyUpdated.value())!=null&&e.length?1:-1),d(),v(t?2:-1)}}function Ae(n,c){if(n&1){let e=K();l(0,"button",36),U("click",function(){h(e);let i=g(2);return _(i.openDeleteModal())}),S(1,"i",37),l(2,"span"),m(3,"Delete"),s()()}}function Re(n,c){if(n&1){let e=K();l(0,"div",0)(1,"div",2)(2,"div",3)(3,"h4",4),m(4),s(),l(5,"span",5),m(6,"Record your workout details and progress"),s()(),l(7,"div"),S(8,"input",6),l(9,"div",7)(10,"input",8),L("ngModelChange",function(i){h(e);let r=g();return E(r.formSignal.date,i)||(r.formSignal.date=i),_(i)}),s()(),l(11,"div",9)(12,"app-typeahead",10),L("valueChange",function(i){h(e);let r=g();return E(r.formSignal.user,i)||(r.formSignal.user=i),_(i)}),s()(),l(13,"div",11)(14,"div",12)(15,"app-typeahead",13),L("valueChange",function(i){h(e);let r=g();return E(r.formSignal.exercise,i)||(r.formSignal.exercise=i),_(i)}),s()()(),b(16,Ie,3,0,"div",14),R(17),l(18,"div",11),M(19,we,6,5,"div",15,T),s()(),l(21,"div",16)(22,"div",17)(23,"button",18),U("click",function(){h(e);let i=g();return _(i.cancel())}),m(24," Cancel "),s()(),l(25,"div",17)(26,"button",19),U("click",function(){h(e);let i=g();return _(i.save())}),b(27,Te,1,0,"i",20)(28,Me,3,0),m(29," Save "),s()()(),R(30),b(31,Ye,3,3)(32,Ae,4,0,"button",21),s()()}if(n&2){let e=g();d(4),V("",e.mode()==="edit"?"Edit":"Create"," Exercise Log"),d(6),y("ngModel",e.formSignal.date),x("disabled",!e.formEnabled()),d(2),y("value",e.formSignal.user),x("items",e.users())("itemSelector",e.userSelector)("disabled",!e.formEnabled()),d(3),y("value",e.formSignal.exercise),x("items",e.exerciseApiService.exercises())("itemSelector",e.exerciseSelector)("disabled",!e.formEnabled()),d(),v(e.hasUnsavedChanges()?16:-1);let t=e.formSignal.series();d(3),P(t),d(7),$("btn-primary",e.formValid())("btn-secondary",!e.formValid()||!e.hasUnsavedChanges()||e.isSaveLoading()),x("disabled",!e.formValid()||e.isSaveLoading()||e.mode()==="edit"&&!e.hasUnsavedChanges()),d(),v(e.isSaveLoading()?28:27),d(3),J(e.originalValue.value()),d(),v(e.mode()==="edit"?31:-1),d(),v(e.mode()==="edit"?32:-1)}}function Oe(n,c){n&1&&(l(0,"div",1)(1,"div",38)(2,"span",39),m(3,"Loading..."),s()()())}var pi=(()=>{class n{constructor(){this.exerciseLogId=G(null,{alias:"id",transform:Z}),this.authService=u(_e),this.exerciseLogApiService=u(Se),this.exerciseApiService=u(fe),this.offlineQueueService=u(ve),this.location=u(ie),this.router=u(se),this.toastService=u(he),this.titleCasePipe=u(te),this.dayjsService=u(ye),this.dayjs=this.dayjsService.instance,this.route=u(oe),this.modalService=u(me),this.isSaveLoading=a(!1),this.isLoading=ee(()=>this.originalValue.isLoading()),this.paramMap=j(this.route.paramMap),this.url=j(this.route.url,{initialValue:[]}),this.mode=I(()=>this.url().some(e=>e.path===w.CREATE)?"create":"edit"),this.formSignal={user:a(null),exercise:a(null),date:a(""),series:a([a({serieId:null,reps:a(null),weightInKg:a(null)}),a({serieId:null,reps:a(null),weightInKg:a(null)}),a({serieId:null,reps:a(null),weightInKg:a(null)}),a({serieId:null,reps:a(null),weightInKg:a(null)}),a({serieId:null,reps:a(null),weightInKg:a(null)})])},this.formValid=I(()=>!!this.formValue()),this.formValue=I(()=>{let e=this.formSignal.exercise();if(!e)return null;let t=this.formSignal.user();if(!t)return null;let i=this.formSignal.series().map(r=>r()).map(r=>({serieId:r.serieId,reps:r.reps(),weightInKg:r.weightInKg()}));return i.some(r=>!r.reps&&r.weightInKg||r.reps&&!r.weightInKg)?null:{user:t,exercise:e,date:this.formSignal.date(),series:i}}),this.formEnabled=a(!0),this.userSelector=e=>e?.name??"",this.exerciseSelector=e=>this.titleCasePipe.transform(e?.name)??"",this.users=I(()=>{let e=this.authService.user.value();return[e,...e?.assignedUsers??[]]}),this.originalValue=N({request:this.exerciseLogId,loader:({request:e})=>e?this.exerciseLogApiService.getExerciseLogById(e):z(null)}),this.recentlyUpdated=N({loader:()=>this.exerciseLogApiService.getRecentlyUpdated()}),this.#e=F(()=>{this.originalValue.error()&&this.router.navigate([w.HOME])}),this.#i=F(()=>{let e=this.mode(),t=this.originalValue.value(),{user:i}=B(()=>({user:this.authService.user.value()}));e==="create"&&B(()=>{let r=this.dayjs().format("YYYY-MM-DD");this.formSignal.date.set(r),this.formSignal.user.set(i)}),e==="edit"&&t&&(this.formSignal.exercise.set(t.exercise),this.formSignal.date.set(this.dayjsService.parseDate(t.date).format("YYYY-MM-DD")),this.formSignal.user.set(t.user),this.formSignal.series.update(r=>{for(let p=0;p<r.length;p++)r[p]?.set({serieId:t.series[p]?.serieId??null,reps:a(t.series[p]?.reps?.toString()??null),weightInKg:a(t.series[p]?.weightInKg?.toString()??null)});return r}))}),this.hasUnsavedChanges=I(()=>{let e=this.formValue(),t=this.mode();if(t==="create"||!e)return!1;let i=this.originalValue.value(),r=i?.series.map(C=>({serieId:C.serieId,weightInKg:C.weightInKg?.toString()??null,reps:C.reps?.toString()??null}))??[],p=e.series.filter(C=>!!C.reps||!!C.weightInKg);return t==="edit"&&!ue(r,p)||i?.exercise.exerciseId!==e.exercise?.exerciseId||i?.user.userId!==e.user.userId||this.dayjs(i?.date).unix()!==this.dayjs(e.date).unix()})}#e;#i;openDeleteModal(){let e=this.modalService.open(xe,{centered:!0});e.componentInstance.configurate({title:"Delete Record",subtitle:"<strong>Are you sure you want to delete this record?</strong>",body:'This record will be permanently deleted. <span class="text-danger">This operation can not be undone.</span>',okType:"danger"}),e.closed.pipe(Q(1)).subscribe(async()=>{let i=this.originalValue.value();if(i)try{await H(this.exerciseLogApiService.deleteExerciseLog(i.id)),this.toastService.ok("Log deleted successfully!"),this.router.navigate([w.HOME])}catch(r){let p=r;this.toastService.error(`${p.message}`)}})}async save(){let e=this.mode();this.isSaveLoading.set(!0);let t=this.formSignal.user(),i=this.formSignal.exercise(),r=this.dayjsService.parseDate(this.formSignal.date());if(!t)throw new Error("User cannot be null");if(this.formValid()){if(this.formEnabled.set(!1),e==="create"){let p=this.formSignal.series().map(o=>{let f=o();return{exerciseLogId:this.exerciseLogId(),serieId:f.serieId,reps:q(f.reps()),weightInKg:q(f.weightInKg()),brzycki:0}}),k=p.filter(o=>!!o.reps&&!!o.weightInKg),A={seriesIdsToDelete:p.filter(o=>!o.reps||!o.weightInKg).filter(o=>!!o.serieId).map(o=>o.serieId),exerciseLog:{exerciseLogUsername:t?.name,exerciseLogUserId:t.userId,exerciseLogExerciseId:i?.exerciseId??void 0,exerciseLogDate:r.format("YYYY-MM-DD"),series:k}};this.offlineQueueService.enqueue({id:crypto.randomUUID(),method:"POST",endpoint:"exercise-logs",payload:A,retries:0,maxRetries:3,optimisticType:"exercise-log",userUuid:this.authService.userUuid(),onActionDone:o=>{let f=o;this.router.navigate([w.EXERCISE_LOGS,w.EDIT,f])}}),this.toastService.ok("Log enqueued for creation successfully!");try{localStorage.removeItem(be)}catch(o){this.toastService.error(`${o}`)}}if(e==="edit"){let p=this.formSignal.series().map(o=>{let f=o();return{exerciseLogId:this.exerciseLogId(),serieId:f.serieId,reps:Number(f.reps()),weightInKg:Number(f.weightInKg()),brzycki:0}}),k=p.filter(o=>!!o.reps&&!!o.weightInKg),A={seriesIdsToDelete:p.filter(o=>!o.reps||!o.weightInKg).filter(o=>!!o.serieId).map(o=>o.serieId),id:this.exerciseLogId(),exerciseLog:{exerciseLogUsername:t?.name,exerciseLogUserId:t.userId,exerciseLogExerciseId:i?.exerciseId??void 0,exerciseLogDate:r.format("YYYY-MM-DD"),series:k}};this.offlineQueueService.enqueue({id:crypto.randomUUID(),method:"PUT",endpoint:`exercise-logs/${this.exerciseLogId()}`,payload:A,retries:0,maxRetries:3,optimisticType:"exercise-log",userUuid:this.authService.userUuid(),onActionDone:()=>{this.originalValue.reload()}}),this.toastService.ok("Log enqueued for update successfully!")}}this.isSaveLoading.set(!1),this.formEnabled.set(!0)}cancel(){this.location.back()}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=X({type:n,selectors:[["edit-exercise-log-page"]],inputs:{exerciseLogId:[1,"id","exerciseLogId"]},decls:2,vars:1,consts:[[1,"header-footer-padding"],[1,"position-absolute","top-50","start-50","translate-middle"],[1,"container"],[1,"pb-3"],[1,"title"],[1,"subtitle"],["type","text","autofocus","autofocus",2,"display","none"],[1,"mb-2"],["type","date","placeholder","DD-MM-YYYY",1,"form-control",3,"ngModelChange","ngModel","disabled"],[1,"col-12","mb-2"],["placeholder","User",3,"valueChange","value","items","itemSelector","disabled"],[1,"mb-3"],[1,"input-group"],["placeholder","Exercise",3,"valueChange","value","items","itemSelector","disabled"],[1,"mb-2","px-2"],[1,"pb-1"],[1,"row","g-2","mb-5"],[1,"col"],["type","button",1,"btn","btn-secondary","w-100",3,"click"],["type","button",1,"btn","w-100","d-flex","justify-content-center","align-items-center",3,"click","disabled"],["aria-hidden","true",1,"fa","fa-save","px-2"],["type","button",1,"btn","btn-danger","w-100","delete-button"],["aria-hidden","true",1,"fa","fa-exclamation-circle"],[1,"row","g-2"],[1,"col-6"],["type","text","inputmode","decimal","placeholder","Reps","onlyNumbers","",1,"form-control",3,"ngModelChange","ngModel","disabled","allowDecimals"],["type","text","inputmode","decimal","placeholder","Weight (Kg)","onlyNumbers","",1,"form-control",3,"ngModelChange","ngModel","disabled"],["aria-hidden","true",1,"spinner-border","spinner-border-sm","mx-2"],["role","status",1,"visually-hidden"],[1,"card","mb-3"],[1,"card-body"],[1,"card-title"],[1,"w-100",3,"exerciseLog"],[1,"serie-label"],[1,"list-group","list-group-horizontal","pb-1"],[1,"list-group-item","w-100"],["type","button",1,"btn","btn-danger","w-100","delete-button",3,"click"],["aria-hidden","true",1,"fa","fa-trash","px-2"],["role","status",1,"robertly-spinner","spinner-border","text-primary"],[1,"visually-hidden"]],template:function(t,i){t&1&&b(0,Re,33,21,"div",0)(1,Oe,4,0,"div",1),t&2&&v(i.isLoading()?1:0)},dependencies:[pe,ae,le,ce,de,ge,Ce,Ee,ne,re,Le],styles:["[_nghost-%COMP%]{--bs-body-bg: var(--light-bg);--bs-body-color: var(--font-color);--bs-tertiary-bg: var(--primary);--bs-border-width: 1px;--bs-border-color: rgba(255, 255, 255, .15)}.card[_ngcontent-%COMP%]{--bs-card-spacer-y: .5rem;--bs-card-spacer-x: .5rem}.title[_ngcontent-%COMP%]{margin:0}.subtitle[_ngcontent-%COMP%]{font-size:14px;opacity:.7}.card[_ngcontent-%COMP%]{background-color:var(--bg);border:1px solid rgba(255,255,255,.1)}.serie-label[_ngcontent-%COMP%]{font-size:12px;color:#ffffffbf;padding:0 .5rem}.delete-button[_ngcontent-%COMP%]{background-color:#301b23;--bs-btn-border-color: #6e363b;color:#fa8989}"],changeDetection:0})}}return n})();export{pi as EditExerciseLogPageComponent};
