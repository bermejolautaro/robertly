import{a as v}from"./chunk-KMRCF7MH.js";import{a as io}from"./chunk-57WNUYAP.js";import{a as no}from"./chunk-NUDFPEP6.js";import{a as oo}from"./chunk-ZUBOAKQJ.js";import{a as eo}from"./chunk-XVKG7MT5.js";import{a as to}from"./chunk-JWGIT43Z.js";import{d as B,f as j,r as X,t as Z,u as $,w as E,y as ro}from"./chunk-XETK3SMN.js";import{$c as J,Bb as M,Db as d,Gc as q,Ka as l,Kc as I,Lb as T,N as D,Nb as g,Pb as W,Rb as p,Sb as h,Tb as _,Ua as A,Uc as z,Wc as V,Yc as G,Zc as U,ea as f,ed as Q,hd as H,ja as m,jc as N,ka as c,kc as C,lc as O,mb as F,mc as R,nb as y,pc as Y,rb as b,sb as r,sd as K,ta as u,tb as n,u as k,ub as w,y as S,zb as x}from"./chunk-NQKVPPC6.js";function ao(a,s){if(a&1){let e=x();r(0,"div",6)(1,"label",18),g(2,"Description"),n(),r(3,"textarea",19),_("ngModelChange",function(o){m(e);let i=d(2);return h(i.foodLogForm.description,o)||(i.foodLogForm.description=o),c(o)}),n()(),r(4,"div",6)(5,"label",18),g(6,"Calories"),n(),r(7,"input",20),_("ngModelChange",function(o){m(e);let i=d(2);return h(i.foodLogForm.calories,o)||(i.foodLogForm.calories=o),c(o)}),n()(),r(8,"div",6)(9,"label",18),g(10,"Protein"),n(),r(11,"input",21),_("ngModelChange",function(o){m(e);let i=d(2);return h(i.foodLogForm.protein,o)||(i.foodLogForm.protein=o),c(o)}),n()(),r(12,"div",6)(13,"label",18),g(14,"Fat"),n(),r(15,"input",22),_("ngModelChange",function(o){m(e);let i=d(2);return h(i.foodLogForm.fat,o)||(i.foodLogForm.fat=o),c(o)}),n()()}if(a&2){let e=d(2);l(3),p("ngModel",e.foodLogForm.description),l(4),p("ngModel",e.foodLogForm.calories),l(4),p("ngModel",e.foodLogForm.protein),l(4),p("ngModel",e.foodLogForm.fat)}}function lo(a,s){if(a&1){let e=x();r(0,"div",6)(1,"app-typeahead",23),_("valueChange",function(o){m(e);let i=d(2);return h(i.foodLogForm.food,o)||(i.foodLogForm.food=o),c(o)}),n()(),r(2,"div",6)(3,"input",24),_("ngModelChange",function(o){m(e);let i=d(2);return h(i.foodLogForm.amount,o)||(i.foodLogForm.amount=o),c(o)}),n()()}if(a&2){let e=d(2);l(),p("value",e.foodLogForm.food),b("items",e.foods.value())("itemSelector",e.foodSelector),l(2),b("placeholder",e.amountPlaceholder()),p("ngModel",e.foodLogForm.amount)}}function so(a,s){a&1&&w(0,"i",16)}function mo(a,s){a&1&&(w(0,"span",25),r(1,"span",26),g(2,"Loading..."),n())}function co(a,s){if(a&1){let e=x();r(0,"button",27),M("click",function(){m(e);let o=d(2);return c(o.openDeleteModal())}),w(1,"i",28),r(2,"span"),g(3,"Delete"),n()()}}function go(a,s){if(a&1){let e=x();r(0,"div",0)(1,"div",2)(2,"div",3)(3,"h4",4),g(4),n(),r(5,"span",5),g(6,"Track your daily meals and your calorie intake"),n()(),r(7,"div")(8,"div",6)(9,"input",7),_("ngModelChange",function(o){m(e);let i=d();return h(i.foodLogForm.date,o)||(i.foodLogForm.date=o),c(o)}),n()(),r(10,"div",6)(11,"app-typeahead",8),_("valueChange",function(o){m(e);let i=d();return h(i.foodLogForm.user,o)||(i.foodLogForm.user=o),c(o)}),n()(),r(12,"div",9)(13,"input",10),_("ngModelChange",function(o){m(e);let i=d();return h(i.foodLogForm.quickAdd,o)||(i.foodLogForm.quickAdd=o),c(o)}),n(),r(14,"label",11),g(15,"Quick Add"),n()(),F(16,ao,16,4)(17,lo,4,5),n(),r(18,"div",12)(19,"div",13)(20,"button",14),M("click",function(){m(e);let o=d();return c(o.cancel())}),g(21," Cancel "),n()(),r(22,"div",13)(23,"button",15),M("click",function(){m(e);let o=d();return c(o.save())}),F(24,so,1,0,"i",16)(25,mo,3,0),g(26," Save "),n()()(),F(27,co,4,0,"button",17),n()()}if(a&2){let e=d();l(4),W("",e.mode()==="edit"?"Edit":"Create"," Food Log"),l(5),p("ngModel",e.foodLogForm.date),l(2),p("value",e.foodLogForm.user),b("items",e.users())("itemSelector",e.userSelector),l(2),p("ngModel",e.foodLogForm.quickAdd),l(3),y(e.foodLogForm.quickAdd()?16:17),l(7),T("btn-primary",e.foodLogFormValid())("btn-secondary",!e.foodLogFormValid()||e.isSaveLoading()),b("disabled",!e.foodLogFormValid()||e.isSaveLoading()),l(),y(e.isSaveLoading()?25:24),l(3),y(e.mode()==="edit"?27:-1)}}function uo(a,s){a&1&&(r(0,"div",1)(1,"div",29)(2,"span",30),g(3,"Loading..."),n()()())}var Wo=(()=>{let s=class s{constructor(){this.location=f(q),this.router=f(j),this.toastService=f(X),this.titleCasePipe=f(I),this.route=f(B),this.modalService=f(K),this.authService=f(Z),this.dayjs=f(ro),this.foodLogsApiService=f(eo),this.foodsApiService=f(no),this.foodLogIdFromRoute=Y(void 0,{alias:"id"}),this.isLoading=R(()=>this.originalValue.isLoading()||this.foods.isLoading()),this.url=z(this.route.url,{initialValue:[]}),this.mode=C(()=>this.url().some(t=>t.path===E.CREATE)?"create":"edit"),this.foods=V({stream:()=>this.foodsApiService.getFoods(),defaultValue:[]}),this.userSelector=t=>typeof t=="string"?"":t?.name??"",this.foodSelector=t=>typeof t=="string"?"":this.titleCasePipe.transform(t?.name)??"",this.users=C(()=>{let t=this.authService.user.value();return[t,...t?.assignedUsers??[]]}),this.isSaveLoading=u(!1),this.originalValue=V({params:this.foodLogIdFromRoute,stream:({params:t})=>t?this.foodLogsApiService.getFoodLogById(t):k(null)}),this.foodLogForm={user:u(null),date:u(null),food:u(null),amount:u(null),quickAdd:u(!1),description:u(null),calories:u(null),protein:u(null),fat:u(null)},this.foodLogFormValue=C(()=>!this.foodLogForm.user()||!this.foodLogForm.date()?null:this.foodLogForm.quickAdd()?this.foodLogForm.description()?this.foodLogForm:null:!this.foodLogForm.food()||!this.foodLogForm.amount()?null:this.foodLogForm),this.foodLogFormValid=C(()=>!!this.foodLogFormValue()),this.foodLogFormEnabled=u(!0),this.amountPlaceholder=C(()=>{let t=this.foodLogForm.food();return t?`Amount (${t.unit})`:"Amount"}),O(()=>{let t=this.mode(),o=this.originalValue.value(),i=N(()=>this.authService.user.value());if(t==="create"){let L=this.dayjs().format("YYYY-MM-DD");this.foodLogForm.date.set(L),this.foodLogForm.user.set(i)}t==="edit"&&o&&(this.foodLogForm.date.set(this.dayjs(o.date,[...to]).format("YYYY-MM-DD")),this.foodLogForm.food.set(o.food),this.foodLogForm.user.set(o.user),this.foodLogForm.amount.set(o.amount?.toString()??null),this.foodLogForm.quickAdd.set(o.quickAdd??!1),this.foodLogForm.description.set(o.description),this.foodLogForm.calories.set(o.calories?.toString()??null),this.foodLogForm.protein.set(o.protein?.toString()??null),this.foodLogForm.fat.set(o.fat?.toString()??null))})}openDeleteModal(){let t=this.modalService.open($,{centered:!0});t.componentInstance.configurate({title:"Delete Record",subtitle:"<strong>Are you sure you want to delete this record?</strong>",body:'This record will be permanently deleted. <span class="text-danger">This operation can not be undone.</span>',okType:"danger"}),t.closed.pipe(D(1)).subscribe(async()=>{let i=this.originalValue.value();if(i?.foodLogId)try{await S(this.foodLogsApiService.deleteFoodLog(i.foodLogId)),this.router.navigate([E.FOOD_LOGS])}catch(L){let P=L;this.toastService.error(`${P.message}`)}})}async save(){if(!this.foodLogFormValid())return;let t=this.originalValue.value(),o=this.foodLogForm.user(),i=this.foodLogForm.food();if(!this.foodLogFormValid())return;this.isSaveLoading.set(!0),this.foodLogFormEnabled.set(!1);let L={foodLogId:t?.foodLogId??null,date:this.foodLogForm.date(),user:o,food:i,amount:v(this.foodLogForm.amount()),quickAdd:this.foodLogForm.quickAdd(),description:this.foodLogForm.description(),calories:v(this.foodLogForm.calories()),protein:v(this.foodLogForm.protein()),fat:v(this.foodLogForm.fat())};try{this.mode()==="create"?await S(this.foodLogsApiService.createFoodLog(L)):await S(this.foodLogsApiService.updateFoodLog(L))}catch{this.toastService.error("An error ocurred while saving the log.")}finally{this.isSaveLoading.set(!1),this.foodLogFormEnabled.set(!0),this.router.navigate([E.FOOD_LOGS])}}cancel(){this.location.back()}};s.\u0275fac=function(o){return new(o||s)},s.\u0275cmp=A({type:s,selectors:[["edit-food-log-page"]],inputs:{foodLogIdFromRoute:[1,"id","foodLogIdFromRoute"]},decls:2,vars:1,consts:[[1,"header-footer-padding"],[1,"position-absolute","top-50","start-50","translate-middle"],[1,"container"],[1,"pb-3"],[1,"title"],[1,"subtitle"],[1,"mb-2"],["type","date","placeholder","DD-MM-YYYY",1,"form-control",3,"ngModelChange","ngModel"],["placeholder","User",3,"valueChange","value","items","itemSelector"],[1,"d-flex","align-items-center","justify-content-end","py-2","gap-2","form-check","form-switch"],["type","checkbox","role","switch","id","switchCheckDefault","switch","",1,"form-check-input",3,"ngModelChange","ngModel"],["for","switchCheckDefault",1,"form-check-label"],[1,"row","g-2","mb-3"],[1,"col"],["type","button",1,"btn","btn-secondary","w-100",3,"click"],["type","button",1,"btn","w-100","d-flex","justify-content-center","align-items-center",3,"click","disabled"],["aria-hidden","true",1,"fa","fa-save","px-2"],["type","button",1,"btn","btn-danger","w-100","delete-button"],[1,"form-label"],["type","text","placeholder","Description",1,"form-control",3,"ngModelChange","ngModel"],["type","text","inputmode","decimal","placeholder","Calories","onlyNumbers","",1,"form-control",3,"ngModelChange","ngModel"],["type","text","inputmode","decimal","placeholder","Protein","onlyNumbers","",1,"form-control",3,"ngModelChange","ngModel"],["type","text","inputmode","decimal","placeholder","Fat","onlyNumbers","",1,"form-control",3,"ngModelChange","ngModel"],["placeholder","Food",3,"valueChange","value","items","itemSelector"],["type","text","inputmode","decimal","onlyNumbers","",1,"form-control",3,"ngModelChange","placeholder","ngModel"],["aria-hidden","true",1,"spinner-border","spinner-border-sm","mx-2"],["role","status",1,"visually-hidden"],["type","button",1,"btn","btn-danger","w-100","delete-button",3,"click"],["aria-hidden","true",1,"fa","fa-trash","px-2"],["role","status",1,"app-spinner","spinner-border","text-primary"],[1,"visually-hidden"]],template:function(o,i){o&1&&F(0,go,28,14,"div",0)(1,uo,4,0,"div",1),o&2&&y(i.isLoading()?1:0)},dependencies:[H,U,G,J,Q,oo,io],styles:["[_nghost-%COMP%]{--bs-body-bg: var(--light-bg);--bs-body-color: var(--font-color);--bs-tertiary-bg: var(--primary);--bs-border-width: 1px;--bs-border-color: rgba(255, 255, 255, .15)}.card[_ngcontent-%COMP%]{--bs-card-spacer-y: .5rem;--bs-card-spacer-x: .5rem}.title[_ngcontent-%COMP%]{margin:0}.subtitle[_ngcontent-%COMP%]{font-size:14px;opacity:.7}.card[_ngcontent-%COMP%]{background-color:var(--bg);border:1px solid rgba(255,255,255,.1)}.serie-label[_ngcontent-%COMP%]{font-size:12px;color:#ffffffbf;padding:0 .5rem}.delete-button[_ngcontent-%COMP%]{background-color:#301b23;--bs-btn-border-color: #6e363b;color:#fa8989}textarea.form-control[_ngcontent-%COMP%]{min-height:8rem}.form-label[_ngcontent-%COMP%]{font-size:12px;padding-left:.5rem;margin-bottom:0}"],changeDetection:0});let a=s;return a})();export{Wo as EditFoodLogPageComponent};
