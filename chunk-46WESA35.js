import{a as pe}from"./chunk-OYK6J67D.js";import{K as ne,M as ae,O as se,Q as ce,R as le,S as de,T as b,a as B,b as R,c as j,d as N,e as z,f as q,g as H,h as J,j as Q,k as W,m as X,p as Z,q as ee,r as te,s as ie,t as re,y as oe}from"./chunk-G5X3D3MJ.js";import{f as V,h as Y,j as A,l as K,m as $}from"./chunk-OFWY3YEL.js";import{$b as T,Ab as c,Bb as a,Ca as E,Cb as L,Da as y,Fb as O,Jb as S,Kb as m,S as F,Sb as l,Tb as G,Ub as f,Za as s,_b as D,ac as M,bc as P,dc as C,ec as U,fc as k,gb as I,lb as g,pa as d,qb as p,sa as w,vb as x,wb as h,yb as _,zb as v}from"./chunk-24QZLUFP.js";var me=t=>({"justify-content-between":t}),ue=(t,r)=>({"btn-primary":t,"btn-secondary":r}),ge=()=>[];function xe(t,r){if(t&1&&(c(0,"div",15),l(1),a()),t&2){let e=r.$implicit;s(),G(e.value)}}function he(t,r){if(t&1&&(_(0,xe,2,1,"div",15,h),C(2,"keyvalue")),t&2){let e=m(2);v(U(2,0,e.createOrUpdateLogFormGroup.errors==null?null:e.createOrUpdateLogFormGroup.errors.exercise))}}function _e(t,r){if(t&1&&(c(0,"div",10)(1,"span",16),l(2),a(),L(3,"input",17)(4,"input",18),a()),t&2){let e=r.$implicit,o=r.$index;s(2),f("Serie ",o+1,""),s(),p("formControl",e.controls.reps),s(),p("formControl",e.controls.weightInKg)}}function ve(t,r){if(t&1&&(c(0,"div",15),l(1),a()),t&2){let e=r.$implicit;s(),G(e.value)}}function Le(t,r){if(t&1&&(_(0,ve,2,1,"div",15,h),C(2,"keyvalue")),t&2){let e=m(2);v(U(2,0,e.createOrUpdateLogFormGroup.errors==null?null:e.createOrUpdateLogFormGroup.errors.series))}}function fe(t,r){if(t&1){let e=O();c(0,"button",19),S("click",function(){E(e);let i=m(2);return y(i.openDeleteModal())}),l(1," Delete "),a()}}function Ce(t,r){if(t&1&&L(0,"app-exercise-log",22),t&2){let e=r.$implicit;p("exerciseLog",e)}}function be(t,r){if(t&1&&(c(0,"ul",24)(1,"li",25),l(2),a(),c(3,"li",26),l(4),C(5,"number"),a()()),t&2){let e=r.$implicit,o=r.$index;s(2),f("Serie ",o+1,""),s(2),f("",k(5,2,e.brzycki,"1.2-2"),"kg")}}function Ee(t,r){if(t&1&&(c(0,"div",20)(1,"div",21),l(2,"Previous entries"),a(),_(3,Ce,1,1,"app-exercise-log",22,h),a(),c(5,"div",23)(6,"div",21),l(7,"Possible 1RM (Brzycky Formula)"),a(),_(8,be,6,5,"ul",24,h),c(10,"ul",24)(11,"li",25),l(12,"Average"),a(),c(13,"li",26),l(14),C(15,"number"),a()()()),t&2){let e,o,i,n=m(2);s(3),v((e=(e=n.originalValue())==null?null:e.recentLogs)!==null&&e!==void 0?e:T(4,ge)),s(5),v((o=n.originalValue())==null?null:o.series),s(6),f("",k(15,1,(i=n.originalValue())==null?null:i.brzyckiAverage,"1.2-2"),"kg")}}function ye(t,r){if(t&1){let e=O();c(0,"div",0)(1,"div",2)(2,"h4",3),l(3),a()(),c(4,"div",4)(5,"form"),L(6,"input",5),c(7,"div",6),L(8,"input",7),a(),c(9,"div",6)(10,"div",8),L(11,"app-typeahead",9),a(),g(12,he,3,2),a(),_(13,_e,5,3,"div",10,h),g(15,Le,3,2),a()(),c(16,"div",11),g(17,fe,2,0,"button",12),c(18,"button",13),S("click",function(){E(e);let i=m();return y(i.cancel())}),l(19," Cancel "),a(),c(20,"button",14),S("click",function(){E(e);let i=m();return y(i.saveExerciseLog())}),l(21," Save "),a(),g(22,Ee,16,5),a()()}if(t&2){let e=m();s(3),f(" ",e.mode==="edit"?"Edit":"Create"," Log "),s(5),p("formControl",e.createOrUpdateLogFormGroup.controls.date),s(3),p("items",e.exerciseLogService.exercises)("control",e.createOrUpdateLogFormGroup.controls.exercise)("itemSelector",e.exerciseSelector),s(),x(e.createOrUpdateLogFormGroup.controls.exercise.pristine?-1:12),s(),v(e.createOrUpdateLogFormGroup.controls.series.controls),s(2),x(e.createOrUpdateLogFormGroup.controls.series.pristine?-1:15),s(),p("ngClass",M(12,me,e.mode==="edit")),s(),x(e.mode==="edit"?17:-1),s(3),p("ngClass",P(14,ue,e.createOrUpdateLogFormGroup.valid,e.createOrUpdateLogFormGroup.invalid))("disabled",e.createOrUpdateLogFormGroup.invalid),s(2),x(e.mode==="edit"?22:-1)}}function Se(t,r){t&1&&(c(0,"div",1)(1,"div",27)(2,"span",28),l(3,"Loading..."),a()()())}var He=(()=>{let r=class r{constructor(){this.exerciseLogService=d(H),this.location=d(V),this.router=d(R),this.toastService=d(se),this.authService=d(ce),this.exerciseLogApiService=d(q),this.titleCasePipe=d(A),this.dayjsService=d(z),this.dayjs=this.dayjsService.instance,this.route=d(B),this.modalService=d(oe),this.mode=null,this.createOrUpdateLogFormGroup=null,this.originalValue=I(null),this.isLoading=I(!1),this.exerciseSelector=o=>typeof o=="string"?"":this.titleCasePipe.transform(o?.name)??"",this.route.url.pipe(j()).subscribe(o=>{if(this.createOrUpdateLogFormGroup=le(),o.some(n=>n.path===b.LOGS_CREATE)){this.mode="create";let n=this.dayjs().format("YYYY-MM-DD");this.createOrUpdateLogFormGroup.controls.date.patchValue(n)}else this.initEditMode()})}openDeleteModal(){let o=this.modalService.open(de,{centered:!0}),i=o.componentInstance;i.title="Delete Record",i.subtitle="<strong>Are you sure you want to delete this record?</strong>",i.body='This record will be permanently deleted. <span class="text-danger">This operation can not be undone.</span>',i.okType="danger",o.closed.pipe(F(1)).subscribe(()=>{this.exerciseLogService.deleteLog$.next(this.originalValue())})}saveExerciseLog(){this.isLoading.set(!0),this.mode==="create"?this.createExerciseLog():this.updateExerciseLog(this.originalValue())}cancel(){this.exerciseLogService.refreshLogs$.pipe(F(1)).subscribe(()=>{this.location.back()}),this.exerciseLogService.refreshLogs$.next()}createExerciseLog(){if(this.createOrUpdateLogFormGroup.invalid||typeof this.createOrUpdateLogFormGroup.value.exercise=="string")return;let o=this.authService.user(),i={exerciseLog:{exerciseLogUsername:o?.name??this.createOrUpdateLogFormGroup.value.user.toLocaleLowerCase(),exerciseLogUserId:o?.userId,exerciseLogExerciseId:this.createOrUpdateLogFormGroup.value.exercise.exerciseId,exerciseLogDate:this.dayjsService.parseDate(this.createOrUpdateLogFormGroup.value.date).format("YYYY-MM-DD"),series:(this.createOrUpdateLogFormGroup.value.series??[]).filter(n=>!!n.reps&&!!n.weightInKg).map(n=>({exerciseLogId:n.exerciseLogId,serieId:n.serieId,reps:+n.reps,weightInKg:+n.weightInKg.toFixed(1),brzycki:null}))}};this.exerciseLogApiService.createExerciseLog(i).subscribe({next:n=>{this.createOrUpdateLogFormGroup.reset(),localStorage.removeItem(N),this.toastService.ok("Log created successfully!"),this.router.navigate([b.LOGS,b.LOGS_EDIT,n])},error:()=>{this.toastService.error()}})}updateExerciseLog(o){if(this.createOrUpdateLogFormGroup.invalid||typeof this.createOrUpdateLogFormGroup.value.exercise=="string")return;let i=this.authService.user(),n={id:o?.id,exerciseLog:{exerciseLogUsername:i?.name??this.createOrUpdateLogFormGroup.value.user.toLocaleLowerCase(),exerciseLogUserId:i?.userId,exerciseLogExerciseId:this.createOrUpdateLogFormGroup.value.exercise.exerciseId,exerciseLogDate:this.dayjsService.parseDate(this.createOrUpdateLogFormGroup.value.date).format("YYYY-MM-DD"),series:(this.createOrUpdateLogFormGroup.value.series??[]).filter(u=>!!u.reps&&!!u.weightInKg).map(u=>({exerciseLogId:u.exerciseLogId,serieId:u.serieId,reps:+u.reps,weightInKg:+u.weightInKg.toFixed(1),brzycki:null}))}};this.exerciseLogApiService.updateExerciseLog(n).subscribe({next:()=>{this.createOrUpdateLogFormGroup.reset(),this.toastService.ok("Log updated successfully!"),this.initEditMode()},error:()=>{this.toastService.error()}})}initEditMode(){this.isLoading.set(!0);let o=Number(this.route.snapshot.paramMap.get(b.LOGS_ID_PARAM));this.mode="edit",this.exerciseLogApiService.getExerciseLogById(o).subscribe(i=>{this.originalValue.set(i),this.createOrUpdateLogFormGroup.reset(),this.createOrUpdateLogFormGroup.patchValue({exercise:i.exercise,date:this.dayjsService.parseDate(i.date).format("YYYY-MM-DD"),user:i.user.name,series:i.series.map(n=>({exerciseLogId:n.exerciseLogId,serieId:n.serieId,reps:n.reps,weightInKg:n.weightInKg}))}),this.isLoading.set(!1)})}};r.\u0275fac=function(i){return new(i||r)},r.\u0275cmp=w({type:r,selectors:[["edit-exercise-log-page"]],standalone:!0,features:[D],decls:2,vars:1,consts:[[1,"footer-padding"],[1,"position-absolute","top-50","start-50","translate-middle"],[1,"modal-header"],["id","modal-basic-title",1,"modal-title"],[1,"modal-body"],["type","text","autofocus","autofocus",2,"display","none"],[1,"mb-3"],["type","date","placeholder","DD-MM-YYYY","placeholder","Reps",1,"form-control",3,"formControl"],[1,"input-group"],["placeholder","Exercise",3,"items","control","itemSelector"],[1,"input-group","mb-2","align-items-center"],[1,"modal-footer",3,"ngClass"],["type","button",1,"btn","btn-danger","me-auto"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn",3,"click","ngClass","disabled"],[1,"d-block","invalid-feedback"],[1,"input-group-text"],["type","number","placeholder","Reps",1,"form-control",3,"formControl"],["type","number","placeholder","Kg",1,"form-control",3,"formControl"],["type","button",1,"btn","btn-danger","me-auto",3,"click"],[1,"pt-5","w-100"],[1,"pb-2"],[1,"w-100",3,"exerciseLog"],[1,"pt-3","w-100"],[1,"list-group","list-group-horizontal","pb-1"],[1,"list-group-item","active"],[1,"list-group-item"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"]],template:function(i,n){i&1&&g(0,ye,23,17,"div",0)(1,Se,4,0,"div",1),i&2&&x(n.isLoading()?1:0)},dependencies:[re,Z,J,ee,Q,W,te,ie,X,ne,ae,pe,K,$,Y],styles:["[_nghost-%COMP%]{display:block;padding:0 .5rem;--bs-heading-color: white;--bs-modal-color: white;--bs-body-bg: var(--light-bg);--bs-body-color: var(--font-color);--bs-tertiary-bg: var(--primary);--bs-border-width: 0;--bs-modal-footer-border-width: 0;--bs-modal-header-border-width: 0;--bs-modal-header-padding: .5rem}.list-group[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 3fr;--bs-list-group-bg: var(--light-bg)}.list-group[_ngcontent-%COMP%]   .active[_ngcontent-%COMP%]{--bs-list-group-active-bg: var(--primary)}"],changeDetection:0});let t=r;return t})();export{He as EditExerciseLogPageComponent};
